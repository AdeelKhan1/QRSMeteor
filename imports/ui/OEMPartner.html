<template name='OEMPartner'>
    <div class="ui icon message">
        <img class="icon" src="images/intro.png">
        <div class="content">
            {{#if freshEnvironment}}
            <div class="header">
                Step 1: Let's start to setup the SaaS demo environment
            </div>
            <p>
                First insert some customers with users in your SaaS platform.
                <ul>
                    <li>You can use these customers later on to generate streams and apps. </li>
                    <li>You can use the users to test the single sign and our layered approach to governed <a href="#" class="selfservice">self service</a> in step 4.</li>
                </ul>
            </p>
            {{/if}} {{#if readyToSelectTemplate}}
            <div class="header">
                Step 2: Select a template app
            </div>
            <p>
                Select the "my first template" app on the right.
                <!--  If you create apps using a user with role 'developer', then you can also use this one as template. -->
            </p>
            {{/if}} {{#if readyToGenerate}} {{> step3}} {{/if}} {{#if templateButNoCustomer}}
            <div class="header">
                Customers
            </div>
            <p>
                You already selected a template, but please re-insert your customers.
            </p>
            {{/if}} {{#if readyToTestSSO}} {{> step4}} {{/if}} {{#if loading}}
            <div class="header">
                API communication is in progress...
            </div>
            <p>Your SaaS platform is now sending API calls to the Qlik Sense. See more info about what we do here in the <a href="{{pathFor 'ApiLogsTable'}}" target="_blank">API logs</a>. {{> reactiveTable collection=restrictedApiLogs settings=RESTCallSettings}}
            </p>
            {{/if}}
        </div>
    </div>
    {{#if readyToTestSSO}} {{> simulateUserLogin}} {{/if}} {{#unless noCustomers}} {{> mainButtonsCustomers}} {{/unless}} {{#if readyToGenerate}}
    <div class="ui {{loading}} primary button generateStreamAndApp"><i class="play icon "></i>Start</div>
    {{/if}} {{#if or noCustomers templateButNoCustomer}}
    <div class="ui icon message">
        <img class="icon" src="images/customers.png">
        <div class="content">
            <div class="header">
                <h4>No customers</h4>
            </div>
            <p>You have resetted the demo environment, and therefore this demo now simulates the first day of your SaaS platform. As a first step we need to insert some customers, or use the dummy customers (Sunny and Cloudy Petrol) we created for you.
            </p>
            <div class="ui fluid mini buttons">
                <a href="{{pathFor 'users'}}" class="ui button">Insert customers</a>
                <div class="or"></div>
                <a href="#" class="ui button insertDummyCustomers">Use dummy customers and template app</a>
            </div>
        </div>
    </div>
    <!-- {{else}} {{> customerOverview}}  -->
    {{#if readyToSelectTemplate}}
    <div class="ui icon message">
        <img class="icon" src="images/app.png">
        <div class="content">
            <div class="header">
                <h4>No template apps</h4>
            </div>
            <p>Please select an app in the templates stream (on the right) which you would like to use as a basis template. We will create a copy and publish it into the "customer name" stream for each of your selected customers</p>
        </div>
    </div>
    {{else}}
    <!-- {{> templateOverview}} -->{{/if}} {{/if}}
</template>
<template name="customerOverview">
    <div class="ui icon message">
        <img class="icon" src="images/customers.png">
        <div class="content">
            <div class="header">
                <h4>{{NrCustomers}} Customer(s) stored in the database of your SaaS platform </h4>
            </div>
        </div>
    </div>
    <div class="ui styled fluid accordion">
        <div class="title">
            <i class="dropdown icon"></i> View the customers
        </div>
        <div class="content">
            <table class="ui celled striped table">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th>Delete customer</th>
                        <th>Generate stream</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each customers}} {{> customer}} {{/each}}
                </tbody>
            </table>
        </div>
    </div>
</template>
<template name="templateOverview">
    <div class="ui icon message">
        <img class="icon" src="images/app.png">
        <div class="content">
            <div class="header">
                <h4>{{NrTemplates}} Selected template app(s)</h4>
            </div>
            <p>We will create a "customer name" stream, replace the script, reload and publish a copy of each template app for each of your customers</p>
        </div>
    </div>
    <div class="ui styled fluid accordion">
        <div class="title">
            <i class="dropdown icon"></i> View selected templates
        </div>
        <div class="content">
            <table class="ui celled table">
                <thead>
                    <tr>
                        <th>App (QVF)</th>
                        <th>Don't mark as template</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each templateApps}}
                    <tr>
                        <td> <a href={{linkToApp}} target=_blank> {{name}} </a></td>
                        <td class="removeTemplateApp"><i class="remove circle icon"></i></td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>
</template>
<Template name="step3">
    <div class="header">
        Create Qlik Sense apps
    </div>
    <p>
        Press the green button to start the SaaS provisioning for the customers below:
        <ul>
            {{#each customers}}
            <li>
                {{name}}
            </li> {{/each}}
        </ul>
        <div class="ui accordion">
            <div class="title">
                <i class="dropdown icon"></i>Read more on SaaS provisioning...
            </div>
            <div class="content">
                <h4>Manual activities</h4>
                <p>This demo platform provides you with a wrapper around the Qlik Sense <a href="https://help.qlik.com/en-US/sense/3.1/Content/Videos/Videos-qmc-intro.htm">QMC</a>, so you can send API calls to Qlik Sense by pressing certain buttons. Using these calls you can, for example, create streams and apps or complete any other activity that youâ€™d be able to do in the QMC or app. Each activity you do is <a href="{{pathFor 'ApiLogsTable'}}" class="item">logged</a>. In these logs you can see the request from this demo platform and the responses from Qlik Sense. For example you can press
                    <ul>
                        <li>"create stream" next to the customer to create a stream.</li>
                        <li>"Copy app" to manually copy the app for each selected customer.</li>
                    </ul>
                    <!-- Why do you have to select a customer first? Well, in your SaaS platform you probably want to publish the apps only for customers who pay or who have activited the app in your software, so this "selection" simulates that use case. --></p>
                <p>
                    <h4>Fully automated SaaS provisioning</h4>{{> usingTheDemo}}
                </p>
            </div>
        </div>
    </p>
</Template>
<Template name="step4">
    <div class="header">
        4: Test Single Sign On
    </div>
    <p>
        Select a user in the dropdown below to test the single sign on between your SaaS platform and Qlik Sense.
        <div class="ui accordion">
            <div class="title">
                <i class="dropdown icon"></i>Read more...
            </div>
            <div class="content">
                <p>We have now finished creating the content per customer. So a good time to look at how Qlik can re-use your SaaS platforms authorizations and implement single sign on. On this page you will see a dropdown, this dropdown contains the users of your SaaS platform. Using this dropdown we can simulate a user login (without having to insert passwords etc.). In this way you can easily test the single sign on process, and make sure your platform is in the lead. You can try to create new customers and users in the <a href="{{pathFor 'users'}}">manage customers and users</a> menu.</p>
                <p>
                    If you select a user a ticket will be requested which inludes your SaaS platform's current authorizations (the groups) in a dynamic way. This means you don't have to create users and roles up front in Qlik Sense. The <a href="{{pathFor 'securityRules'}}" class="item">QMC security rules</a> are also created in a dynamic way, so we can protect the apps and streams with a couple of generic rules. The row/column level security is done via a special section in the script of an app (QVF). In this demo we used the group (Country) to ensure each user only sees his country in the "row level security app" in the " everyone stream.</p>
                <p>In the your <a class="item" href="{{webIntegrationDemo}}/hub" target="_blank">SaaS platform</a> menu you can see Qlik Sense embedded via IFrame's and DIV tags. On the other side, if you press any link on the current page you will go to Qlik Sense directly. See security integration <a href="{{pathFor 'introductionSecurity'}}" class="item">videos</a> for more information on the complete security flow.</p>
                <div class="ui fluid mini buttons">
                    <a class="ui mini button" href="{{pathFor 'users'}}">Users and groups</a>
                    <div class="or"></div>
                    <a href="#" class="ui mini button selfservice">Levels of self service</a>
                </div>
            </div>
        </div>
    </p>
</Template>
<template name="mainButtonsCustomers">
    <!-- <div class="ui buttons"> -->
    <div class="ui {{loading}} basic button resetEnvironment"><i class="delete icon"></i>
        <!-- Cleanup demo -->
    </div>
    <div class="ui floating basic dropdown icon button">
        <i class="dropdown icon"></i>
        <div class="menu">
            <div class="item insertDummyCustomers"><i class="edit icon "></i> Insert dummy customers</div>
            <div class="item deleteAllCustomers"><i class="delete icon "></i> Delete all customers</div>
            <div class="item toggleAllCustomers"><i class="refresh icon"></i> Toggle the selected customers</div>
        </div>
    </div>
    <!-- </div> -->
    {{#if readyToTestSSO}}{{>step4Buttons}} {{/if}} {{#if readyToGenerate}} {{>forwardToSSOStep}} {{/if}}
</template>
<template name="step4Buttons">
    <div class="ui basic button backToStep3"><i class="mail reply icon"></i> </div>
    <a href="{{pathFor 'ApiLogsTable'}}" target="_blank" class="ui basic button ApiLogsTable"><i class="list layout icon"></i> </a>
</template>
<template name="forwardToSSOStep">
    <div class="ui basic button forwardToSSOStep"><i class="mail forward icon"></i>
    </div>
</template>
