<template name='OEMPartner'>
    <div class="ui icon message">
        <img class="icon" src="images/intro.png">
        <div class="content">
            {{#if freshEnvironment}}
            <div class="header">
                1: Let's start publishing apps for your customers
            </div>
            <p>
                <ul>
                    First insert some customers with users in your SaaS platform.
                    <li>You can use these customers later on to generate streams and apps. </li>
                    <li>You can use the users to test the single sign and our layered approach to governed <a href="#" class="selfservice">self service</a> in step 4.</li>
                </ul>
            </p>
            {{/if}} {{#if readyToSelectTemplate}}
            <div class="header">
                2: Select a template app
            </div>
            <p>
                Select the "my first template" app on the right.
                <!--  If you create apps using a user with role 'developer', then you can also use this one as template. -->
            </p>
            {{/if}} {{#if readyToGenerate}} {{> step3}} {{/if}} {{#if templateButNoCustomer}}
            <div class="header">
                Customers
            </div>
            <p>
                You already selected a template, but please re-insert your customers.
            </p>
            {{/if}} {{#if readyToTestSSO}} {{> step4}} {{/if}} {{#if loading}}
            <div class="header">
                3: API communication is in progress...
            </div>
            <p>This application is now sending REST and websocket based API calls to the Qlik Sense QRS and Engine API. See more info about API's, the source code, sequence diagrams and a real time API call overview in the <a href="{{pathFor 'APILogs'}}" target="_blank">QMC & API menu</a>. {{> reactiveTable collection=restrictedApiLogs settings=RESTCallSettings}}
            </p>
            {{/if}}
        </div>
    </div>
    {{#if readyToTestSSO}} {{> simulateUserLogin}} {{/if}}
    <div class="ui ">
        <!-- <div class="ui buttons"> -->
        {{#if readyToGenerate}}
        <div class="ui {{loading}} primary button generateStreamAndApp"><i class="play icon "></i> 3: Generate</div>
        <!-- <div class="or"></div> -->
        {{/if}} {{#unless noCustomers}} {{> mainButtonsCustomers}} {{/unless}}
        <!-- </div> -->
        {{#if or noCustomers templateButNoCustomer}}
        <div class="ui icon message">
            <img class="icon" src="images/customers.png">
            <div class="content">
                <div class="header">
                    <h4>No customers</h4>
                </div>
                <p>
                    {{#if freshEnvironment}} You have resetted the demo environment, and therefore this demo now simulates the first day of your SaaS platform. As a first step we need to insert some customers and users if you like to create your own, or load predefined (dummy) customers.
                    <br>
                    <div class="ui fluid mini buttons">
                        <a href="{{pathFor 'users'}}" class="ui button">Insert your own customers</a>
                        <div class="or"></div>
                        <a href="#" class="ui button insertDummyCustomers">Use predefined customers</a>
                    </div>
                    {{/if}}
                </p>
            </div>
        </div>
        {{else}}
        {{> customerOverview}}
        {{#if noTemplateApps}}
        <div class="ui icon message">
            <img class="icon" src="images/app.png">
            <div class="content">
                <div class="header">
                    <h4>No template apps</h4>
                </div>
                <p>Please select an app in the templates stream (on the right) which you would like to use as a basis template. We will create a copy and publish it into the "customer name" stream for each of your selected customers</p>
            </div>
        </div>
        {{else}} {{> templateOverview}} {{/if}} {{/if}}
    </div>
    <div class="ui modal APIAutomation">
        <div class="ui icon message">
            <img class="icon" src="images/API.png">
            <div class="content">
                <div class="header">
                    <h4> API automation: an introduction</h4>
                </div>
                <p>This <a href="https://github.com/QHose/QRSMeteor">open source</a> (non-Qlik) <a href="https://www.meteor.com/">Meteor.js</a> based demo platform has been designed to demonstrate the power of the Qlik Sense API's for companies that are looking to integrate Qlik Sense in their multi-tenant SaaS platform. Please look at the video below for an introduction. </p>
                <p> This demo guides you on how you can automate each manual step in Qlik Sense. Sense works internally with the same API's as you can use, so you can record the REST call from each manual activity in the QMC and use this code to create/delete/reload/publish streams and apps in your software. We will not cover all the use cases, lets say we cover 80%, but the examples and code provided should give you enough convidence to build the remaining 20% yourself.</p>
            </div>
        </div>
        <div class="ui one column centered grid">
            <div class="column centered">
                <div class="ui embed" data-url="{{URL_Youtube_concept_behind}}" data-placeholder="/images/API.png"></div>
            </div>
        </div>
        <div class="actions">
            <div class="ui positive right labeled icon button">
                I got it...
                <i class="checkmark icon"></i>
            </div>
        </div>
    </div>
</template>
<template name="customerOverview">
    <div class="ui icon message">
        <img class="icon" src="images/customers.png">
        <div class="content">
            <div class="header">
                <h4>{{NrCustomers}} Customer(s) stored in the database of your SaaS platform </h4>
            </div>
        </div>
    </div>
    <div class="ui styled fluid accordion">
      <div class="title">
        <i class="dropdown icon"></i>
        View the customers
    </div>
    <div class="content">
        <table class="ui celled striped table">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Delete customer</th>
                    <th>Generate stream</th>
                </tr>
            </thead>
            <tbody>
                {{#each customers}} {{> customer}} {{/each}}
            </tbody>
        </table>
    </div>
</div>

</template>
<template name="templateOverview">
    <div class="ui icon message">
        <img class="icon" src="images/app.png">
        <div class="content">
            <div class="header">
                <h4>{{NrTemplates}} Selected template app(s)</h4>
            </div>
            <p>We will create a "customer name" stream, replace the script, reload and publish a copy of each template app for each of your customers</p>
        </div>
    </div>
    <div class="ui styled fluid accordion">
       <div class="title">
        <i class="dropdown icon"></i>
        View selected templates
    </div>
    <div class="content">
        <table class="ui celled table">
            <thead>
                <tr>
                    <th>App (QVF)</th>
                    <th>Don't mark as template</th>
                </tr>
            </thead>
            <tbody>
                {{#each templateApps}}
                <tr>
                    <td> <a href={{linkToApp}} target=_blank> {{name}} </a></td>
                    <td class="removeTemplateApp"><i class="remove circle icon"></i></td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</div>
</template>
<Template name="step4">
    <div class="header">
        4: Test Single Sign On
    </div>
    <p>
        Select a user in the dropdown below to test the single sign on between your SaaS platform and Qlik Sense.
        <div class="ui accordion">
            <div class="title">
                <i class="dropdown icon"></i>Read more...
            </div>
            <div class="content">
                <p>We have now finished creating the content per customer. So a good time to look at how Qlik can re-use your SaaS platforms authorizations and implement single sign on. On this page you will see a dropdown, this dropdown contains the users of your SaaS platform. Using this dropdown we can simulate a user login (without having to insert passwords etc.). In this way you can easily test the single sign on process, and make sure your platform is in the lead. You can try to create new customers and users in the <a href="{{pathFor 'users'}}">manage customers and users</a> menu.</p>
                <p>
                    If you select a user a ticket will be requested which inludes your SaaS platform's current authorizations (the groups) in a dynamic way. This means you don't have to create users and roles up front in Qlik Sense. The <a href="{{pathFor 'securityRules'}}" class="item">QMC security rules</a> are also created in a dynamic way, so we can protect the apps and streams with a couple of generic rules. The row/column level security is done via a special section in the script of an app (QVF). In this demo we used the group (Country) to ensure each user only sees his country in the "row level security app" in the " everyone stream.</p>
                    <p>In the your <a class="item" href="{{webIntegrationDemo}}/hub" target="_blank">SaaS platform</a> menu you can see Qlik Sense embedded via IFrame's and DIV tags. On the other side, if you press any link on the current page you will go to Qlik Sense directly. See security integration <a href="{{pathFor 'introductionSecurity'}}" class="item">videos</a> for more information on the complete security flow.</p>
                </div>
            </div>
        </p>
    </Template>
    <Template name="step3">
        <div class="header">
            3: Press generate
        </div>
        <p>
            Press the green generation button to start creating streams and apps for each of your selected customers.
            <div class="ui accordion">
                <div class="title">
                    <i class="dropdown icon"></i>Read more...
                </div>
                <div class="content">
                    <p>
                        If you press generate a sequence of activities will be executed automatically via the API's. You can test each activity also manually and see the <a href="{{pathFor 'APILogs'}}" class="item">API Calls</a>. By clicking on the "columns" button you can select extra buttons.
                        <br> For example you can press "create stream" next to the customer to create a stream. "Copy app" to manually copy the app for each selected customer.
                        <br> Why do you have to select a customer first? Well, in your SaaS platform you probably want to publish the apps only for customers who pay or who have activited the app in your software, so this "selection" simulates that use case.</p>
                        <p>
                            <h4>Fully automated app generation</h4>You can also automate each step, this happens when you press the generate button. It executes a chain of actions; it will publish a copy of the template app in the "customer name" stream. Next to this it replaces and reloads the script with a customer specific one.
                        </p>
                        <p>See more information about the generation or API automation <a href="#" class="APIAutomation">here</a> </p>
                    </div>
                </div>
            </p>
        </Template>
        <template name="mainButtonsCustomers">
            <!-- <div class="ui buttons"> -->
            <div class="ui {{loading}} basic button resetEnvironment"><i class="delete icon"></i>
                <!-- Cleanup demo -->
            </div>
            <div class="ui floating basic dropdown icon button">
                <i class="dropdown icon"></i>
                <div class="menu">
                    <div class="item insertDummyCustomers"><i class="edit icon "></i> Insert dummy customers</div>
                    <div class="item deleteAllCustomers"><i class="delete icon "></i> Delete all customers</div>
                    <div class="item toggleAllCustomers"><i class="refresh icon"></i> Toggle the selected customers</div>
                </div>
            </div>
            <!-- </div> -->
            {{#if readyToTestSSO}}{{>backToGenerationStep}} {{/if}} {{#if readyToGenerate}} {{>forwardToSSOStep}} {{/if}}
        </template>
        <template name="backToGenerationStep">
            <div class="ui basic button backToGenerationStep"><i class="mail reply icon"></i>
                <!-- Back to generation -->
            </div>
        </template>
        <template name="forwardToSSOStep">
            <div class="ui basic button forwardToSSOStep"><i class="mail forward icon"></i>
            </div>
        </template>
