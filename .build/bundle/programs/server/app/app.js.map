{"version":3,"sources":["meteor://ðŸ’»app/lib/yogiben.js","meteor://ðŸ’»app/imports/api/server/QPSFunctions.js","meteor://ðŸ’»app/imports/api/server/QRSAPI.js","meteor://ðŸ’»app/imports/api/server/QRSFunctionsApp.js","meteor://ðŸ’»app/imports/api/server/QRSFunctionsCustomProperties.js","meteor://ðŸ’»app/imports/api/server/QRSFunctionsExtension.js","meteor://ðŸ’»app/imports/api/server/QRSFunctionsLicense.js","meteor://ðŸ’»app/imports/api/server/QRSFunctionsStream.js","meteor://ðŸ’»app/imports/api/server/QRSFunctionsSystemRules.js","meteor://ðŸ’»app/imports/api/APILogs.js","meteor://ðŸ’»app/imports/api/apps.js","meteor://ðŸ’»app/imports/api/config.js","meteor://ðŸ’»app/imports/api/customers.js","meteor://ðŸ’»app/imports/api/streams.js","meteor://ðŸ’»app/imports/startup/accounts-config.js","meteor://ðŸ’»app/imports/ui/UIHelpers.js","meteor://ðŸ’»app/server/accounts.js","meteor://ðŸ’»app/server/proxy.js","meteor://ðŸ’»app/server/publications.js","meteor://ðŸ’»app/server/restEndpoints.js","meteor://ðŸ’»app/server/routes.js","meteor://ðŸ’»app/server/seeds.js","meteor://ðŸ’»app/server/main.js"],"names":["module1","module","export","createVirtualProxies","getVirtualProxies","logoutUser","getRedirectURL","Meteor","watch","require","v","Customers","dummyCustomers","dummyCustomer","REST_Log","gitHubLinks","senseConfig","enigmaServerConfig","authHeaders","QRSconfig","qliksrv","QRSCertConfig","configCerticates","validateJSON","qrsSrv","lodash","fs","path","os","ip","_","createVirtualProxy","virtualProxy","loadBalancingServerNodes","id","getServerNodeConfiguration","check","Object","console","log","prefix","request","response","HTTP","call","params","xrfkey","data","err","error","file","join","settings","broker","automationBaseFolder","readJson","proxySettings","Error","vpToCreate","websocketCrossOriginWhiteList","push","public","qlikSenseHost","address","hostname","existingProxies","found","some","existingVP","linkVirtualProxyToProxy","proxyId","getProxyId","proxyConfig","getProxyServiceConfiguration","virtualProxies","unencryptedListenPort","qlikSensePort","listenPort","qlikSensePortSecure","allowHttp","qlikSenseAllowHTTP","updateProxy","String","outputFile","JSON","stringify","npmRequestOptions","methods","currentlyLoggedInUser","action","userId","customer","findOne","generationUserId","user","find","users","getRedirectUrl","proxyRestUri","targetId","loggedInUser","passport","name","toUpperCase","country","group","url","createpassport","getTicketNumber","userProperties","requestTicketWithPassport","proxyGetTicketURI","host","private","proxyPort","headers","message","Ticket","resetLoggedInUser","forEach","updatedUsers","map","currentlyLoggedIn","update","_id","$set","logoutPresentationUser","UDC","slideGenerator","logoutVirtualProxyClientUsageUser","virtualProxyClientUsage","simulateUserLogin","query","numberAffectedDocuments","insertDummyCustomers","email","password","userExists","Accounts","findUserByEmail","setPassword","createUser","Roles","addUsersToRoles","each","insert","proxy","SenseServerInternalLanIP","ticketRequestBody","TargetId","requestTicket","ticketResponse","TargetUri","indexOf","redirectURI","port","hub","myQRS","http","myQRSMain","get","endpoint","checkPath","newParams","assign","post","del","put","uploadAndPublishTemplateApps","generateStreamAndApp","setAppIDs","createAppConnections","createAppConnection","copyApp","getApps","deleteApp","publishApp","importApp","Apps","TemplateApps","GeneratedResources","QSStream","Streams","qlikHDRServer","qrs","_SSBIApp","_slideGeneratorAppId","APILogs","enigma","promise","sanitize","newFolder","everyOneStreamId","getStreamByName","EveryoneAppStreamName","templateStreamId","TemplateAppStreamName","APIAppsStreamID","APIAppStreamName","readdir","appsInFolder","Promise","all","QVF","appName","substr","filePath","length","uploadApp","appId","copiedAppId","customers","templateApps","checkTemplateAppExists","checkCustomersAreSelected","templateApp","generateAppForTemplate","stream","selectionSheet","dataObject","slideObject","SSBI","sheetId","slideGeneratorApps","SSBIApps","SSBIApp","slideGeneratorAppId","createdBy","streamId","checkStreamStatus","createDirectory","customerDataFolder","newAppId","result","reloadAppAndReplaceScriptviaEngine","publishedAppId","newAppName","scriptReplace","replaceScript","script","config","getService","qix","replaceAndReloadApp","app","createConnection","qConnectionId","info","getScript","setScript","doReload","reloadApp","saveApp","doSave","senseDemoMaterials","absolutePath","dataConnections","c","type","connectionString","deleteDirectoryAndDataConnection","customerName","filename","dir","customerDataDir","ensureDir","fetch","currentAppsInSense","templateFound","resolve","reject","formData","my_file","createReadStream","headerValue","res","body","parse","guid","newGuid","createStream","appGuid","fileName","createCustomProperty","upsertCustomPropertyByName","deleteCustomProperty","getCustomProperties","newProperty","toString","choiceValues","Array","existingProperty","updatedProperty","customProperty","filter","customProperties","uploadExtensions","extensionsFolder","extensions","extension","uploadExtension","basename","getLicense","insertLicense","insertUserAccessRule","getSystemRules","saveSystemRules","demoUserAccessRule","lic","existingLicense","newLicense","license","serial","organization","LicenseControlNumber","Number","control","licenseRule","ruleExist","rules","initSenseStreams","deleteStream","getStreams","qlikServer","StreamsToCreateAutomatically","streamName","getSecurityRules","disableDefaultSecurityRules","createSecurityRules","QSLic","security","rulesToDisable","ruleName","ruleDefinition","disabled","warn","securityRules","rule","stringToJSON","myString","myJSONString","myEscapedJSONString","replace","Mongo","Collection","createDate","Date","isServer","rawCollection","missingParameters","compareKeys","Random","_QIXSchema","isClient","_senseConfig","webIntegrationDemoPort","e","generateXrfkey","hexString","_certs","engineConfig","crypto","bluebird","WebSocket","useSSL","headerKey","process","env","USERDOMAIN","USERNAME","isSecure","qrsPort","enginePort","certificatesDirectory","ca","readFileSync","key","cert","qlikUserDomain","qlikUser","connectToSenseAsUserDirectory","connectToSenseAsUser","rejectUnauthorized","_engineConfig","passphrase","appname","QIXSchema","schema","session","createSocket","authentication","startup","split","sep","exampleSettingsFile","keysEqual","obj","a","b","aKeys","keys","sort","bKeys","updateUserForCustomer","updatedUser","selection","attachSchema","SimpleSchema","label","checked","Boolean","optional","defaultValue","createdAt","autoValue","allowedValues","faker","company","companyName","findName","AccountsTemplates","configure","confirmPassword","enablePasswordChange","forbidClientAccountCreation","overrideLoginErrors","sendVerificationEmail","lowercaseUsername","focusFirstInput","showAddRemoveServices","showForgotPasswordLink","showLabels","showPlaceholders","showResendVerificationEmailLink","continuousValidation","negativeFeedback","negativeValidation","positiveValidation","positiveFeedback","showValidating","homeRoutePath","redirectTimeout","texts","button","signUp","socialSignUp","socialIcons","title","forgotPwd","configureRoute","createPasport","redirectURLReceived","freshEnvironment","count","currentStep","Session","Router","go","equals","set","Cookies","Template","registerHelper","date","moment","format","webIntegrationHost","IntegrationPresentationSelectionSheet","someValue","stepNr","numberOfUsers","username","profile","GLOBAL_GROUP","ntlm","bunyan","register","publish","generatedAppsFromUser","userIsInRole","$or","ready","generatedStreamsFromUser","selector","limit","stop","JsonRoutes","add","req","next","sampleData","customer1","sendResult","customer2","route","where","QSApp","QSProxy","QSSystem","QSExtensions","QSCustomProps","shell","on","up","ROOT_URL","initQlikSense","removeGeneratedResources","optimizeMongoDB","QlikConfigured","runInitialQlikSenseSetup","qlikSense","installQlikSense","timeout","ms","setTimeout","sleep","fn","args","exec","execFile","executable","installer","automaticCleanUpGeneratedApps","setInterval","_ensureIndex","getAppIDs","multiTenantScenario","customerNames","resetEnvironment","remove","upsertTemplate","currentApp","upsert","removeTemplate","generationUserSelection","resource","copyAppSelectedCustomers","templateAppId","removeAllCustomers","updateLocalSenseCopyApps","updateLocalSenseCopyStreams","updateLocalSenseCopy"],"mappings":";;;;;;;;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4H;;;;;;;;;;;;;;;;;ACfA,IAAMA,UAAQC,MAAd;AAAqBD,QAAQE,MAAR,CAAe;AAACC,0BAAqB;AAAA,eAAIA,oBAAJ;AAAA,KAAtB;AAA+CC,uBAAkB;AAAA,eAAIA,iBAAJ;AAAA,KAAjE;AAAuFC,gBAAW;AAAA,eAAIA,UAAJ;AAAA,KAAlG;AAAiHC,oBAAe;AAAA,eAAIA,cAAJ;AAAA;AAAhI,CAAf;AAAoK,IAAIC,eAAJ;AAAWP,QAAQQ,KAAR,CAAcC,QAAQ,eAAR,CAAd,EAAuC;AAACF,UAAD,YAAQG,CAAR,EAAU;AAACH,iBAAOG,CAAP;AAAS;AAApB,CAAvC,EAA6D,CAA7D;AAAgE,IAAIC,kBAAJ;AAAA,IAAcC,uBAAd;AAAA,IAA6BC,sBAA7B;AAA2Cb,QAAQQ,KAAR,CAAcC,QAAQ,wBAAR,CAAd,EAAgD;AAACE,aAAD,YAAWD,CAAX,EAAa;AAACC,oBAAUD,CAAV;AAAY,KAA1B;AAA2BE,kBAA3B,YAA0CF,CAA1C,EAA4C;AAACE,yBAAeF,CAAf;AAAiB,KAA9D;AAA+DG,iBAA/D,YAA6EH,CAA7E,EAA+E;AAACG,wBAAcH,CAAd;AAAgB;AAAhG,CAAhD,EAAkJ,CAAlJ;AAAqJ,IAAII,iBAAJ;AAAad,QAAQQ,KAAR,CAAcC,QAAQ,sBAAR,CAAd,EAA8C;AAACK,YAAD,YAAUJ,CAAV,EAAY;AAACI,mBAASJ,CAAT;AAAW;AAAxB,CAA9C,EAAwE,CAAxE;AAA2E,IAAIK,oBAAJ;AAAgBf,QAAQQ,KAAR,CAAcC,QAAQ,uBAAR,CAAd,EAA+C;AAACM,eAAD,YAAaL,CAAb,EAAe;AAACK,sBAAYL,CAAZ;AAAc;AAA9B,CAA/C,EAA+E,CAA/E;AAAkF,IAAIM,oBAAJ;AAAA,IAAgBC,2BAAhB;AAAA,IAAmCC,oBAAnC;AAAA,IAA+CC,kBAA/C;AAAA,IAAyDC,gBAAzD;AAAA,IAAiEC,sBAAjE;AAAA,IAA+EC,yBAA/E;AAAA,IAAgGC,qBAAhG;AAA6GvB,QAAQQ,KAAR,CAAcC,QAAQ,wBAAR,CAAd,EAAgD;AAACO,eAAD,YAAaN,CAAb,EAAe;AAACM,sBAAYN,CAAZ;AAAc,KAA9B;AAA+BO,sBAA/B,YAAkDP,CAAlD,EAAoD;AAACO,6BAAmBP,CAAnB;AAAqB,KAA1E;AAA2EQ,eAA3E,YAAuFR,CAAvF,EAAyF;AAACQ,sBAAYR,CAAZ;AAAc,KAAxG;AAAyGS,aAAzG,YAAmHT,CAAnH,EAAqH;AAACS,oBAAUT,CAAV;AAAY,KAAlI;AAAmIc,UAAnI,YAA0Id,CAA1I,EAA4I;AAACU,kBAAQV,CAAR;AAAU,KAAvJ;AAAwJW,iBAAxJ,YAAsKX,CAAtK,EAAwK;AAACW,wBAAcX,CAAd;AAAgB,KAAzL;AAA0LY,oBAA1L,YAA2MZ,CAA3M,EAA6M;AAACY,2BAAiBZ,CAAjB;AAAmB,KAAjO;AAAkOa,gBAAlO,YAA+Ob,CAA/O,EAAiP;AAACa,uBAAab,CAAb;AAAe;AAAjQ,CAAhD,EAAmT,CAAnT;AAAsT,IAAIe,eAAJ;AAAWzB,QAAQQ,KAAR,CAAcC,QAAQ,QAAR,CAAd,EAAgC;AAAA,yBAASC,CAAT,EAAW;AAACe,iBAAOf,CAAP;AAAS;AAArB,CAAhC,EAAuD,CAAvD;;AAc5iC,IAAIgB,KAAKjB,QAAQ,UAAR,CAAT;;AACA,IAAMkB,OAAOlB,QAAQ,MAAR,CAAb;;AACA,IAAImB,KAAKnB,QAAQ,IAAR,CAAT;;AACA,IAAIoB,KAAKpB,QAAQ,IAAR,CAAT,C,CAEA;AACA;AACA;;;AAcAqB,IAAIL,MAAJ,C,CAEA;AACA;AACA;AAEA;;AACO,SAAetB,oBAAf;AAAA,8GAyCM4B,kBAzCN;;AAAA;AAAA;AAAA;AAAA;AAAA;AAyCMA,0CAzCN;AAAA,qCAyCMA,kBAzCN,CAyCyBC,YAzCzB,EAyCuC;AAEtC;AACAA,6CAAaC,wBAAb,GAAwC,CAAC;AACrCC,wCAAIC,6BAA6BD;AADI,iCAAD,CAAxC;;AAGA,oCAAI;AACAE,0CAAMJ,YAAN,EAAoBK,MAApB;AACAC,4CAAQC,GAAR,CAAY,8BAAZ,EAA4CP,aAAaQ,MAAzD;AAEA,wCAAIC,UAAUrB,UAAU,0BAAxB;AACAsB,+CAAWC,KAAKC,IAAL,CAAU,MAAV,EAAkBH,OAAlB,EAA2B;AAClCI,gDAAQ;AACJC,oDAAQ9B,YAAY8B;AADhB,yCAD0B;AAIlC,6DAAqBxB,gBAJa;AAKlCyB,8CAAMf;AAL4B,qCAA3B,CAAX;AAOA,2CAAOU,SAASK,IAAhB;AACH,iCAbD,CAaE,OAAOC,GAAP,EAAY;AACVV,4CAAQW,KAAR,CAAc,6BAAd,EAA6CD,GAA7C;AACH,iCArBqC,CAsBtC;;AACH;;AAhEE,mCAyCMjB,kBAzCN;AAAA;;AACHO,gCAAQC,GAAR,CAAY,sCAAZ;AACAD,gCAAQC,GAAR,CAAY,wBAAZ;AACAD,gCAAQC,GAAR,CAAY,sCAAZ;AACIW,4BAJD,GAIQvB,KAAKwB,IAAL,CAAU5C,OAAO6C,QAAP,CAAgBC,MAAhB,CAAuBC,oBAAjC,EAAuD,OAAvD,EAAgE,QAAhE,EAA0E,2BAA1E,CAJR;AAAA;AAAA;AAAA,2DAO2B5B,GAAG6B,QAAH,CAAYL,IAAZ,CAP3B;;AAAA;AAOKM,qCAPL;AAAA;AASKjC,qCAAaiC,aAAb;AATL;AAAA;;AAAA;AAAA;AAAA;AAAA,8BAWW,IAAIC,KAAJ,CAAU,mGAAV,CAXX;;AAAA;AAAA,oCAewBD,aAfxB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAeUE,kCAfV;;AAgBK,4BAAIA,WAAWC,6BAAf,EAA8C;AAC1CD,uCAAWC,6BAAX,CAAyCC,IAAzC,CAA8CrD,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBC,aAArE;AACAJ,uCAAWC,6BAAX,CAAyCC,IAAzC,CAA8C/B,GAAGkC,OAAH,EAA9C;AACAL,uCAAWC,6BAAX,CAAyCC,IAAzC,CAA8ChC,GAAGoC,QAAH,EAA9C;AACH;;AACGC,uCArBT,GAqB2B7D,mBArB3B,EAuBK;;AACI8D,6BAxBT,GAwBiBD,gBAAgBE,IAAhB,CAAqB,UAASC,UAAT,EAAqB;AAClD,mCAAOA,WAAW5B,MAAX,KAAsBkB,WAAWlB,MAAxC;AACH,yBAFW,CAxBjB;;AA2BK,4BAAI,CAAC0B,KAAL,EAAY;AACJlC,wCADI,GACWD,mBAAmB2B,UAAnB,CADX,EAER;;AACAW,oDAAwBrC,YAAxB;AACH,yBAJD,MAIO;AACHM,oCAAQC,GAAR,CAAY,mBAAmBmB,WAAWlB,MAA9B,GAAuC,mDAAnD;AACH;;AAjCN;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAoCCF,gCAAQW,KAAR;AApCD,8BAqCO,IAAIQ,KAAJ,CAAU,kCAAV,cArCP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAmEP;AACA,SAASY,uBAAT,CAAiCrC,YAAjC,EAA+C;AAC3C;AAEA;AACA,QAAIsC,UAAUC,YAAd,CAJ2C,CAK3C;;AACA,QAAIC,cAAcC,6BAA6BH,OAA7B,CAAlB,CAN2C,CAOvC;;AACJE,gBAAYpB,QAAZ,CAAqBsB,cAArB,CAAoCd,IAApC,CAAyC5B,YAAzC,EAR2C,CAU3C;;AACAwC,gBAAYpB,QAAZ,CAAqBuB,qBAArB,GAA6CpE,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBe,aAApE,CAX2C,CAWwC;;AACnFJ,gBAAYpB,QAAZ,CAAqByB,UAArB,GAAkCtE,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBiB,mBAAzD,CAZ2C,CAYmC;;AAC9EN,gBAAYpB,QAAZ,CAAqB2B,SAArB,GAAiCxE,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBmB,kBAAxD,CAb2C,CAe3C;;AACAC,gBAAYX,OAAZ,EAAqBE,WAArB;AACH;;AAED,SAASS,WAAT,CAAqBX,OAArB,EAA8BE,WAA9B,EAA2C;AACvC,QAAI;AACApC,cAAMkC,OAAN,EAAeY,MAAf;AACA9C,cAAMoC,WAAN,EAAmBnC,MAAnB;AACAC,gBAAQC,GAAR,CAAY,aAAZ,EAA2BiC,YAAYpB,QAAZ,CAAqBsB,cAAhD;AAEA,YAAIjC,UAAUrB,UAAU,oBAAV,GAAiCkD,OAA/C;AACA5B,mBAAWC,KAAKC,IAAL,CAAU,KAAV,EAAiBH,OAAjB,EAA0B;AACjCI,oBAAQ;AACJC,wBAAQ9B,YAAY8B;AADhB,aADyB;AAIjC,iCAAqBxB,gBAJY;AAKjCyB,kBAAMyB;AAL2B,SAA1B,CAAX;AAOH,KAbD,CAaE,OAAOxB,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAc,6BAAd,EAA6CD,GAA7C;AACH;AACJ;;AAED,SAASuB,UAAT,GAAsB;AAClB,QAAI;AACA,YAAI9B,UAAUrB,UAAU,4BAAV,GAAyCJ,YAAY8B,MAAnE;AACAJ,mBAAWC,KAAKC,IAAL,CAAU,KAAV,EAAiBH,OAAjB,EAA0B;AACjC,iCAAqBnB;AADY,SAA1B,CAAX;AAGA,eAAOoB,SAASK,IAAT,CAAc,CAAd,EAAiBb,EAAxB;AACH,KAND,CAME,OAAOc,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAc,6BAAd,EAA6CD,GAA7C;AACH;AACJ;;AAED,SAASyB,4BAAT,CAAsCH,OAAtC,EAA+C;AAE3C,QAAI;AACAlC,cAAMkC,OAAN,EAAeY,MAAf;AAEA,YAAIzC,UAAUrB,UAAU,oBAAV,GAAiCkD,OAAjC,GAA2C,UAA3C,GAAwDtD,YAAY8B,MAAlF;AACAJ,mBAAWC,KAAKC,IAAL,CAAU,KAAV,EAAiBH,OAAjB,EAA0B;AACjC,iCAAqBnB;AADY,SAA1B,CAAX,CAJA,CAQA;;AACA,YAAI4B,OAAOvB,KAAKwB,IAAL,CAAU5C,OAAO6C,QAAP,CAAgBC,MAAhB,CAAuBC,oBAAjC,EAAuD,OAAvD,EAAgE,QAAhE,EAA0E,gCAA1E,CAAX;AACA5B,WAAGyD,UAAH,CAAcjC,IAAd,EAAoBkC,KAAKC,SAAL,CAAe3C,SAASK,IAAxB,EAA8B,IAA9B,EAAoC,CAApC,CAApB,EAA4D,OAA5D;AAEA,eAAOL,SAASK,IAAhB;AACH,KAbD,CAaE,OAAOC,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAc,6BAAd,EAA6CD,GAA7C;AACH;AACJ;;AAEM,SAAS5C,iBAAT,GAA6B;AAChC;AACA,QAAI;AACA,YAAIqC,UAAUrB,UAAU,0BAAxB;AACAsB,mBAAWC,KAAKC,IAAL,CAAU,KAAV,EAAiBH,OAAjB,EAA0B;AACjCI,oBAAQ;AACJC,wBAAQ9B,YAAY8B;AADhB,aADyB;AAIjCwC,+BAAmBhE;AAJc,SAA1B,CAAX;AAOA,YAAI4B,OAAOvB,KAAKwB,IAAL,CAAU5C,OAAO6C,QAAP,CAAgBC,MAAhB,CAAuBC,oBAAjC,EAAuD,OAAvD,EAAgE,QAAhE,EAA0E,uCAA1E,CAAX,CATA,CAWA;;AACA5B,WAAGyD,UAAH,CAAcjC,IAAd,EAAoBkC,KAAKC,SAAL,CAAe3C,SAASK,IAAxB,EAA8B,IAA9B,EAAoC,CAApC,CAApB,EAA4D,OAA5D;AACA,eAAOL,SAASK,IAAhB;AACH,KAdD,CAcE,OAAOC,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAc,6BAAd,EAA6CD,GAA7C;AACH;AACJ;;AAED;AACA;AACA;AAGA,SAASb,0BAAT,GAAsC;AAClC,QAAI;AACA,YAAIM,UAAUrB,UAAU,4CAAV,GAAyDJ,YAAY8B,MAAnF;AACAJ,mBAAWC,KAAKC,IAAL,CAAU,KAAV,EAAiBH,OAAjB,EAA0B;AACjC,iCAAqBnB;AADY,SAA1B,CAAX;AAGA,eAAOoB,SAASK,IAAhB;AACH,KAND,CAME,OAAOC,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAc,6BAAd,EAA6CD,GAA7C;AACH;AACJ,C,CAED;AACA;AACA;;;AAGAzC,OAAOgF,OAAP,CAAe;AACXC,yBADW,cACa;AACpB;AACA,YAAI5C,OAAO,EAAX;AACAA,aAAK6C,MAAL,GAAc,kDAAd;AACA7C,aAAKH,OAAL,GAAe,oMAAf;AACA3B,iBAAS8B,IAAT,EAAerC,OAAOmF,MAAP,EAAf,EALoB,CAOpB;;AACA,YAAIC,WAAWhF,UAAUiF,OAAV,CAAkB;AAC7BC,8BAAkBtF,OAAOmF,MAAP,EADW;AAE7B,uCAA2B;AAFE,SAAlB,CAAf,CARoB,CAYpB;AAEA;;AACA,YAAII,IAAJ;;AACA,YAAI,CAACH,QAAL,EAAe;AAAE;AACb;AACA,gBAAIjD,WAAW,EAAf,CAFW,CAGX;;AACAA,qBAASoD,IAAT,GAAgBjF,cAAciF,IAA9B;AACApD,qBAASiD,QAAT,GAAoB9E,aAApB,CALW,CAMX;AACH,SAPD,MAOO;AACH,gBAAIiF,OAAOhE,EAAEiE,IAAF,CAAOJ,SAASK,KAAhB,EAAuB;AAC9B,qCAAqB;AADS,aAAvB,CAAX;;AAGA,gBAAItD,WAAW,EAAf;AACAA,qBAASoD,IAAT,GAAgBA,IAAhB;AACApD,qBAASiD,QAAT,GAAoBA,QAApB;AACH,SA9BmB,CA+BpB;;;AACA,eAAOjD,QAAP;AACH,KAlCU;AAmCXuD,kBAnCW,YAmCIC,YAnCJ,EAmCkBC,QAnClB,EAmC4BC,YAnC5B,EAmC0C;AACjD,YAAI1D,WAAWnC,OAAOqC,IAAP,CAAY,uBAAZ,CAAf;AACA,YAAI+C,WAAWjD,SAASiD,QAAxB;AACA,YAAIG,OAAOpD,SAASoD,IAApB,CAHiD,CAKjD;AACA;;AACA,YAAIO,WAAW;AACX,6BAAiB9F,OAAOmF,MAAP,EADN;AACuB;AAClC,sBAAUI,KAAKQ,IAFJ;AAEU;AACrB,0BAAc,CAAC;AACP,yBAASX,SAASW,IAAT,CAAcC,WAAd;AADF,aAAD,EAEP;AACH;AACI,yBAAST,KAAKU,OAAL,CAAaD,WAAb;AADb,aAHU,EAMV;AACI,yBAAST,KAAKW,KAAL,CAAWF,WAAX;AADb,aANU;AAHH,SAAf,CAPiD,CAqBjD;AAEA;;AACA,YAAI3D,OAAO,EAAX;AACAA,aAAK6C,MAAL,GAAc,iGAAd;AACA7C,aAAK8D,GAAL,GAAW3F,YAAY4F,cAAvB;AACA/D,aAAKH,OAAL,GAAe,kHAAkH2C,KAAKC,SAAL,CAAegB,QAAf,CAAjI;AACAvF,iBAAS8B,IAAT,EAAerC,OAAOmF,MAAP,EAAf;AAEA,eAAOpF,eAAe+F,QAAf,EAAyBH,YAAzB,EAAuCC,QAAvC,EAAiD5F,OAAOmF,MAAP,EAAjD,CAAP;AACH,KAlEU;AAmEXkB,mBAnEW,YAmEKC,cAnEL,EAmEqB7E,YAnErB,EAmEmC;AAAE;AAC5C,YAAI;AACA;AACAI,kBAAMyE,eAAeJ,KAArB,EAA4BvB,MAA5B;AACH,SAHD,CAGE,OAAOlC,GAAP,EAAY;AACV,kBAAM,IAAIzC,OAAOkD,KAAX,CAAiB,8CAAjB,EAAiE,uJAAjE,CAAN;AACH;;AACD,YAAI4C,WAAW;AACX,6BAAiB9F,OAAOmF,MAAP,EADN;AACuB;AAClC,sBAAUnF,OAAOmF,MAAP,EAFC;AAEgB;AAC3B,0BAAc,CAAC;AACP,yBAAS;AADF,aAAD,EAEP;AACH;AACI,yBAASmB,eAAeJ;AAD5B,aAHU,EAMV;AACI,yBAAS;AADb,aANU;AAHH,SAAf,CAP0C,CAqB1C;;AACA,eAAOlG,OAAOqC,IAAP,CAAY,2BAAZ,EAAyCZ,YAAzC,EAAuDqE,QAAvD,CAAP;AACH,KA1FU;AA2FX;AACAS,6BA5FW,YA4Fe9E,YA5Ff,EA4F6BqE,QA5F7B,EA4FuC;AAC9C/D,gBAAQC,GAAR,CAAY,0BAAZ,EAAwC8D,QAAxC,EAD8C,CAG9C;;AACA,YAAIU,oBAAoB,aAAa/F,YAAYgG,IAAzB,GAAgC,GAAhC,GAAsCzG,OAAO6C,QAAP,CAAgB6D,OAAhB,CAAwBC,SAA9D,GAA0E,OAA1E,GAAoFlF,YAApF,GAAmG,SAA3H,CAJ8C,CAIwF;;AACtI,YAAI;AACA,gBAAIU,WAAWC,KAAKC,IAAL,CAAU,MAAV,EAAkBmE,iBAAlB,EAAqC;AAChD,qCAAqBzF,gBAD2B;AAEhD6F,yBAASjG,WAFuC;AAGhD2B,wBAAQ;AACJ,8BAAU7B,YAAY8B;AADlB,iBAHwC;AAMhDC,sBAAMsD,QAN0C,CAMhC;;AANgC,aAArC,CAAf;AAQH,SATD,CASE,OAAOrD,GAAP,EAAY;AACVV,oBAAQW,KAAR,CAAc,sCAAd,EAAsDD,GAAtD;AACA,kBAAM,IAAIzC,OAAOkD,KAAX,CAAiB,uBAAjB,EAA0CT,IAAIoE,OAA9C,CAAN;AACH;;AACD,eAAO1E,SAASK,IAAT,CAAcsE,MAArB;AACH,KA/GU;AAgHXC,qBAhHW,cAgHS;AAChB;AACA;AAEA;AACA3G,kBAAUoF,IAAV,CAAe;AACP,gCAAoBxF,OAAOmF,MAAP;AADb,SAAf,EAGK6B,OAHL,CAGa,UAAS5B,QAAT,EAAmB;AACxB,gBAAI6B,eAAe1F,EAAE2F,GAAF,CAAM9B,SAASK,KAAf,EAAsB,UAASF,IAAT,EAAe;AACpD,oBAAIA,IAAJ,EAAU;AACNA,yBAAK4B,iBAAL,GAAyB,KAAzB;AACH,iBAHmD,CAKpD;;;AACArH,2BAAWE,OAAOmF,MAAP,EAAX,EAA4BI,KAAKQ,IAAjC;AACA,uBAAOR,IAAP;AACH,aARkB,CAAnB;;AAUAnF,sBAAUgH,MAAV,CAAiBhC,SAASiC,GAA1B,EAA+B;AAC3BC,sBAAM;AACF7B,2BAAOwB;AADL;AADqB,aAA/B;AAKH,SAnBL,EALgB,CAyBhB;AACH,KA1IU;AA2IXM,0BA3IW,YA2IYC,GA3IZ,EA2IiBzB,IA3IjB,EA2IuB;AAC9BhE,gBAAQC,GAAR,CAAY,mCAAZ,EAAiDwF,GAAjD,EAAsDzB,IAAtD;AACAjG,mBAAW0H,GAAX,EAAgBzB,IAAhB,EAAsB/F,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBmE,cAAvB,CAAsChG,YAA5D;AACH,KA9IU;AA+IXiG,qCA/IW,YA+IuBF,GA/IvB,EA+I4BzB,IA/I5B,EA+IkC;AACzChE,gBAAQC,GAAR,CAAY,oDAAZ,EAAkEwF,GAAlE,EAAuEzB,IAAvE;AACAjG,mBAAW0H,GAAX,EAAgBzB,IAAhB,EAAsB/F,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBqE,uBAA7C;AACH,KAlJU;AAmJXC,qBAnJW,YAmJO7B,IAnJP,EAmJa;AACpBlE,cAAMkE,IAAN,EAAYpB,MAAZ;AACA3E,eAAOqC,IAAP,CAAY,mBAAZ,EAFoB,CAGpB;;AACA,YAAIwF,QAAQ,CAAC;AACT,gCAAoB7H,OAAOmF,MAAP,EADX;AAET,0BAAcY;AAFL,SAAD,EAGT;AACCuB,kBAAM;AACF,6CAA6B;AAD3B;AADP,SAHS,CAAZ;AASAlH,kBAAUgH,MAAV,CAAiB;AACb,gCAAoBpH,OAAOmF,MAAP,EADP;AAEb,0BAAcY;AAFD,SAAjB,EAGG;AACCuB,kBAAM;AACF,6CAA6B;AAD3B;AADP,SAHH,EAOG,EAPH,EAOO,UAAS5E,KAAT,EAAgBoF,uBAAhB,EAAyC;AAC5C,gBAAIA,4BAA4B,CAAhC,EAAmC;AAAE;AACjC;AACA;AACAC,qCAAqB/H,OAAOmF,MAAP,EAArB;AACA/E,0BAAUgH,MAAV,CAAiB;AACb,wCAAoBpH,OAAOmF,MAAP,EADP;AAEb,kCAAcY;AAFD,iBAAjB,EAGG;AACCuB,0BAAM;AACF,qDAA6B;AAD3B;AADP,iBAHH;AAQH;AACJ,SArBD;AAsBH;AAtLU,CAAf;AAyLAtH,OAAOgF,OAAP,CAAe;AACX,+BADW,YACkBO,IADlB,EACwB;AAC/B,YAAI;AACA;AACA1D,kBAAM0D,KAAKyC,KAAX,EAAkBrD,MAAlB;AACA9C,kBAAM0D,KAAK0C,QAAX,EAAqBtD,MAArB;AACH,SAJD,CAIE,OAAOlC,GAAP,EAAY;AACV,kBAAM,IAAIzC,OAAOkD,KAAX,CAAiB,4BAAjB,EACF,iEADE,CAAN;AAEH;;AACD,YAAMgF,aAAaC,SAASC,eAAT,CAAyB7C,KAAKyC,KAA9B,CAAnB;AACA,YAAI7C,SAAS,EAAb;;AACA,YAAII,KAAKyC,KAAL,KAAe,cAAnB,EAAmC;AAC/B,kBAAM,IAAIhI,OAAOkD,KAAX,CAAiB,eAAjB,EAAkC,8CAAlC,CAAN;AACH,SAFD,MAEO,IAAIgF,UAAJ,EAAgB;AACnB;AACA/C,qBAAS+C,WAAWb,GAApB;AACAc,qBAASE,WAAT,CAAqBlD,MAArB,EAA6BI,KAAK0C,QAAlC;AACH,SAJM,MAIA;AACH9C,qBAASgD,SAASG,UAAT,CAAoB/C,IAApB,CAAT;AACAgD,kBAAMC,eAAN,CAAsBrD,MAAtB,EAA8B,CAAC,WAAD,CAA9B,EAA6C,QAA7C,EAFG,CAEqD;AAC3D;;AACD,eAAOA,MAAP;AACH;AAvBU,CAAf;;AA0BA,SAAS4C,oBAAT,CAA8BzC,gBAA9B,EAAgD;AAC5C;AACA/D,MAAEkH,IAAF,CAAOpI,cAAP,EAAuB,UAAS+E,QAAT,EAAmB;AACtCA,iBAASE,gBAAT,GAA4BA,gBAA5B;AACAlF,kBAAUsI,MAAV,CAAiBtD,QAAjB;AACH,KAHD;AAIH,C,CAED;;;AACO,SAAStF,UAAT,CAAoB0H,GAApB,EAAyBzB,IAAzB,EAA+B4C,KAA/B,EAAsC;AACzC,QAAI,CAACA,KAAL,EAAY;AACRA,gBAAQlI,YAAYkH,uBAApB;AACH,KAHwC,CAGvC;AACF;;;AAEA,QAAI5B,IAAJ,EAAU;AACN;AACA;AACA,YAAI;AACA,gBAAM1D,OAAO,EAAb;AACAA,iBAAK6C,MAAL,GAAc,kBAAkBa,IAAhC;AACA1D,iBAAK8D,GAAL,GAAW3F,YAAYV,UAAvB;AACAuC,iBAAKH,OAAL,GAAe,aAAazB,YAAYmI,wBAAzB,GAAoD,YAApD,GAAmED,KAAnE,GAA2E,QAA3E,GAAsFnB,GAAtF,GAA4F,GAA5F,GAAkGzB,IAAlG,GAAyG,UAAzG,GAAsHtF,YAAY8B,MAAjJ;AACAF,iBAAKF,QAAL,GAAgBC,KAAKC,IAAL,CAAU,QAAV,EAAoBA,KAAKH,OAAzB,EAAkC;AAC9C,qCAAqBnB;AADyB,aAAlC,CAAhB;AAIAR,qBAAS8B,IAAT,EAAemF,GAAf,EATA,CASqB;AACrB;AACA;AACH,SAZD,CAYE,OAAO/E,GAAP,EAAY;AACVV,oBAAQW,KAAR,CAAcD,GAAd;AACA,kBAAM,IAAIzC,OAAOkD,KAAX,CAAiB,oBAAjB,EAAuCT,IAAIoE,OAA3C,CAAN;AACH;AACJ;AACJ;;AAGM,SAAS9G,cAAT,CAAwB+F,QAAxB,EAAkCH,YAAlC,EAAgDC,QAAhD,EAA0DN,gBAA1D,EAA4E;AAC/EzD,UAAMiE,QAAN,EAAgBhE,MAAhB;AACAD,UAAM8D,YAAN,EAAoBhB,MAApB;AACA9C,UAAM+D,QAAN,EAAgBjB,MAAhB;AACA9C,UAAMyD,gBAAN,EAAwBX,MAAxB,EAJ+E,CAM/E;AACA;;AAEA,QAAIkE,oBAAoB/C,QAAxB;AACA+C,sBAAkBC,QAAlB,GAA6BlD,QAA7B,CAV+E,CAW/E;;AAEA,QAAI;AACA,YAAIvD,OAAO,EAAX;AACAA,aAAK6C,MAAL,GAAc,6DAA6DS,YAA3E;AACAtD,aAAKH,OAAL,GAAeyD,eAAe,QAA9B,CAHA,CAGwC;;AACxCtD,aAAK8D,GAAL,GAAW3F,YAAYuI,aAAvB;AACA1G,aAAKF,QAAL,GAAgBC,KAAKC,IAAL,CAAU,MAAV,EAAkBA,KAAKH,OAAvB,EAAgC;AAC5C,iCAAqBnB,gBADuB;AAE5C6F,qBAASjG,WAFmC;AAG5C2B,oBAAQ;AACJ,0BAAU7B,YAAY8B;AADlB,aAHoC;AAM5CC,kBAAMsD,QANsC,CAM5B;;AAN4B,SAAhC,CAAhB;AAQAvF,iBAAS8B,IAAT,EAAeiD,gBAAf;AACH,KAdD,CAcE,OAAO7C,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAc,sCAAd,EAAsDD,GAAtD;AACA,cAAM,IAAIzC,OAAOkD,KAAX,CAAiB,uBAAjB,EAA0CT,IAAIoE,OAA9C,CAAN;AACH,KA9B8E,CAgC/E;AACA;;;AACA,QAAImC,iBAAiB3G,KAAKF,QAAL,CAAcK,IAAnC;AACAH,SAAK6C,MAAL,GAAc,qEAAd;AACA7C,SAAKH,OAAL,GAAe,2GAA2G8G,eAAeC,SAA1H,GAAsI,cAAtI,GAAuJD,eAAelC,MAAtK,GAA+K,mBAA/K,GAAqMkC,cAApN;AACAzI,aAAS8B,IAAT,EArC+E,CAwC/E;;AACA,QAAI2G,eAAeC,SAAf,CAAyBC,OAAzB,CAAiC,GAAjC,IAAwC,CAA5C,EAA+C;AAC3CC,sBAAcH,eAAeC,SAAf,GAA2B,cAA3B,GAA4CD,eAAelC,MAAzE;AACH,KAFD,MAEO;AACHqC,sBAAcH,eAAeC,SAAf,GAA2B,cAA3B,GAA4CD,eAAelC,MAAzE;AACH;;AAED,QAAI,CAACqC,WAAL,EAAkB;AACdA,sBAAc,YAAY1I,YAAYgG,IAAxB,GAA+B,GAA/B,GAAqChG,YAAY2I,IAAjD,GAAwD,GAAxD,GAA8D3I,YAAYkH,uBAA1E,GAAoG,GAApG,GAA0G0B,GAAxH;AACH,KAjD8E,CAkD/E;;;AACA,WAAOF,WAAP;AACH,6H;;;;;;;;;;;AC5gBD,IAAM1J,UAAQC,MAAd;AAAqBD,QAAQE,MAAR,CAAe;AAAC2J,WAAM;AAAA,eAAIA,KAAJ;AAAA;AAAP,CAAf;AAAkC,IAAItJ,eAAJ;AAAWP,QAAQQ,KAAR,CAAcC,QAAQ,eAAR,CAAd,EAAuC;AAACF,UAAD,YAAQG,CAAR,EAAU;AAACH,iBAAOG,CAAP;AAAS;AAApB,CAAvC,EAA6D,CAA7D;AAAgE,IAAIoJ,aAAJ;AAAS9J,QAAQQ,KAAR,CAAcC,QAAQ,eAAR,CAAd,EAAuC;AAACqJ,QAAD,YAAMpJ,CAAN,EAAQ;AAACoJ,eAAKpJ,CAAL;AAAO;AAAhB,CAAvC,EAAyD,CAAzD;AAA4D,IAAIY,yBAAJ;AAAA,IAAqBN,oBAArB;AAAA,IAAiCE,oBAAjC;AAAA,IAA6CM,eAA7C;AAAoDxB,QAAQQ,KAAR,CAAcC,QAAQ,qBAAR,CAAd,EAA6C;AAACa,oBAAD,YAAkBZ,CAAlB,EAAoB;AAACY,2BAAiBZ,CAAjB;AAAmB,KAAxC;AAAyCM,eAAzC,YAAqDN,CAArD,EAAuD;AAACM,sBAAYN,CAAZ;AAAc,KAAtE;AAAuEQ,eAAvE,YAAmFR,CAAnF,EAAqF;AAACQ,sBAAYR,CAAZ;AAAc,KAApG;AAAqGc,UAArG,YAA4Gd,CAA5G,EAA8G;AAACc,iBAAOd,CAAP;AAAS;AAAxH,CAA7C,EAAuK,CAAvK;;AASpP,IAAImJ;AAAQ,aAASE,SAAT,GAAqB;AAEpC,aAAKC,GAAL;AAAW,qBAASA,GAAT,CAAarI,IAAb,EAA2C;AAAA,oBAAxBkB,MAAwB,uEAAf,EAAe;AAAA,oBAAXE,IAAW,uEAAJ,EAAI;AAClD,oBAAIkH,WAAWC,UAAUvI,IAAV,CAAf;AACAW,wBAAQC,GAAR,CAAY,8CAAZ,EAA4D0H,QAA5D,EAFkD,CAIlD;;AACA,oBAAIE,YAAY9H,OAAO+H,MAAP,CAAc;AAAEtH,4BAAQ9B,YAAY8B;AAAtB,iBAAd,EAA8CD,MAA9C,CAAhB;;AACA,oBAAI;AACA,wBAAIH,WAAWC,KAAKqH,GAAL,CAASC,QAAT,EAAmB;AAC9B3E,2CAAmBhE,gBADW;AAE9BuB,gCAAQsH,SAFsB;AAG9BpH,8BAAM;AAHwB,qBAAnB,CAAf;AAKA,2BAAOL,SAASK,IAAhB;AACH,iBAPD,CAOE,OAAOC,GAAP,EAAY;AACV,wBAAIC,QAAQ,6BAA6BgH,QAAzC;AACA3H,4BAAQW,KAAR,CAAcD,GAAd;AACA,0BAAM,IAAIzC,OAAOkD,KAAX,CAAiB,GAAjB,EAAsBR,KAAtB,CAAN;AACH;AACJ;;AAlBD,mBAAoB+G,GAApB;AAAA;;AAoBA,aAAKK,IAAL;AAAY,qBAASA,IAAT,CAAc1I,IAAd,EAA4C;AAAA,oBAAxBkB,MAAwB,uEAAf,EAAe;AAAA,oBAAXE,IAAW,uEAAJ,EAAI;AACpD,oBAAIkH,WAAWC,UAAUvI,IAAV,CAAf,CADoD,CAGpD;;AACA,oBAAIwI,YAAY9H,OAAO+H,MAAP,CAAc;AAAE,8BAAUpJ,YAAY8B;AAAxB,iBAAd,EAAgDD,MAAhD,CAAhB;;AACA,oBAAI;AACA,wBAAIH,WAAWC,KAAK0H,IAAL,CAAUJ,QAAV,EAAoB;AAC/B3E,2CAAmBhE,gBADY;AAE/BuB,gCAAQsH,SAFuB;AAG/BpH,8BAAMA;AAHyB,qBAApB,CAAf;AAKA,2BAAOL,SAASK,IAAhB;AACH,iBAPD,CAOE,OAAOC,GAAP,EAAY;AACVV,4BAAQW,KAAR,CAAc,0BAA0BgH,QAAxC,EAAkDjH,GAAlD;AACH;AACJ;;AAfD,mBAAqBqH,IAArB;AAAA;;AAiBA,aAAKC,GAAL;AAAW,qBAASA,GAAT,CAAa3I,IAAb,EAA2C;AAAA,oBAAxBkB,MAAwB,uEAAf,EAAe;AAAA,oBAAXE,IAAW,uEAAJ,EAAI;AAClD,oBAAIkH,WAAWC,UAAUvI,IAAV,CAAf;AACAW,wBAAQC,GAAR,CAAY,UAAZ,EAAwB0H,QAAxB;AACA3H,wBAAQC,GAAR,CAAY,MAAZ,EAAoBQ,IAApB,EAHkD,CAKlD;;AACA,oBAAIoH,YAAY9H,OAAO+H,MAAP,CAAc;AAAEtH,4BAAQ9B,YAAY8B;AAAtB,iBAAd,EAA8CD,MAA9C,CAAhB;;AACA,oBAAI;AACA,wBAAIH,WAAWC,KAAK2H,GAAL,CAASL,QAAT,EAAmB;AAC9B3E,2CAAmBhE,gBADW;AAE9BuB,gCAAQsH,SAFsB;AAG9BpH,8BAAMA;AAHwB,qBAAnB,CAAf,CADA,CAMA;;AACA,2BAAOL,SAASK,IAAhB;AACH,iBARD,CAQE,OAAOC,GAAP,EAAY;AACVV,4BAAQW,KAAR,CAAc,6BAA6BgH,QAA3C,EAAqDjH,GAArD;AACH;AACJ;;AAlBD,mBAAoBsH,GAApB;AAAA;;AAoBA,aAAKC,GAAL;AAAW,qBAASA,GAAT,CAAa5I,IAAb,EAA2C;AAAA,oBAAxBkB,MAAwB,uEAAf,EAAe;AAAA,oBAAXE,IAAW,uEAAJ,EAAI;AAClD,oBAAIkH,WAAWC,UAAUvI,IAAV,CAAf,CADkD,CAGlD;;AACA,oBAAIwI,YAAY9H,OAAO+H,MAAP,CAAc;AAAE,8BAAUpJ,YAAY8B;AAAxB,iBAAd,EAAgDD,MAAhD,CAAhB;;AACA,oBAAI;AACA,wBAAIH,WAAWC,KAAK4H,GAAL,CAASN,QAAT,EAAmB;AAC9B3E,2CAAmBhE,gBADW;AAE9BuB,gCAAQsH,SAFsB;AAG9BpH,8BAAMA;AAHwB,qBAAnB,CAAf;AAKA,2BAAOL,SAASK,IAAhB;AACH,iBAPD,CAOE,OAAOC,GAAP,EAAY;AACVV,4BAAQW,KAAR,CAAc,yBAAyBgH,QAAvC,EAAiDjH,GAAjD;AACH;AACJ;;AAfD,mBAAoBuH,GAApB;AAAA;AAiBH;;AA5EU,WAAiBR,SAAjB;AAAA,GAAJ;;AA8EP,SAASG,SAAT,CAAmBvI,IAAnB,EAAyB;AACrB,QAAI;AACAS,cAAMT,IAAN,EAAYuD,MAAZ;AACH,KAFD,CAEE,OAAOlC,GAAP,EAAY;AACV,cAAMS,MAAM,8BAA8B9B,IAA9B,GAAqC,0CAA3C,CAAN;AACH;;AACD,WAAOH,SAASG,IAAhB;AACH,4H;;;;;;;;;;;;;;;;;AC9FD1B,OAAOC,MAAP,CAAc;AAACsK,kCAA6B;AAAA,eAAIA,4BAAJ;AAAA,KAA9B;AAA+DC,0BAAqB;AAAA,eAAIA,oBAAJ;AAAA,KAApF;AAA6GC,eAAU;AAAA,eAAIA,SAAJ;AAAA,KAAvH;AAAqIC,0BAAqB;AAAA,eAAIA,oBAAJ;AAAA,KAA1J;AAAmLC,yBAAoB;AAAA,eAAIA,mBAAJ;AAAA,KAAvM;AAA+NC,aAAQ;AAAA,eAAIA,OAAJ;AAAA,KAAvO;AAAmPC,aAAQ;AAAA,eAAIA,OAAJ;AAAA,KAA3P;AAAuQC,eAAU;AAAA,eAAIA,SAAJ;AAAA,KAAjR;AAA+RC,gBAAW;AAAA,eAAIA,UAAJ;AAAA,KAA1S;AAAyTC,eAAU;AAAA,eAAIA,SAAJ;AAAA;AAAnU,CAAd;AAAiW,IAAI1K,eAAJ;AAAWN,OAAOO,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACF,UAAD,YAAQG,CAAR,EAAU;AAACH,iBAAOG,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;AAA+D,IAAIoJ,aAAJ;AAAS7J,OAAOO,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACqJ,QAAD,YAAMpJ,CAAN,EAAQ;AAACoJ,eAAKpJ,CAAL;AAAO;AAAhB,CAAtC,EAAwD,CAAxD;AAA2D,IAAIwK,aAAJ;AAAA,IAASC,qBAAT;AAAA,IAAsBC,2BAAtB;AAAyCnL,OAAOO,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACyK,QAAD,YAAMxK,CAAN,EAAQ;AAACwK,eAAKxK,CAAL;AAAO,KAAhB;AAAiByK,gBAAjB,YAA8BzK,CAA9B,EAAgC;AAACyK,uBAAazK,CAAb;AAAe,KAAhD;AAAiD0K,sBAAjD,YAAoE1K,CAApE,EAAsE;AAAC0K,6BAAmB1K,CAAnB;AAAqB;AAA5F,CAA1C,EAAwI,CAAxI;AAA2I,IAAI2K,iBAAJ;AAAapL,OAAOO,KAAP,CAAaC,QAAQ,wCAAR,CAAb,EAA+D;AAAC,OAAD,YAAKC,CAAL,EAAO;AAAC2K,mBAAS3K,CAAT;AAAW;AAAnB,CAA/D,EAAoF,CAApF;AAAuF,IAAIK,oBAAJ;AAAgBd,OAAOO,KAAP,CAAaC,QAAQ,uBAAR,CAAb,EAA8C;AAACM,eAAD,YAAaL,CAAb,EAAe;AAACK,sBAAYL,CAAZ;AAAc;AAA9B,CAA9C,EAA8E,CAA9E;AAAiF,IAAI4K,gBAAJ;AAAYrL,OAAOO,KAAP,CAAaC,QAAQ,sBAAR,CAAb,EAA6C;AAAC6K,WAAD,YAAS5K,CAAT,EAAW;AAAC4K,kBAAQ5K,CAAR;AAAU;AAAtB,CAA7C,EAAqE,CAArE;AAAwE,IAAIC,kBAAJ;AAAcV,OAAOO,KAAP,CAAaC,QAAQ,wBAAR,CAAb,EAA+C;AAACE,aAAD,YAAWD,CAAX,EAAa;AAACC,oBAAUD,CAAV;AAAY;AAA1B,CAA/C,EAA2E,CAA3E;AAA8E,IAAIP,6BAAJ;AAAyBF,OAAOO,KAAP,CAAaC,QAAQ,kCAAR,CAAb,EAAyD;AAACN,wBAAD,YAAsBO,CAAtB,EAAwB;AAACP,+BAAqBO,CAArB;AAAuB;AAAhD,CAAzD,EAA2G,CAA3G;;AAA8G,IAAI6K,sBAAJ;AAAA,IAAkBvK,oBAAlB;AAAA,IAA8BC,2BAA9B;AAAA,IAAiDC,oBAAjD;AAAA,IAA6DM,eAA7D;AAAA,IAAoEgK,YAApE;AAAA,IAAwErK,kBAAxE;AAAA,IAAkFsK,iBAAlF;AAAA,IAA2FnK,yBAA3F;AAAA,IAA4GoK,6BAA5G;;AAAiIzL,OAAOO,KAAP,CAAaC,QAAQ,wBAAR,CAAb,EAA+C;AAAC8K,iBAAD,YAAe7K,CAAf,EAAiB;AAAC6K,wBAAc7K,CAAd;AAAgB,KAAlC;AAAmCM,eAAnC,YAA+CN,CAA/C,EAAiD;AAACM,sBAAYN,CAAZ;AAAc,KAAhE;AAAiEO,sBAAjE,YAAoFP,CAApF,EAAsF;AAACO,6BAAmBP,CAAnB;AAAqB,KAA5G;AAA6GQ,eAA7G,YAAyHR,CAAzH,EAA2H;AAACQ,sBAAYR,CAAZ;AAAc,KAA1I;AAA2Ic,UAA3I,YAAkJd,CAAlJ,EAAoJ;AAACc,iBAAOd,CAAP;AAAS,KAA9J;AAA+J8K,OAA/J,YAAmK9K,CAAnK,EAAqK;AAAC8K,cAAI9K,CAAJ;AAAM,KAA5K;AAA6KS,aAA7K,YAAuLT,CAAvL,EAAyL;AAACS,oBAAUT,CAAV;AAAY,KAAtM;AAAuM+K,YAAvM,YAAgN/K,CAAhN,EAAkN;AAAC+K,mBAAS/K,CAAT;AAAW,KAA9N;AAA+NY,oBAA/N,YAAgPZ,CAAhP,EAAkP;AAACY,2BAAiBZ,CAAjB;AAAmB,KAAtQ;AAAuQgL,wBAAvQ,YAA4RhL,CAA5R,EAA8R;AAACgL,+BAAqBhL,CAArB;AAAuB;AAAtT,CAA/C,EAAuW,CAAvW;AAA0W,IAAIiL,gBAAJ;AAAA,IAAY7K,iBAAZ;AAAqBb,OAAOO,KAAP,CAAaC,QAAQ,sBAAR,CAAb,EAA6C;AAACkL,WAAD,YAASjL,CAAT,EAAW;AAACiL,kBAAQjL,CAAR;AAAU,KAAtB;AAAuBI,YAAvB,YAAgCJ,CAAhC,EAAkC;AAACI,mBAASJ,CAAT;AAAW;AAA9C,CAA7C,EAA6F,CAA7F;AAAgG,IAAIe,eAAJ;AAAWxB,OAAOO,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAAA,yBAASC,CAAT,EAAW;AAACe,iBAAOf,CAAP;AAAS;AAArB,CAA/B,EAAsD,EAAtD;AA+C1wDoB,IAAIL,MAAJ,C,CAEA;AACA;AACA;;AACA,IAAME,OAAOlB,QAAQ,MAAR,CAAb;;AACA,IAAMiB,KAAKjB,QAAQ,UAAR,CAAX;;AACA,IAAMmL,SAASnL,QAAQ,WAAR,CAAf;;AACA,IAAIoL,UAAUpL,QAAQ,UAAR,CAAd;;AACA,IAAIgC,UAAUhC,QAAQ,SAAR,CAAd;;AACA,IAAIqL,WAAWrL,QAAQ,mBAAR,CAAf,C,CAGA;AACA;AACA;AAGA;;;AACO,SAAe+J,4BAAf;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACHlI,gCAAQC,GAAR,CAAY,sCAAZ;AACAD,gCAAQC,GAAR,CAAY,8BAAZ;AACAD,gCAAQC,GAAR,CAAY,sCAAZ;AACIwJ,iCAJD,GAIapK,KAAKwB,IAAL,CAAU5C,OAAO6C,QAAP,CAAgBC,MAAhB,CAAuBC,oBAAjC,EAAuD,MAAvD,CAJb;AAKHhB,gCAAQC,GAAR,CAAY,+EAA+EwJ,SAA/E,GAA2F,kCAAvG,EALG,CAOH;;AACIC,wCARD,GAQoBX,SAASY,eAAT,CAAyB1L,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBqI,qBAAhD,EAAuEhK,EAR3F;AASCiK,wCATD,GASoBd,SAASY,eAAT,CAAyB1L,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBuI,qBAAhD,EAAuElK,EAT3F;AAUCmK,uCAVD,GAUmBhB,SAASY,eAAT,CAAyB1L,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuByI,gBAAhD,EAAkEpK,EAVrF;AAAA;AAYCE,8BAAM2J,SAAN,EAAiB7G,MAAjB;AACA9C,8BAAM4J,gBAAN,EAAwB9G,MAAxB;AACA9C,8BAAM+J,gBAAN,EAAwBjH,MAAxB;AACA9C,8BAAMiK,eAAN,EAAuBnH,MAAvB;AAfD;AAAA;;AAAA;AAAA;AAAA;AAiBC5C,gCAAQW,KAAR,CAAc,iHAAd;AAjBD,8BAkBO,IAAI1C,OAAOkD,KAAX,CAAiB,kBAAjB,EAAqC,8FAArC,CAlBP;;AAAA;AAAA;AAAA,2DAsBsB/B,GAAG6K,OAAH,CAAWR,SAAX,CAtBtB;;AAAA;AAsBCS,oCAtBD;AAAA;AAAA,2DAyBUC,QAAQC,GAAR,CAAYF,aAAa/E,GAAb;AAAiB,6CAAMkF,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAElC;AACIC,2DAH8B,GAGpBD,IAAIE,MAAJ,CAAW,CAAX,EAAcF,IAAIlD,OAAJ,CAAY,GAAZ,CAAd,CAHoB;AAI9BqD,4DAJ8B,GAInBnL,KAAKwB,IAAL,CAAU4I,SAAV,EAAqBY,GAArB,CAJmB,EAMlC;;AANkC,wDAO7B7B,QAAQ8B,OAAR,EAAiBG,MAPY;AAAA;AAAA;AAAA;;AAAA;AAAA,uFASZC,UAAUF,QAAV,EAAoBF,OAApB,CATY;;AAAA;AAS1BK,yDAT0B;;AAW9B;AACA,wDAAIL,YAAY,MAAhB,EAAwB;AAAE;AACtBnB,mEAAWwB,KAAX,CADoB,CACF;;AAClBjC,mEAAWiC,KAAX,EAAkBL,OAAlB,EAA2BZ,gBAA3B;AACH,qDAHD,MAGO,IAAIY,YAAY,OAAhB,EAAyB;AAAE;AAC9B5B,mEAAWiC,KAAX,EAAkBL,OAAlB,EAA2BZ,gBAA3B;AACIkB,mEAFwB,GAEVrC,QAAQoC,KAAR,EAAeL,OAAf,CAFU;AAG5B5B,mEAAWkC,WAAX,EAAwBN,OAAxB,EAAiCT,gBAAjC;AACH,qDAJM,MAIA,IAAIS,YAAY,iBAAhB,EAAmC;AACtClB,+EAAuBuB,KAAvB,EACIjC,WAAWiC,KAAX,EAAkBL,OAAlB,EAA2BP,eAA3B,CADJ;AAEH,qDAHM,MAGA;AACH;AACArB,mEAAWiC,KAAX,EAAkBL,OAAlB,EAA2BT,gBAA3B;AACH;;AAzB6B;AAAA;;AAAA;AA2B9B7J,4DAAQC,GAAR,CAAY,SAASqK,OAAT,GAAmB,+BAA/B;;AA3B8B;AA4BjC;AA5BiC;AAAA;;AAAA;AAAA;AAAA;AA8BlCtK,4DAAQW,KAAR;AA9BkC,0DA+B5B,IAAI1C,OAAOkD,KAAX,CAAiB,0CAAjB,cA/B4B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAjB;AAAA,4BAAZ,CAzBV;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AA6DA,SAAegH,oBAAf,CAAoC0C,SAApC,EAA+CtH,gBAA/C;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACH;AAEIuH,oCAHD,GAGgBC,uBAAuBxH,gBAAvB,CAHhB,EAG0D;;AAC7DyH,kDAA0BH,SAA1B,EAJG,CAImC;;AAJnC,oCAKoBA,SALpB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAKQxH,gCALR;AAAA,qCAM2ByH,YAN3B;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAMYG,oCANZ;AAAA;AAAA,2DAOWC,uBAAuBD,YAAvB,EAAoC5H,QAApC,EAA8CE,gBAA9C,CAPX;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AASF;;AATE;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAUN;;AAEM,SAAS6E,SAAT,CAAmB7H,MAAnB,EAA2B;AAC9BP,YAAQC,GAAR,CAAY,sCAAZ;AACAD,YAAQC,GAAR,CAAY,aAAZ;AACAD,YAAQC,GAAR,CAAY,sCAAZ;;AACA,QAAI;AACAD,gBAAQC,GAAR,CAAY,kDAAZ;AACAH,cAAM7B,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBmE,cAA7B,EAA6C;AACzC1B,kBAAMpB,MADmC;AAEzCuI,oBAAQvI,MAFiC;AAGzCwI,4BAAgBxI,MAHyB;AAIzCyI,wBAAYzI,MAJ6B;AAKzC0I,yBAAa1I,MAL4B;AAMzClD,0BAAckD;AAN2B,SAA7C;AAQA9C,cAAM7B,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBgK,IAA7B,EAAmC;AAC/BvH,kBAAMpB,MADyB;AAE/BuI,oBAAQvI,MAFuB;AAG/B4I,qBAAS5I;AAHsB,SAAnC;AAKH,KAfD,CAeE,OAAOlC,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAc,iFAAd,EAAiGD,GAAjG;AACH;;AAED,QAAI;AACA,YAAI+K,qBAAqBjD,QAAQvK,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBmE,cAAvB,CAAsC1B,IAA9C,EAAoD/F,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBmE,cAAvB,CAAsCyF,MAA1F,CAAzB;AACA,YAAIO,WAAWlD,QAAQvK,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBgK,IAAvB,CAA4BvH,IAApC,EAA0C/F,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBgK,IAAvB,CAA4BJ,MAAtE,CAAf;;AACA,YAAIM,mBAAmBhB,MAAnB,GAA4B,CAAhC,EAAmC;AAC/B,kBAAM,IAAItJ,KAAJ,CAAU,8IAA8IlD,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBmE,cAAvB,CAAsC1B,IAApL,GAA2L,iBAA3L,GAA+M/F,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBmE,cAAvB,CAAsCyF,MAA/P,CAAN;AACH;;AACD,YAAIO,SAASjB,MAAT,GAAkB,CAAtB,EAAyB;AACrB,kBAAM,IAAItJ,KAAJ,CAAU,+IAA+IlD,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBgK,IAAvB,CAA4BvH,IAA3K,GAAkL,iBAAlL,GAAsM/F,OAAO6C,QAAP,CAAgBS,MAAhB,CAAuBgK,IAAvB,CAA4BJ,MAA5O,CAAN;AACH;;AACDzM,oBAAYiN,OAAZ,GAAsBD,SAAS,CAAT,EAAY9L,EAAlC,CATA,CASsC;;AACtCI,gBAAQC,GAAR,CAAY,kCAAZ,EAAgDvB,YAAYiN,OAA5D;AAEAjN,oBAAYkN,mBAAZ,GAAkCH,mBAAmB,CAAnB,EAAsB7L,EAAxD;AACAI,gBAAQC,GAAR,CAAY,6CAAZ,EAA2DvB,YAAYkN,mBAAvE;AACH,KAdD,CAcE,OAAOlL,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAcD,GAAd;AACA,cAAM,IAAIzC,OAAOkD,KAAX,CAAiB,oKAAjB,EAAuLT,GAAvL,CAAN;AACH;AACJ;;AAGD,SAAewK,sBAAf,CAAsCD,WAAtC,EAAmD5H,QAAnD,EAA6DE,gBAA7D;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACIvD,gCAAQC,GAAR,CAAY,sDAAZ,EADJ,CAEI;AACA;;AACMK,4BAJV,GAIiB,EAJjB;AAKIA,6BAAK6C,MAAL,GAAc,gCAAgC8H,YAAYjH,IAA5C,GAAmD,OAAnD,GAA6DX,SAASW,IAApF;AACA1D,6BAAKuL,SAAL,GAAiBtI,gBAAjB;AACAjD,6BAAKH,OAAL,GAAe,wBAAwB8K,YAAYjH,IAApC,GAA2C,gBAA3C,GAA8DX,SAASW,IAAtF;AACAxF,iCAAS8B,IAAT,EAAeiD,gBAAf;AARJ;AAWYuI,gCAXZ,GAWuBC,kBAAkB1I,QAAlB,EAA4BE,gBAA5B,CAXvB,EAWqE;;AAXrE;AAAA,2DAYuCyI,gBAAgB3I,SAASW,IAAzB,CAZvC;;AAAA;AAYYiI,0CAZZ;AAAA;AAAA,2DAac3D,oBAAoB,QAApB,EAA8BjF,SAASW,IAAvC,EAA6CiI,kBAA7C,CAbd;;AAAA;AAcYC,gCAdZ,GAcuB3D,QAAQ0C,YAAYrL,EAApB,EAAwBqL,YAAYjH,IAApC,EAA0CT,gBAA1C,CAdvB;AAeY4I,8BAfZ,GAeqBC,mCAAmCF,QAAnC,EAA6CjB,YAAYjH,IAAzD,EAA+D8H,QAA/D,EAAyEzI,QAAzE,EAAmF4I,kBAAnF,EAAuG,EAAvG,EAA2G1I,gBAA3G,CAfrB;AAgBY8I,sCAhBZ,GAgB6B3D,WAAWwD,QAAX,EAAqBjB,YAAYjH,IAAjC,EAAuC8H,QAAvC,EAAiDzI,SAASW,IAA1D,EAAgET,gBAAhE,CAhB7B,EAkBQ;;AACMjD,6BAnBd,GAmBqB,EAnBrB;AAoBQA,8BAAK6C,MAAL,GAAc,6BAA6BE,SAASW,IAApD;AACA1D,8BAAKH,OAAL,GAAe8K,YAAYjH,IAAZ,GAAmB,oDAAnB,GAA0EX,SAASW,IAAnF,GAA0F,WAAzG;AACAxF,iCAAS8B,KAAT,EAAeiD,gBAAf;AACAvD,gCAAQC,GAAR,CAAY,mDAAmDgL,YAAYjH,IAA/D,GAAsE,sBAAtE,GAA+FX,SAASW,IAApH;AACA8E,2CAAmBnC,MAAnB,CAA0B;AACtB,gDAAoBpD,gBADE;AAEtB,wCAAYF,SAASW,IAFC;AAGtB,wCAAY8H,QAHU;AAItB,qCAASI;AAJa,yBAA1B;AAxBR;AAAA;;AAAA;AAAA;AAAA;AA+BQlM,gCAAQW,KAAR,CAAc,uBAAd;AA/BR,8BAgCc,IAAI1C,OAAOkD,KAAX,CAAiB,mBAAjB,EAAsC,wEAAtC,CAhCd;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAmCC,C,CAGD;AACA;;AACA,SAAeiL,kCAAf,CAAkDzB,KAAlD,EAAyD2B,UAAzD,EAAqER,QAArE,EAA+EzI,QAA/E,EAAyF4I,kBAAzF,EAA6GM,aAA7G,EAA4HhJ,gBAA5H;AAAA,kDA4EaiJ,aA5Eb;AAAA;AAAA;AAAA;AAAA;AAAA;AA4EaA,qCA5Eb;AAAA,qCA4EaA,aA5Eb,CA4E2BC,MA5E3B,EA4EmC;AAC3B;AACA;AACA;AACA;AACA,uCAAOA,MAAP;AACH;;AAlFL,mCA4EaD,aA5Eb;AAAA;;AACIxM,gCAAQC,GAAR,CAAY,yDAAZ,EADJ,CAGI;;AACIyM,8BAJR,GAIiB3M,OAAO+H,MAAP,CAAc,EAAd,EAAkBnJ,kBAAlB,CAJjB;AAKI+N,+BAAO/B,KAAP,GAAeA,KAAf;AALJ;AAQQ7K,8BAAM6K,KAAN,EAAa/H,MAAb;AACA9C,8BAAMuD,SAASW,IAAf,EAAqBpB,MAArB;AACA9C,8BAAMmM,kBAAN,EAA0BrJ,MAA1B;AACA9C,8BAAMyD,gBAAN,EAAwBX,MAAxB,EAXR,CAYQ;;AAZR;AAAA,2DAawB0G,OAAOqD,UAAP,CAAkB,KAAlB,EAAyBD,MAAzB,CAbxB;;AAAA;AAaYE,2BAbZ;AAcYtM,4BAdZ,GAcmB,EAdnB;AAeQA,6BAAK6C,MAAL,GAAc,uBAAd;AACA7C,6BAAKH,OAAL,GAAe,6DAA6DwK,KAA5E;AACArK,6BAAK8D,GAAL,GAAW3F,YAAYoO,mBAAvB;AACArO,iCAAS8B,IAAT,EAAeiD,gBAAf;AAlBR;AAqBY;AACAvD,gCAAQC,GAAR,CAAY,iGAAZ;AAtBZ;AAAA,2DAuBsC2M,IAAIE,GAAJ,CAAQC,gBAAR,CAAyB;AAC/C,qCAAS1J,SAASW,IAD6B;AAE/C,qCAAS,QAFsC;AAG/C,iDAAqBiI;AAH0B,yBAAzB,CAvBtC;;AAAA;AAuBgBe,qCAvBhB;AA4BgB1M,4BA5BhB,GA4BuB,EA5BvB;AA6BYA,6BAAK6C,MAAL,GAAc,+BAAd;AACA7C,6BAAK8D,GAAL,GAAW,EAAX;AACA9D,6BAAKH,OAAL,GAAe,mHAAf;AACAG,6BAAKF,QAAL,GAAgB,gCAAgC4M,aAAhD;AACAhN,gCAAQC,GAAR,CAAY,6BAAZ,EAA2C+M,aAA3C;AAjCZ;AAAA;;AAAA;AAAA;AAAA;AAmCYhN,gCAAQiN,IAAR,CAAa,0EAAb;;AAnCZ;AAAA;AAAA,2DAuC2BL,IAAIE,GAAJ,CAAQI,SAAR,EAvC3B;;AAAA;AAuCYT,8BAvCZ;AAwCYnM,4BAxCZ,GAwCmB,EAxCnB;AAyCQA,6BAAK6C,MAAL,GAAc,sBAAd;AACA7C,6BAAK8D,GAAL,GAAW3F,YAAYyO,SAAvB;AACA5M,6BAAKH,OAAL,GAAe,qDAAf;AACAG,6BAAKF,QAAL,GAAgBqM,MAAhB;AACAjO,iCAAS8B,IAAT,EAAeiD,gBAAf,EA7CR,CA+CQ;;AACIjD,4BAhDZ,GAgDmB,EAhDnB;AAAA;AAAA,2DAiD8BsM,IAAIE,GAAJ,CAAQK,SAAR,CAAkBX,cAAcC,MAAd,CAAlB,CAjD9B;;AAAA;AAiDQnM,6BAAKF,QAjDb;AAiDuE;AAC/DE,6BAAK6C,MAAL,GAAc,4DAAd;AACA7C,6BAAK8D,GAAL,GAAW3F,YAAY0O,SAAvB;AACA7M,6BAAKH,OAAL,GAAe,iOAAf;AACA3B,iCAAS8B,IAAT,EAAeiD,gBAAf,EArDR,CAuDQ;;AACIjD,4BAxDZ,GAwDmB,EAxDnB;AAAA;AAAA,2DAyD8BsM,IAAIE,GAAJ,CAAQM,QAAR,EAzD9B;;AAAA;AAyDQ9M,6BAAKF,QAzDb;AA0DQE,6BAAK6C,MAAL,GAAc,gBAAd;AACA7C,6BAAK8D,GAAL,GAAW3F,YAAY4O,SAAvB;AACA/M,6BAAKH,OAAL,GAAe,wDAAf;AACA3B,iCAAS8B,IAAT,EAAeiD,gBAAf,EA7DR,CA+DQ;;AACIjD,4BAhEZ,GAgEmB,EAhEnB;AAiEQA,6BAAK6C,MAAL,GAAc,UAAd;AACA7C,6BAAK8D,GAAL,GAAW3F,YAAY6O,OAAvB;AACAhN,6BAAKH,OAAL,GAAe,mBAAmBwK,KAAnB,GAA2B,yBAA1C;AACAnM,iCAAS8B,IAAT,EAAeiD,gBAAf;AApER;AAAA,2DAqEcqJ,IAAIE,GAAJ,CAAQS,MAAR,EArEd;;AAAA;AAuEQ/O,iCAAS8B,IAAT,EAAeiD,gBAAf;AAvER;AAAA;;AAAA;AAAA;AAAA;AAyEQvD,gCAAQW,KAAR,CAAc,kIAAd;;AAzER;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAoFO,SAAe0H,oBAAf;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACHrI,gCAAQC,GAAR,CAAY,sCAAZ;AACAD,gCAAQC,GAAR,CAAY,wBAAZ;AACAD,gCAAQC,GAAR,CAAY,sCAAZ,EAHG,CAIH;;AACIuN,0CALD,GAKsBnO,KAAKwB,IAAL,CAAU5C,OAAOwP,YAAjB,EAA+B,sBAA/B,CALtB;AAMHzN,gCAAQC,GAAR,CAAY,oBAAZ,EAAkCuN,kBAAlC;AANG;AAAA,2DAOGlF,oBAAoB,QAApB,EAA8B,aAA9B,EAA6CkF,kBAA7C,CAPH;;AAAA;AAAA,qCAQWvP,OAAO6C,QAAP,CAAgBC,MAAhB,CAAuB2M,eARlC;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAQMC,yBARN;AAAA;AAAA,2DASOrF,oBAAoBqF,EAAEC,IAAtB,EAA4BD,EAAE3J,IAA9B,EAAoC2J,EAAEE,gBAAtC,CATP;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAaA,SAAevF,mBAAf,CAAmCsF,IAAnC,EAAyC5J,IAAzC,EAA+C3E,IAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEH;AACIqN,8BAHD,GAGU3M,OAAO+H,MAAP,CAAc,EAAd,EAAkBnJ,kBAAlB,CAHV;AAIH+N,+BAAO/B,KAAP,GAAenC,QAAQ,OAAR,EAAiB,UAAjB,EAA6B,CAA7B,EAAgC5I,EAA/C;AACAI,gCAAQC,GAAR,CAAY,0BAA0B2N,IAA1B,GAAiC,GAAjC,GAAuC5J,IAAvC,GAA8C,GAA9C,GAAoD3E,IAApD,GAA2D,wEAA3D,GAAsIqN,OAAO/B,KAAzJ;;AACA,4BAAI;AACA7K,kCAAM8N,IAAN,EAAYhL,MAAZ;AACA9C,kCAAMT,IAAN,EAAYuD,MAAZ;AACA9C,kCAAMkE,IAAN,EAAYpB,MAAZ;AACA9C,kCAAM4M,OAAO/B,KAAb,EAAoB/H,MAApB;AACH,yBALD,CAKE,OAAOjC,KAAP,EAAc;AACZX,oCAAQW,KAAR,CAAc,gDAAd,EAAgEA,KAAhE;AACH;;AAbE;AAAA;AAAA,2DAiBiB2I,OAAOqD,UAAP,CAAkB,KAAlB,EAAyBD,MAAzB,CAjBjB;;AAAA;AAiBKE,2BAjBL;AAmBC;AACA5M,gCAAQC,GAAR,CAAY,iGAAZ;AApBD;AAAA,2DAqB2B2M,IAAIE,GAAJ,CAAQC,gBAAR,CAAyB;AAC/C,qCAAS/I,IADsC;AAE/C,qCAAS4J,IAFsC;AAG/C,iDAAqBvO;AAH0B,yBAAzB,CArB3B;;AAAA;AAqBK2N,qCArBL;AA0BChN,gCAAQC,GAAR,CAAY,6BAAZ,EAA2C+M,aAA3C;AA1BD;AAAA;;AAAA;AAAA;AAAA;AA4BChN,gCAAQW,KAAR,CAAc,kCAAd;;AA5BD;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAgCP,SAASmN,gCAAT,CAA0CC,YAA1C,EAAwD;AACpD/N,YAAQC,GAAR,CAAY,kCAAZ,EADoD,CAEpD;AACA;AACH;;AAED,SAAe+L,eAAf,CAA+B+B,YAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACI/N,gCAAQC,GAAR,CAAY,gEAAZ,EAA8E8N,YAA9E;AADJ;AAGQjO,8BAAMiO,YAAN,EAAoBnL,MAApB;AACIoL,gCAJZ,GAIuBxE,SAASuE,YAAT,CAJvB;AAKcE,2BALd,GAKoB5O,KAAKwB,IAAL,CAAU5C,OAAO6C,QAAP,CAAgBC,MAAhB,CAAuBmN,eAAjC,EAAkDH,YAAlD,CALpB;AAMQ/N,gCAAQC,GAAR,CAAY,wCAAZ,EAAsDgO,GAAtD;AANR;AAAA,2DAOc7O,GAAG+O,SAAH,CAAaF,GAAb,CAPd;;AAAA;AAAA,0DAQeA,GARf;;AAAA;AAAA;AAAA;AAAA,8BAUc,IAAIhQ,OAAOkD,KAAX,CAAiB,iCAAjB,EAAoD4M,YAApD,CAVd;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAeA,SAAS/C,yBAAT,CAAmCH,SAAnC,EAA8C;AAC1C,QAAI,CAACA,UAAUJ,MAAf,EAAuB;AAAE;AACrB,cAAM,IAAIxM,OAAOkD,KAAX,CAAiB,cAAjB,EAAiC,gFAAjC,CAAN;AACH;AACJ;;AAAA,C,CAED;AACA;;AACA,SAAS4J,sBAAT,CAAgCxH,gBAAhC,EAAkD;AAC9C,QAAIuH,eAAejC,aAAapF,IAAb,CAAkB;AAC7B,4BAAoBxF,OAAOmF,MAAP;AADS,KAAlB,EAGdgL,KAHc,EAAnB;;AAIA,QAAItD,aAAaL,MAAb,KAAwB,CAA5B,EAA+B;AAAE;AAC7B,cAAM,IAAIxM,OAAOkD,KAAX,CAAiB,aAAjB,EAAgC,mEAAhC,CAAN;AACH;;AAEDkN,yBAAqB7F,SAArB;;AACA,QAAI,CAAC6F,kBAAL,EAAyB;AACrB,cAAM,IAAIpQ,OAAOkD,KAAX,CAAiB,+FAA+F8J,YAAYjH,IAA3G,GAAkH,cAAlH,GAAmIiH,YAAYrL,EAA/I,GAAoJ,iFAArK,CAAN;AACH;;AACDJ,MAAEkH,IAAF,CAAOoE,YAAP,EAAqB,UAASG,WAAT,EAAsB;AACvC,YAAIqD,gBAAgB9O,EAAEqC,IAAF,CAAOwM,kBAAP,EAA2B,CAAC,IAAD,EAAOpD,YAAYrL,EAAnB,CAA3B,CAApB;;AAEA,YAAI,CAAC0O,aAAL,EAAoB;AAChB,kBAAM,IAAIrQ,OAAOkD,KAAX,CAAiB,yCAAyC8J,YAAYjH,IAArD,GAA4D,cAA5D,GAA6EiH,YAAYrL,EAAzF,GAA8F,iFAA/G,CAAN;AACH,SAFD,MAEO,CACH;AACH;AACJ,KARD;;AASA,WAAOkL,YAAP;AACH;;AAAA,C,CAED;AACA;AACA;;AAGA,SAAeJ,SAAf,CAAyBF,QAAzB,EAAmCF,OAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AACItK,gCAAQC,GAAR,CAAY,iBAAiBqK,OAAjB,GAA2B,cAA3B,GAA4CE,QAAxD;AADJ;AAAA,2DAEiB,IAAIL,OAAJ,CAAY,UAASoE,OAAT,EAAkBC,MAAlB,EAA0B;AAC/C,gCAAIC,WAAW;AACXC,yCAAStP,GAAGuP,gBAAH,CAAoBnE,QAApB;AADE,6BAAf;AAIArK,oCAAQ4H,IAAR,CAAa;AACT3D,qCAAK6E,gBAAgB,uBAAhB,GAA0CqB,OAA1C,GAAoD,UAApD,GAAiE5L,YAAY8B,MADzE;AAETqE,yCAAS;AACL,oDAAgB,gCADX;AAEL,+CAAWnG,YAAYkQ,WAFlB;AAGL,qDAAiBlQ,YAAY8B;AAHxB,iCAFA;AAOTiO,0CAAUA;AAPD,6BAAb,EAQG,UAAS9N,KAAT,EAAgBkO,GAAhB,EAAqBC,IAArB,EAA2B;AAC1B,oCAAI,CAACnO,KAAL,EAAY;AACR,wCAAIgK,QAAQ7H,KAAKiM,KAAL,CAAWD,IAAX,EAAiBlP,EAA7B;AACAI,4CAAQC,GAAR,CAAY,eAAeqK,OAAf,GAAyB,qCAAzB,GAAiEK,KAA7E;AACA4D,4CAAQ5D,KAAR;AACH,iCAJD,MAIO;AACH3K,4CAAQW,KAAR,CAAc,yBAAyB2J,OAAvC,EAAgD3J,KAAhD;AACA6N,2CAAO7N,KAAP;AACH;AACJ,6BAjBD;AAkBH,yBAvBY,CAFjB;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,C,CA2BA;AACA;AACA;;;AAGO,SAAS4H,OAAT,CAAiByG,IAAjB,EAAuBhL,IAAvB,EAA6BT,gBAA7B,EAA+C;AAClDzD,UAAMkP,IAAN,EAAYpM,MAAZ;AACA9C,UAAMkE,IAAN,EAAYpB,MAAZ,EAFkD,CAGlD;;AACA,QAAMtC,OAAO,EAAb;;AAEA,QAAI;AACAA,aAAKH,OAAL,GAAejB,SAAS,WAAT,GAAuB8P,IAAvB,GAA8B,OAA7C;AACA1O,aAAKF,QAAL,GAAgBC,KAAK0H,IAAL,CAAUzH,KAAKH,OAAf,EAAwB;AACpC,iCAAqBnB,gBADe;AAEpCuB,oBAAQ;AACJ,0BAAU7B,YAAY8B,MADlB;AAEJ,wBAAQwD;AAFJ,aAF4B;AAMpCvD,kBAAM;AAN8B,SAAxB,CAAhB;AAUAjC,iBAAS8B,IAAT,EAAeiD,gBAAf;AACA,YAAI0L,UAAU3O,KAAKF,QAAL,CAAcK,IAAd,CAAmBb,EAAjC,CAbA,CAcA;AACA;;AACA,eAAOqP,OAAP;AACH,KAjBD,CAiBE,OAAOvO,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAcD,GAAd;AACAJ,aAAK6C,MAAL,GAAc,iBAAd;AACA7C,aAAKF,QAAL,GAAgBM,IAAIoE,OAApB;AACAtG,iBAAS8B,IAAT,EAAeiD,gBAAf;AACA,cAAM,IAAItF,OAAOkD,KAAX,CAAiB,wCAAjB,EAA2DT,IAAIoE,OAA/D,CAAN;AACH;AACJ;;AAAA,C,CAED;AACA;AACA;;AAGA,SAASiH,iBAAT,CAA2B1I,QAA3B,EAAqCE,gBAArC,EAAuD;AACnD;AACA,QAAI4H,SAASnC,QAAQ1F,OAAR,CAAgB;AACzBU,cAAMX,SAASW;AADU,KAAhB,CAAb,CAFmD,CAI/C;;AACJ,QAAI8H,WAAW,EAAf;;AACA,QAAIX,MAAJ,EAAY;AACR;AACAW,mBAAWX,OAAOvL,EAAlB;AACH,KAHD,MAGO;AACH;AACAkM,mBAAW/C,SAASmG,YAAT,CAAsB7L,SAASW,IAA/B,EAAqCT,gBAArC,EAAuD3D,EAAlE,CAFG,CAGH;AACH;;AAED,WAAOkM,QAAP;AACH,C,CAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AACA;AACA;;;AAEO,SAAStD,OAAT,CAAiBxE,IAAjB,EAAuBmH,MAAvB,EAA+B;AAClC,QAAI9L,OAAO,eAAX,CADkC,CAGlC;;AACA,QAAI2E,IAAJ,EAAU;AACN3E,gBAAQ,sBAAsB2E,IAAtB,GAA6B,GAArC;;AACA,YAAImH,MAAJ,EAAY;AACR9L,oBAAQ,0BAA0B8L,MAA1B,GAAmC,GAA3C;AACH;AACJ;;AAED,QAAI7K,OAAO;AACP6C,gBAAQ,kBADD;AAEPhD,iBAASd;AAFF,KAAX,CAXkC,CAelC;;AACA,WAAO6J,IAAIxB,GAAJ,CAAQpH,KAAKH,OAAb,CAAP;AACH;;AAAA,C,CAED;AACA;AACA;;AAGO,SAASsI,SAAT,CAAmBuG,IAAnB,EAA2D;AAAA,QAAlCzL,gBAAkC,uEAAf,aAAe;AAC9DvD,YAAQC,GAAR,CAAY,oBAAZ,EAAkC+O,IAAlC;;AACA,QAAI;AACA,YAAM1O,OAAO,EAAb;AACAA,aAAKH,OAAL,GAAejB,SAAS,WAAT,GAAuB8P,IAAtC;AACA1O,aAAKF,QAAL,GAAgBC,KAAK2H,GAAL,CAAS1H,KAAKH,OAAd,EAAuB;AACnCI,oBAAQ;AACJC,wBAAQ9B,YAAY8B;AADhB,aAD2B;AAInCwC,+BAAmBhE,gBAJgB;AAKnCyB,kBAAM;AAL6B,SAAvB,CAAhB,CAHA,CAWA;AACA;;AACAH,aAAK6C,MAAL,GAAc,YAAd;AACA7C,aAAK8D,GAAL,GAAW3F,YAAYgK,SAAvB;AACAnI,aAAKF,QAAL,GAAgBE,KAAKF,QAArB;AACA5B,iBAAS8B,IAAT,EAAeiD,gBAAf;AACA,eAAOjD,KAAKF,QAAZ;AACH,KAlBD,CAkBE,OAAOM,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAcD,GAAd;AACA,cAAM,IAAIzC,OAAOkD,KAAX,CAAiB,mBAAjB,EAAsCT,IAAIoE,OAA1C,CAAN;AACH;AACJ;;AAAA,C,CAGD;AACA;AACA;;AAGO,SAAS4D,UAAT,CAAoByG,OAApB,EAA6B7E,OAA7B,EAAsCwB,QAAtC,EAAgDiC,YAAhD,EAA8DxK,gBAA9D,EAAgF;AACnFvD,YAAQC,GAAR,CAAY,kBAAkBqK,OAAlB,GAA4B,cAA5B,GAA6CwB,QAAzD;AACAhM,UAAMqP,OAAN,EAAevM,MAAf;AACA9C,UAAMwK,OAAN,EAAe1H,MAAf;AACA9C,UAAMgM,QAAN,EAAgBlJ,MAAhB;;AAEA,QAAI;AACA,YAAMtC,OAAO,EAAb;AACAA,aAAKH,OAAL,GAAejB,SAAS,WAAT,GAAuBiQ,OAAvB,GAAiC,gBAAjC,GAAoD7E,OAApD,GAA8D,UAA9D,GAA2EwB,QAA1F;AACAxL,aAAKF,QAAL,GAAgBC,KAAK4H,GAAL,CAAS3H,KAAKH,OAAd,EAAuB;AACnCI,oBAAQ;AACJC,wBAAQ9B,YAAY8B;AADhB,aAD2B;AAInCwC,+BAAmBhE,gBAJgB;AAKnCyB,kBAAM;AAL6B,SAAvB,CAAhB,CAHA,CAYA;;AACAH,aAAK6C,MAAL,GAAc,aAAd;AACA7C,aAAK8D,GAAL,GAAW3F,YAAYiK,UAAvB;AACAlK,iBAAS8B,IAAT,EAAeiD,gBAAf;AACA,eAAOjD,KAAKF,QAAZ;AACH,KAjBD,CAiBE,OAAOM,GAAP,EAAY;AACVV,gBAAQW,KAAR,CAAcD,GAAd,EADU,CAGV;AACA;AACA;AACA;AACA;AACA;;AACA,cAAM,IAAIzC,OAAOkD,KAAX,CAAiB,wBAAwBmJ,OAAxB,GAAkC,gBAAlC,GAAqDyD,YAArD,GAAoE,WAArF,EAAkGrN,IAAIoE,OAAtG,CAAN;AACH;AACJ;;AAAA,C,CAED;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;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AAGvB,aAAS,CAAC;AACN,gBAAQ,MADF;AAEN,iBAAS,UAFH;AAGN,6BAAqB,KAHf;AAIN,mBAAW;AAJL,KAAD,EAKN;AACC,gBAAQ,OADT;AAEC,iBAAS,aAFV;AAGC,6BAAqB,KAHtB;AAIC,mBAAW;AAJZ,KALM,EAUN;AACC,gBAAQ,QADT;AAEC,iBAAS,WAFV;AAGC,6BAAqB,KAHtB;AAIC,mBAAW;AAJZ,KAVM,EAeN;AACC,gBAAQ,MADT;AAEC,iBAAS,OAFV;AAGC,6BAAqB,KAHtB;AAIC,mBAAW;AAJZ,KAfM;AAHc,CAAD,EAwBvB;AACC,YAAQF,MAAMC,OAAN,CAAcC,WAAd,EADT;AAEC,eAAW,IAFZ;AAGC,aAAS,CAAC;AACN,gBAAQF,MAAM1T,IAAN,CAAW6T,QAAX,EADF;AAEN,iBAAS,UAFH;AAGN,6BAAqB,KAHf;AAIN,mBAAW;AAJL,KAAD;AAHV,CAxBuB,EAiCvB;AACC,YAAQH,MAAMC,OAAN,CAAcC,WAAd,EADT;AAEC,eAAW,IAFZ;AAGC,aAAS,CAAC;AACN,gBAAQF,MAAM1T,IAAN,CAAW6T,QAAX,EADF;AAEN,iBAAS,UAFH;AAGN,6BAAqB,KAHf;AAIN,mBAAW;AAJL,KAAD,CAHV,CAUH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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BAAW;AAJZ,KAfM,CAJG;AAyBZ,wBAAoB;AAzBR,CAAhB,2H;;;;;;;;;;;AChDA,IAAI/d,iBAAJ;AAAab,OAAOO,KAAP,CAAaC,QAAQ,sBAAR,CAAb,EAA6C;AAACK,YAAD,YAAUJ,CAAV,EAAY;AAACI,mBAASJ,CAAT;AAAW;AAAxB,CAA7C,EAAuE,CAAvE;AAEb8b,OAAOsC,KAAP,CAAa,uBAAb,EAAsC,UAASrc,OAAT,EAAkBC,QAAlB,EAA4B+b,IAA5B,EAAkC;AACnE;AACA;AACA;AACA;AACA;AACA;AACAle,WAAOqC,IAAP,CAAY,0BAAZ;AACH,CARF,EAQI;AAAEmc,WAAO;AAAT,CARJ;AAUCvC,OAAOsC,KAAP,CAAa,0BAAb,EAAyC,UAASrc,OAAT,EAAkBC,QAAlB,EAA4B+b,IAA5B,EAAkC;AACvE;AACA;AACA;AACA;AACA;AACA;AACAle,WAAOqC,IAAP,CAAY,6BAAZ;AACH,CARD,EAQG;AAAEmc,WAAO;AAAT,CARH,2H;;;;;;;;;;;ACZD,IAAIpe,kBAAJ;AAAcV,OAAOO,KAAP,CAAaC,QAAQ,6BAAR,CAAb,EAAoD;AAACE,WAAD,YAAWD,CAAX,EAAa;AAACC,gBAAUD,CAAV;AAAY;AAA1B,CAApD,EAAgF,CAAhF;AAEd,IAAIyM,YACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","file":"/app.js","sourcesContent":["// import { Customers } from '/imports/api/customers';\r\n\r\n\r\n// AdminConfig = {\r\n//     collections: {\r\n//         Customers: {\r\n//             collectionObject: Customers,\r\n//         }\r\n//     },\r\n//     userSchema: new SimpleSchema({\r\n//         'profile.gender': {\r\n//             type: String,\r\n//             allowedValues: ['male', 'female']\r\n//         }\r\n//     })\r\n// };\r\n","import {\r\n    Meteor\r\n} from 'meteor/meteor';\r\nimport {\r\n    Customers,\r\n    dummyCustomers,\r\n    dummyCustomer\r\n} from '/imports/api/customers';\r\nimport {\r\n    REST_Log\r\n} from '/imports/api/APILogs';\r\nimport {\r\n    gitHubLinks\r\n} from '/imports/ui/UIHelpers';\r\nvar fs = require('fs-extra');\r\nconst path = require('path');\r\nvar os = require('os');\r\nvar ip = require('ip');\r\n\r\n//\r\n// â”€â”€â”€ IMPORT CONFIG FOR QLIK SENSE QRS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nimport {\r\n    senseConfig,\r\n    enigmaServerConfig,\r\n    authHeaders,\r\n    QRSconfig,\r\n    qrsSrv as qliksrv,\r\n    QRSCertConfig,\r\n    configCerticates,\r\n    validateJSON\r\n} from '/imports/api/config.js';\r\nimport lodash from 'lodash';\r\n_ = lodash;\r\n\r\n//\r\n// â”€â”€â”€ CREATE VIRTUAL PROXIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n// http://help.qlik.com/en-US/sense-developer/June2017/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-Virtual-Proxy-Create.htm\r\nexport async function createVirtualProxies() {\r\n    console.log('------------------------------------');\r\n    console.log('CREATE VIRTUAL PROXIES');\r\n    console.log('------------------------------------');\r\n    var file = path.join(Meteor.settings.broker.automationBaseFolder, 'proxy', 'import', 'virtualProxySettings.json');\r\n    try {\r\n        // READ THE PROXY FILE \r\n        var proxySettings = await fs.readJson(file);\r\n        try {\r\n            validateJSON(proxySettings)\r\n        } catch (err) {\r\n            throw new Error('Cant read the virtual proxy definitions file: virtualProxySettings.json in your automation folder')\r\n        }\r\n\r\n        //FOR EACH PROXY FOUND IN THE INPUTFILE (vpToCreate), CREATE IT IN SENSE. We also put the current ip/host in the list of sense since in most cases this tool runs on the same machine as sense.     \r\n        for (var vpToCreate of proxySettings) {\r\n            if (vpToCreate.websocketCrossOriginWhiteList) {\r\n                vpToCreate.websocketCrossOriginWhiteList.push(Meteor.settings.public.qlikSenseHost);\r\n                vpToCreate.websocketCrossOriginWhiteList.push(ip.address());\r\n                vpToCreate.websocketCrossOriginWhiteList.push(os.hostname());\r\n            }\r\n            var existingProxies = getVirtualProxies();\r\n\r\n            // CHECK IF VIRT. PROXY ALREADY EXISTS IN SENSE\r\n            var found = existingProxies.some(function(existingVP) {\r\n                return existingVP.prefix === vpToCreate.prefix;\r\n            });\r\n            if (!found) {\r\n                var virtualProxy = createVirtualProxy(vpToCreate);\r\n                // THE VIRTUAL PROXY HAS BEEN CREATED, NOW LINK IT TO THE CENTRAL PROXY\r\n                linkVirtualProxyToProxy(virtualProxy);\r\n            } else {\r\n                console.log('Virtual proxy ' + vpToCreate.prefix + ' already existed. We do not update existing ones.');\r\n            }\r\n        }\r\n    } catch (err) {\r\n        console.error(err)\r\n        throw new Error('unable to create virtual proxies', err);\r\n    }\r\n\r\n\r\n    function createVirtualProxy(virtualProxy) {\r\n\r\n        // get id of local node so we can link the virtual proxy to a load balancing node \r\n        virtualProxy.loadBalancingServerNodes = [{\r\n            id: getServerNodeConfiguration().id\r\n        }];\r\n        try {\r\n            check(virtualProxy, Object);\r\n            console.log('------CREATE VIRTUAL PROXY: ', virtualProxy.prefix);\r\n\r\n            var request = qliksrv + '/qrs/virtualproxyconfig/';\r\n            response = HTTP.call('POST', request, {\r\n                params: {\r\n                    xrfkey: senseConfig.xrfkey\r\n                },\r\n                'npmRequestOptions': configCerticates,\r\n                data: virtualProxy\r\n            });\r\n            return response.data;\r\n        } catch (err) {\r\n            console.error('create virtual proxy failed', err);\r\n        }\r\n        // }\r\n    }\r\n}\r\n\r\n// http://help.qlik.com/en-US/sense-developer/June2017/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-Virtual-Proxy-Link.htm \r\nfunction linkVirtualProxyToProxy(virtualProxy) {\r\n    // console.log('linkVirtualProxyToProxy', virtualProxy.id);\r\n\r\n    // GET ID OF PROXY ON THIS HOST\r\n    var proxyId = getProxyId();\r\n    // GET THE CONFIG OF THE PROXY (WHICH CONTAINS VIRTUAL PROXIES)\r\n    var proxyConfig = getProxyServiceConfiguration(proxyId)\r\n        // ADD THE NEW VIRTUAL PROXY TO THE EXISTING PROXY LIST\r\n    proxyConfig.settings.virtualProxies.push(virtualProxy)\r\n\r\n    //UPDATE SOME PROXY SETTINGS\r\n    proxyConfig.settings.unencryptedListenPort = Meteor.settings.public.qlikSensePort; //HTTP    \r\n    proxyConfig.settings.listenPort = Meteor.settings.public.qlikSensePortSecure; //HTTPS\r\n    proxyConfig.settings.allowHttp = Meteor.settings.public.qlikSenseAllowHTTP;\r\n\r\n    //OVERWRITE THE SETTINGS WITH THE COMPLETE UPDATED OBJECT.\r\n    updateProxy(proxyId, proxyConfig)\r\n}\r\n\r\nfunction updateProxy(proxyId, proxyConfig) {\r\n    try {\r\n        check(proxyId, String);\r\n        check(proxyConfig, Object);\r\n        console.log('proxyConfig', proxyConfig.settings.virtualProxies)\r\n\r\n        var request = qliksrv + '/qrs/proxyservice/' + proxyId;\r\n        response = HTTP.call('PUT', request, {\r\n            params: {\r\n                xrfkey: senseConfig.xrfkey\r\n            },\r\n            'npmRequestOptions': configCerticates,\r\n            data: proxyConfig\r\n        });\r\n    } catch (err) {\r\n        console.error('create virtual proxy failed', err);\r\n    }\r\n}\r\n\r\nfunction getProxyId() {\r\n    try {\r\n        var request = qliksrv + '/qrs/proxyservice/?xrfkey=' + senseConfig.xrfkey;\r\n        response = HTTP.call('GET', request, {\r\n            'npmRequestOptions': configCerticates,\r\n        });\r\n        return response.data[0].id;\r\n    } catch (err) {\r\n        console.error('create virtual proxy failed', err);\r\n    }\r\n}\r\n\r\nfunction getProxyServiceConfiguration(proxyId) {\r\n\r\n    try {\r\n        check(proxyId, String);\r\n\r\n        var request = qliksrv + '/qrs/proxyservice/' + proxyId + '?xrfkey=' + senseConfig.xrfkey;\r\n        response = HTTP.call('GET', request, {\r\n            'npmRequestOptions': configCerticates,\r\n        });\r\n\r\n        //SAVE RPOXY CONFIG TO THE EXPORT FOLDER\r\n        var file = path.join(Meteor.settings.broker.automationBaseFolder, 'proxy', 'export', 'proxyServiceConfiguration.json');\r\n        fs.outputFile(file, JSON.stringify(response.data, null, 2), 'utf-8');\r\n\r\n        return response.data;\r\n    } catch (err) {\r\n        console.error('create virtual proxy failed', err);\r\n    }\r\n}\r\n\r\nexport function getVirtualProxies() {\r\n    // console.log('--------------------------GET VIRTUAL PROXIES');//\r\n    try {\r\n        var request = qliksrv + '/qrs/virtualproxyconfig/';\r\n        response = HTTP.call('GET', request, {\r\n            params: {\r\n                xrfkey: senseConfig.xrfkey\r\n            },\r\n            npmRequestOptions: configCerticates,\r\n        });\r\n\r\n        var file = path.join(Meteor.settings.broker.automationBaseFolder, 'proxy', 'export', 'virtualProxyServiceConfiguration.json');\r\n\r\n        // SAVE PROXY FILE TO DISK\r\n        fs.outputFile(file, JSON.stringify(response.data, null, 2), 'utf-8');\r\n        return response.data;\r\n    } catch (err) {\r\n        console.error('create virtual proxy failed', err);\r\n    }\r\n}\r\n\r\n// function getCentralProxy() {\r\n//     console.log('getCentralProxy: GET /qrs/ServerNodeConfiguration?filter=isCentral')\r\n// }\r\n\r\n\r\nfunction getServerNodeConfiguration() {\r\n    try {\r\n        var request = qliksrv + '/qrs/servernodeconfiguration/local?xrfkey=' + senseConfig.xrfkey;\r\n        response = HTTP.call('GET', request, {\r\n            'npmRequestOptions': configCerticates,\r\n        });\r\n        return response.data;\r\n    } catch (err) {\r\n        console.error('create virtual proxy failed', err);\r\n    }\r\n}\r\n\r\n//\r\n// â”€â”€â”€ METEOR METHODS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nMeteor.methods({\r\n    currentlyLoggedInUser() {\r\n        // console.log(\"Meteor will now look which user is currently logged in, and request a ticket for this ID, and add his group memberships.\");\r\n        var call = {};\r\n        call.action = 'STEP 3: Server received request to create ticket';\r\n        call.request = 'Meteor server received a incoming method call from the browser. The meteor server will now look which user is currently logged in, and create a ticket for this ID, and add his group memberships.';\r\n        REST_Log(call, Meteor.userId());\r\n\r\n        // first find the customers that have a logged in users (mongo returns a complete document)\r\n        var customer = Customers.findOne({\r\n            generationUserId: Meteor.userId(),\r\n            'users.currentlyLoggedIn': true\r\n        });\r\n        // console.log('In our local database we can find the customer with the currentlyLoggedIn set to true for user: ' + loggedInUser + ', the customer which contains the user that the user selected with the dropdown: ', customer);\r\n\r\n        // now we have the document, we can look in the array of users, to find the one that is logged in.\r\n        var user;\r\n        if (!customer) { // if no user is selected, just insert john as a dummy\r\n            // const error = 'You have not selected a user you want to simulate the Single Sign on with. For demo purposes we now selected John for you. You can also select your own user in step 4 of the SaaS demo';\r\n            var response = {};\r\n            // console.log('dummyCustomer :', dummyCustomer);\r\n            response.user = dummyCustomer.user;\r\n            response.customer = dummyCustomer;\r\n            // throw new Meteor.Warning('No user', error);\r\n        } else {\r\n            var user = _.find(customer.users, {\r\n                'currentlyLoggedIn': true\r\n            });\r\n            var response = {};\r\n            response.user = user;\r\n            response.customer = customer;\r\n        }\r\n        // console.log('the response is: ', response);\r\n        return response;\r\n    },\r\n    getRedirectUrl(proxyRestUri, targetId, loggedInUser) {\r\n        var response = Meteor.call('currentlyLoggedInUser');\r\n        var customer = response.customer;\r\n        var user = response.user;\r\n\r\n        // console.log('UserID currently logged in in the demo platform: ' + loggedInUser + '. Meteor server side thinks the meteor.userId is ' + Meteor.userId() + '. We use this as the UDC name');\r\n        // Create a paspoort (ticket) request: user directory, user identity and attributes\r\n        var passport = {\r\n            'UserDirectory': Meteor.userId(), // Specify a dummy value to ensure userID's are unique E.g. \"Dummy\", or in my case, I use the logged in user, so each user who uses the demo can logout only his users, or the name of the customer domain if you need a Virtual proxy per customer\r\n            'UserId': user.name, // the current user that we are going to login with\r\n            'Attributes': [{\r\n                    'group': customer.name.toUpperCase()\r\n                }, // attributes supply the group membership from the source system to Qlik Sense\r\n                {\r\n                    'group': user.country.toUpperCase()\r\n                },\r\n                {\r\n                    'group': user.group.toUpperCase()\r\n                },\r\n            ],\r\n        };\r\n        // console.log('Request ticket for this user passport\": ', passport);\r\n\r\n        // logging only\r\n        var call = {};\r\n        call.action = 'STEP 4: User and group information received from customer database, now we can request a ticket';\r\n        call.url = gitHubLinks.createpassport;\r\n        call.request = 'Request ticket for this user and his groups (an array of values which you can use in the security rules): \": ' + JSON.stringify(passport);\r\n        REST_Log(call, Meteor.userId());\r\n\r\n        return getRedirectURL(passport, proxyRestUri, targetId, Meteor.userId());\r\n    },\r\n    getTicketNumber(userProperties, virtualProxy) { // only get a ticket number for a SPECIFIC virtual proxy\r\n        try {\r\n            // check(userProperties.user, String);\r\n            check(userProperties.group, String);\r\n        } catch (err) {\r\n            throw new Meteor.Error('Failed to login into Qlik Sense via a ticket', 'Please go to the landing page and select your group. We could not request a ticket because the userId or groups (technical, generic) are not provided');\r\n        }\r\n        var passport = {\r\n            'UserDirectory': Meteor.userId(), // Specify a dummy value to ensure userID's are unique E.g. \"Dummy\", or in my case, I use the logged in user, so each user who uses the demo can logout only his users, or the name of the customer domain if you need a Virtual proxy per customer\r\n            'UserId': Meteor.userId(), // the current user that we are going to login with\r\n            'Attributes': [{\r\n                    'group': 'slideGenerator'\r\n                }, // attributes supply the group membership from the source system to Qlik Sense\r\n                {\r\n                    'group': userProperties.group\r\n                },\r\n                {\r\n                    'group': 'ITALY'\r\n                }, // make sure the row level demo works by passing this\r\n            ],\r\n        };\r\n        //get the ticket number and return it to the client\r\n        return Meteor.call('requestTicketWithPassport', virtualProxy, passport);\r\n    },\r\n    //only for demo purposes! never supply groups from the client...\r\n    requestTicketWithPassport(virtualProxy, passport) {\r\n        console.log('getTicketNumber passport', passport)\r\n\r\n        // http://help.qlik.com/en-US/sense-developer/June2017/Subsystems/ProxyServiceAPI/Content/ProxyServiceAPI/ProxyServiceAPI-ProxyServiceAPI-Authentication-Ticket-Add.htm\r\n        var proxyGetTicketURI = 'https://' + senseConfig.host + ':' + Meteor.settings.private.proxyPort + '/qps/' + virtualProxy + '/ticket'; // \"proxyRestUri\": \"https://ip-172-31-22-22.eu-central-1.compute.internal:4243/qps/meteor/\",\r\n        try {\r\n            var response = HTTP.call('POST', proxyGetTicketURI, {\r\n                'npmRequestOptions': configCerticates,\r\n                headers: authHeaders,\r\n                params: {\r\n                    'xrfkey': senseConfig.xrfkey\r\n                },\r\n                data: passport, // the user and group info for which we want to create a ticket\r\n            });\r\n        } catch (err) {\r\n            console.error('REST call to request a ticket failed', err);\r\n            throw new Meteor.Error('Request ticket failed', err.message);\r\n        }\r\n        return response.data.Ticket;\r\n    },\r\n    resetLoggedInUser() {\r\n        // console.log(\"***Method resetLoggedInUsers\");\r\n        // console.log('call the QPS logout api, to invalidate the session cookie for each user in our local database');\r\n\r\n        // reset the local database. set all users to not logged in. We need this code because we do a simulation of the login and not a real end user login.\r\n        Customers.find({\r\n                'generationUserId': Meteor.userId()\r\n            })\r\n            .forEach(function(customer) {\r\n                var updatedUsers = _.map(customer.users, function(user) {\r\n                    if (user) {\r\n                        user.currentlyLoggedIn = false;\r\n                    }\r\n\r\n                    // and just logout everybody in the user list\r\n                    logoutUser(Meteor.userId(), user.name);\r\n                    return user;\r\n                });\r\n\r\n                Customers.update(customer._id, {\r\n                    $set: {\r\n                        users: updatedUsers\r\n                    },\r\n                });\r\n            });\r\n        // logoutUser(Meteor.userId(), Meteor.userId()); //logout the user for the slide generator\r\n    },\r\n    logoutPresentationUser(UDC, name) {\r\n        console.log('logoutPresentationUser(UDC, name)', UDC, name);\r\n        logoutUser(UDC, name, Meteor.settings.public.slideGenerator.virtualProxy);\r\n    },\r\n    logoutVirtualProxyClientUsageUser(UDC, name) {\r\n        console.log('logout virtual proxy client usuage User(UDC, name)', UDC, name);\r\n        logoutUser(UDC, name, Meteor.settings.public.virtualProxyClientUsage);\r\n    },\r\n    simulateUserLogin(name) {\r\n        check(name, String);\r\n        Meteor.call('resetLoggedInUser');\r\n        // console.log('*** Reset all logged in user done, now write in our local database the name for the current simulated user: generationUserId: ' + Meteor.userId() + ' & users.name:' + name);\r\n        var query = [{\r\n            'generationUserId': Meteor.userId(),\r\n            'users.name': name\r\n        }, {\r\n            $set: {\r\n                'users.$.currentlyLoggedIn': true,\r\n            },\r\n        }, ];\r\n\r\n        Customers.update({\r\n            'generationUserId': Meteor.userId(),\r\n            'users.name': name\r\n        }, {\r\n            $set: {\r\n                'users.$.currentlyLoggedIn': true,\r\n            },\r\n        }, {}, function(error, numberAffectedDocuments) {\r\n            if (numberAffectedDocuments === 0) { // if nothing is updated, insert some dummy customers\r\n                // console.log('simulateUserLogin numberAffectedDocuments: ', numberAffectedDocuments);\r\n                // name does not yet exist in the customers created by the current demo user. So insert our dummy customers.numberAffectedDocuments\r\n                insertDummyCustomers(Meteor.userId());\r\n                Customers.update({\r\n                    'generationUserId': Meteor.userId(),\r\n                    'users.name': name\r\n                }, {\r\n                    $set: {\r\n                        'users.$.currentlyLoggedIn': true,\r\n                    },\r\n                });\r\n            }\r\n        });\r\n    },\r\n});\r\n\r\nMeteor.methods({\r\n    'resetPasswordOrCreateUser' (user) {\r\n        try {\r\n            // console.log('reset the password of the user before logging him in');\r\n            check(user.email, String);\r\n            check(user.password, String);\r\n        } catch (err) {\r\n            throw new Meteor.Error('Missing Qlik.com user data',\r\n                'The user misses important information from its Qlik.com account');\r\n        }\r\n        const userExists = Accounts.findUserByEmail(user.email);\r\n        var userId = {};\r\n        if (user.email === 'mbj@qlik.com') {\r\n            throw new Meteor.Error('Admin account', 'Please login as a different user on Qlik.com');\r\n        } else if (userExists) {\r\n            // console.log('########### found user, now reset his password: ', userExists);\r\n            userId = userExists._id;\r\n            Accounts.setPassword(userId, user.password);\r\n        } else {\r\n            userId = Accounts.createUser(user);\r\n            Roles.addUsersToRoles(userId, ['untrusted'], 'GLOBAL'); // https://github.com/alanning/meteor-roles\r\n        }\r\n        return userId;\r\n    },\r\n});\r\n\r\nfunction insertDummyCustomers(generationUserId) {\r\n    // console.log('insertDummyCustomers called for generationUserId: ', generationUserId);\r\n    _.each(dummyCustomers, function(customer) {\r\n        customer.generationUserId = generationUserId;\r\n        Customers.insert(customer);\r\n    });\r\n}\r\n\r\n//Each proxy has its own session cookie, so you have to logout the users per proxy used.\r\nexport function logoutUser(UDC, name, proxy) {\r\n    if (!proxy) {\r\n        proxy = senseConfig.virtualProxyClientUsage;\r\n    } // use use the proxy for the dummy users from step 4\r\n    // console.log('******** QPS Functions: logout the current: ' + name + ' on proxy: ' + proxy);\r\n\r\n    if (name) {\r\n        // //console.log('Make QPS-logout call, We authenticate to Sense using the options (including a certificate) object in the HTTPs call: '); //, configCerticates);\r\n        // //console.log('Meteor tries to logout the user on this URL: https://' + senseConfig.SenseServerInternalLanIP + ':4243/qps/' + senseConfig.virtualProxyClientUsage + '/user/' + senseConfig.UDC + '/' + name);\r\n        try {\r\n            const call = {};\r\n            call.action = 'Logout user: ' + name;\r\n            call.url = gitHubLinks.logoutUser;\r\n            call.request = 'https://' + senseConfig.SenseServerInternalLanIP + ':4243/qps/' + proxy + '/user/' + UDC + '/' + name + '?xrfkey=' + senseConfig.xrfkey;\r\n            call.response = HTTP.call('DELETE', call.request, {\r\n                'npmRequestOptions': configCerticates\r\n            });\r\n\r\n            REST_Log(call, UDC); // the UDC is the by definition the userId of meteor in our approach...\r\n            // console.log('The HTTP REQUEST to Sense QPS API:', call.request);\r\n            // console.log('The HTTP RESPONSE from Sense QPS API: ', call.response);\r\n        } catch (err) {\r\n            console.error(err);\r\n            throw new Meteor.Error('Logout user failed', err.message);\r\n        }\r\n    }\r\n}\r\n\r\n// based on Rikard Braathen's QlikAuth module\r\nexport function getRedirectURL(passport, proxyRestUri, targetId, generationUserId) {\r\n    check(passport, Object);\r\n    check(proxyRestUri, String);\r\n    check(targetId, String);\r\n    check(generationUserId, String);\r\n\r\n    // console.log('entered server side requestTicket module for user and passport', passport, proxyRestUri);\r\n    // see https://help.qlik.com/en-US/sense-developer/3.0/Subsystems/ProxyServiceAPI/Content/ProxyServiceAPI/ProxyServiceAPI-ProxyServiceAPI-Authentication-Ticket-Add.htm\r\n\r\n    var ticketRequestBody = passport;\r\n    ticketRequestBody.TargetId = targetId;\r\n    // console.log('The passport for requesting a ticket: ', passport);\r\n\r\n    try {\r\n        var call = {};\r\n        call.action = 'STEP 5: Request ticket at endpoint received from Sense: ' + proxyRestUri;\r\n        call.request = proxyRestUri + 'ticket'; // we use the proxy rest uri which we got from the redirect from the proxy (the first bounce)\r\n        call.url = gitHubLinks.requestTicket;\r\n        call.response = HTTP.call('POST', call.request, {\r\n            'npmRequestOptions': configCerticates,\r\n            headers: authHeaders,\r\n            params: {\r\n                'xrfkey': senseConfig.xrfkey\r\n            },\r\n            data: passport, // the user and group info for which we want to create a ticket\r\n        });\r\n        REST_Log(call, generationUserId);\r\n    } catch (err) {\r\n        console.error('REST call to request a ticket failed', err);\r\n        throw new Meteor.Error('Request ticket failed', err.message);\r\n    }\r\n\r\n    // console.log('The HTTP REQUEST to Sense QPS API:', call.request);\r\n    // console.log('The HTTP RESPONSE from Sense QPS API: ', call.response);\r\n    var ticketResponse = call.response.data;\r\n    call.action = 'STEP 6: Use response from our ticket request to create redirect url';\r\n    call.request = 'Use the redirect url we got back and the ticket string to make a redirect url for the client. Format: ' + ticketResponse.TargetUri + '?QlikTicket=' + ticketResponse.Ticket + '. JSON received: ' + ticketResponse;\r\n    REST_Log(call);\r\n\r\n\r\n    // Build redirect URL for the client including the ticket\r\n    if (ticketResponse.TargetUri.indexOf('?') > 0) {\r\n        redirectURI = ticketResponse.TargetUri + '&QlikTicket=' + ticketResponse.Ticket;\r\n    } else {\r\n        redirectURI = ticketResponse.TargetUri + '?QlikTicket=' + ticketResponse.Ticket;\r\n    }\r\n\r\n    if (!redirectURI) {\r\n        redirectURI = 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + senseConfig.virtualProxyClientUsage + '/' + hub;\r\n    }\r\n    // console.log('Meteor server side created this redirect url: ', redirectURI);\r\n    return redirectURI;\r\n}","import {\r\n    Meteor,\r\n} from 'meteor/meteor';\r\nimport {\r\n    http,\r\n} from 'meteor/meteor';\r\n\r\nimport { configCerticates, senseConfig, authHeaders, qrsSrv } from '/imports/api/config';\r\n\r\nexport var myQRS = function myQRSMain() {\r\n\r\n    this.get = function get(path, params = {}, data = {}) {\r\n        var endpoint = checkPath(path);\r\n        console.log('QRS module received GET request for endpoint', endpoint);\r\n\r\n        // copy the params to one object\r\n        var newParams = Object.assign({ xrfkey: senseConfig.xrfkey }, params);\r\n        try {\r\n            var response = HTTP.get(endpoint, {\r\n                npmRequestOptions: configCerticates,\r\n                params: newParams,\r\n                data: {},\r\n            });\r\n            return response.data;\r\n        } catch (err) {\r\n            var error = 'QRS HTTP GET FAILED FOR ' + endpoint;\r\n            console.error(err);\r\n            throw new Meteor.Error(500, error);\r\n        }\r\n    };\r\n\r\n    this.post = function post(path, params = {}, data = {}) {\r\n        var endpoint = checkPath(path);\r\n\r\n        // copy the params to one object\r\n        var newParams = Object.assign({ 'xrfkey': senseConfig.xrfkey }, params);\r\n        try {\r\n            var response = HTTP.post(endpoint, {\r\n                npmRequestOptions: configCerticates,\r\n                params: newParams,\r\n                data: data,\r\n            });\r\n            return response.data;\r\n        } catch (err) {\r\n            console.error('HTTP POST FAILED FOR ' + endpoint, err);\r\n        }\r\n    };\r\n\r\n    this.del = function del(path, params = {}, data = {}) {\r\n        var endpoint = checkPath(path);\r\n        console.log('endpoint', endpoint)\r\n        console.log('data', data)\r\n\r\n        // copy the params to one object.\r\n        var newParams = Object.assign({ xrfkey: senseConfig.xrfkey }, params);\r\n        try {\r\n            var response = HTTP.del(endpoint, {\r\n                npmRequestOptions: configCerticates,\r\n                params: newParams,\r\n                data: data,\r\n            });\r\n            // console.log('response', response)\r\n            return response.data;\r\n        } catch (err) {\r\n            console.error('QRS HTTP DEL FAILED FOR ' + endpoint, err);\r\n        }\r\n    };\r\n\r\n    this.put = function put(path, params = {}, data = {}) {\r\n        var endpoint = checkPath(path);\r\n\r\n        // copy the params to one object\r\n        var newParams = Object.assign({ 'xrfkey': senseConfig.xrfkey }, params);\r\n        try {\r\n            var response = HTTP.put(endpoint, {\r\n                npmRequestOptions: configCerticates,\r\n                params: newParams,\r\n                data: data,\r\n            });\r\n            return response.data;\r\n        } catch (err) {\r\n            console.error('HTTP PUT FAILED FOR ' + endpoint, err);\r\n        }\r\n    };\r\n\r\n};\r\n\r\nfunction checkPath(path) {\r\n    try {\r\n        check(path, String);\r\n    } catch (err) {\r\n        throw Error(\"QRS module can use path: \" + path + \" for the QRS API, settings.json correct?\")\r\n    }\r\n    return qrsSrv + path;\r\n}","import {\r\n    Meteor\r\n} from 'meteor/meteor';\r\nimport {\r\n    http\r\n} from 'meteor/meteor';\r\nimport {\r\n    Apps,\r\n    TemplateApps,\r\n    GeneratedResources\r\n} from '/imports/api/apps';\r\nimport * as QSStream from '/imports/api/server/QRSFunctionsStream';\r\nimport {\r\n    gitHubLinks\r\n} from '/imports/ui/UIHelpers';\r\n\r\n//import meteor collections\r\nimport {\r\n    Streams\r\n} from '/imports/api/streams';\r\nimport {\r\n    Customers\r\n} from '/imports/api/customers';\r\n\r\nimport {\r\n    createVirtualProxies\r\n} from '/imports/api/server/QPSFunctions';\r\n\r\n\r\n//import config for Qlik Sense QRS and Engine API//\r\nimport {\r\n    qlikHDRServer, // Qlik sense QRS endpoint via header authentication\r\n    senseConfig,\r\n    enigmaServerConfig,\r\n    authHeaders,\r\n    qrsSrv,\r\n    qrs,\r\n    QRSconfig,\r\n    _SSBIApp,\r\n    configCerticates,\r\n    _slideGeneratorAppId\r\n} from '/imports/api/config.js';\r\nimport {\r\n    APILogs,\r\n    REST_Log\r\n} from '/imports/api/APILogs';\r\nimport lodash from 'lodash';\r\n_ = lodash;\r\n\r\n//\r\n// â”€â”€â”€ INSTALL NPM MODULES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\nconst path = require('path');\r\nconst fs = require('fs-extra');\r\nconst enigma = require('enigma.js');\r\nvar promise = require('bluebird');\r\nvar request = require('request');\r\nvar sanitize = require(\"sanitize-filename\");\r\n\r\n\r\n//\r\n// â”€â”€â”€ UPLOAD APPS FOR THE INITIAL SETUP OF QLIK SENSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\n// UPLOAD TEMPLATES APPS FROM FOLDER, AND PUBLISH INTO THE TEMPLATES STREAM\r\nexport async function uploadAndPublishTemplateApps() {\r\n    console.log('------------------------------------');\r\n    console.log('uploadAndPublishTemplateApps');\r\n    console.log('------------------------------------');\r\n    var newFolder = path.join(Meteor.settings.broker.automationBaseFolder, 'apps');\r\n    console.log('uploadAndPublishTemplateApps: Read all files in the template apps folder \"' + newFolder + '\" and upload them to Qlik Sense.');\r\n\r\n    //GET THE ID OF THE IMPORTANT STREAMS (streams that QRSMeteor needs)\r\n    var everyOneStreamId = QSStream.getStreamByName(Meteor.settings.public.EveryoneAppStreamName).id;\r\n    var templateStreamId = QSStream.getStreamByName(Meteor.settings.public.TemplateAppStreamName).id;\r\n    var APIAppsStreamID = QSStream.getStreamByName(Meteor.settings.public.APIAppStreamName).id;\r\n    try {\r\n        check(newFolder, String);\r\n        check(everyOneStreamId, String);\r\n        check(templateStreamId, String);\r\n        check(APIAppsStreamID, String);\r\n    } catch (err) {\r\n        console.error('You did not specify the templateAppsFrom, everyone, api apps or template stream name in the settings.json file?');\r\n        throw new Meteor.Error('Missing Settings', 'You did not specify the everone, api apps or template stream name in the settings.json file?');\r\n    }\r\n\r\n    // LOAD ALL SENSE APPS IN FOLDER\r\n    var appsInFolder = await fs.readdir(newFolder);\r\n\r\n    // FOR EACH APP FOUND: PUBLISH IT    \r\n    return await Promise.all(appsInFolder.map(async(QVF) => {\r\n        try {\r\n            //GET THE NAME OF THE APP AND CREATE A FILEPATH\r\n            var appName = QVF.substr(0, QVF.indexOf('.'));\r\n            var filePath = path.join(newFolder, QVF);\r\n\r\n            //ONLY UPLOAD APPS IF THEY DO NOT ALREADY EXIST\r\n            if (!getApps(appName).length) {\r\n                //UPLOAD THE APP, GET THE APP ID BACK\r\n                var appId = await uploadApp(filePath, appName);\r\n\r\n                //BASED ON THE APP WE WANT TO PUBLISH IT INTO A DIFFERENT STREAM                      \r\n                if (appName === 'SSBI') { //should be published in the everyone stream\r\n                    _SSBIApp = appId; // for the client side HTML/IFrames etc.                                \r\n                    publishApp(appId, appName, everyOneStreamId);\r\n                } else if (appName === 'Sales') { //THIS ONE NEEDS TO BE COPIED AND PUBLISHED INTO 2 STREAMS: AS TEMPLATE AND FOR THE EVERYONE STREAM.\r\n                    publishApp(appId, appName, everyOneStreamId);\r\n                    var copiedAppId = copyApp(appId, appName);\r\n                    publishApp(copiedAppId, appName, templateStreamId);\r\n                } else if (appName === 'Slide generator') {\r\n                    _slideGeneratorAppId = appId,\r\n                        publishApp(appId, appName, APIAppsStreamID);\r\n                } else {\r\n                    //Insert into template apps stream\r\n                    publishApp(appId, appName, templateStreamId);\r\n                }\r\n            } else {\r\n                console.log('App ' + appName + ' already exists in Qlik Sense')\r\n            };\r\n        } catch (err) {\r\n            console.error(err);\r\n            throw new Meteor.Error('Unable to upload the app to Qlik Sense. ', err)\r\n        }\r\n    }))\r\n}\r\n\r\nexport async function generateStreamAndApp(customers, generationUserId) {\r\n    // console.log('METHOD called: generateStreamAndApp for the template apps as stored in the database of the fictive OEM');\r\n\r\n    var templateApps = checkTemplateAppExists(generationUserId); //is a template app selected, and does the guid still exist in Sense? if yes, return the valid templates\r\n    checkCustomersAreSelected(customers); //have we selected a  customer to do the generation for?\r\n    for (const customer of customers) {\r\n        for (const templateApp of templateApps) {\r\n            await generateAppForTemplate(templateApp, customer, generationUserId);\r\n        }\r\n    };\r\n};\r\n\r\nexport function setAppIDs(params) {\r\n    console.log('------------------------------------');\r\n    console.log('SET APP IDs');\r\n    console.log('------------------------------------');\r\n    try {\r\n        console.log('check if all settings.json parameters are set...')\r\n        check(Meteor.settings.public.slideGenerator, {\r\n            name: String,\r\n            stream: String,\r\n            selectionSheet: String,\r\n            dataObject: String,\r\n            slideObject: String,\r\n            virtualProxy: String\r\n        });\r\n        check(Meteor.settings.public.SSBI, {\r\n            name: String,\r\n            stream: String,\r\n            sheetId: String\r\n        });\r\n    } catch (err) {\r\n        console.error('Missing parameters in your settings.json file for the SSBI or slidegenerator...', err)\r\n    }\r\n\r\n    try {\r\n        var slideGeneratorApps = getApps(Meteor.settings.public.slideGenerator.name, Meteor.settings.public.slideGenerator.stream);\r\n        var SSBIApps = getApps(Meteor.settings.public.SSBI.name, Meteor.settings.public.SSBI.stream);\r\n        if (slideGeneratorApps.length > 1) {\r\n            throw new Error('Can not automatically set the app ID for the slide generator. You have not one but you have multiple slide generator apps under the name ' + Meteor.settings.public.slideGenerator.name + ' in the stream ' + Meteor.settings.public.slideGenerator.stream);\r\n        }\r\n        if (SSBIApps.length > 1) {\r\n            throw new Error('Can not automatically set the app ID for the Self Service BI app. You have not one but you have multiple Self Service apps under the name ' + Meteor.settings.public.SSBI.name + ' in the stream ' + Meteor.settings.public.SSBI.stream);\r\n        }\r\n        senseConfig.SSBIApp = SSBIApps[0].id; //\r\n        console.log('The SSBI app id has been set to ', senseConfig.SSBIApp);\r\n\r\n        senseConfig.slideGeneratorAppId = slideGeneratorApps[0].id;\r\n        console.log('The slide generator app id has been set to ', senseConfig.slideGeneratorAppId);\r\n    } catch (err) {\r\n        console.error(err)\r\n        throw new Meteor.Error('The slideGenerator or Self Service BI app can not be found in Qlik sense, or you did not have all parameters set as defined in the the settings.json example file.', err);\r\n    }\r\n}\r\n\r\n\r\nasync function generateAppForTemplate(templateApp, customer, generationUserId) {\r\n    console.log('--------------------------GENERATE APPS FOR TEMPLATE');\r\n    // console.log(templateApp);\r\n    // console.log('############## START CREATING THE TEMPLATE ' + templateApp.name + ' FOR THIS CUSTOMER: ' + customer.name + ' FOR generationUserId: ' + generationUserId);\r\n    const call = {};\r\n    call.action = 'Start of generation of app ' + templateApp.name + ' for ' + customer.name;\r\n    call.createdBy = generationUserId;\r\n    call.request = 'Start creating app ' + templateApp.name + ' for customer ' + customer.name;\r\n    REST_Log(call, generationUserId);\r\n\r\n    try {\r\n        var streamId = checkStreamStatus(customer, generationUserId) //create a stream for the customer if it not already exists \r\n        var customerDataFolder = await createDirectory(customer.name); //for data like XLS/qvd specific for a customer\r\n        await createAppConnection('folder', customer.name, customerDataFolder);\r\n        var newAppId = copyApp(templateApp.id, templateApp.name, generationUserId);\r\n        var result = reloadAppAndReplaceScriptviaEngine(newAppId, templateApp.name, streamId, customer, customerDataFolder, '', generationUserId);\r\n        var publishedAppId = publishApp(newAppId, templateApp.name, streamId, customer.name, generationUserId);\r\n\r\n        //logging only\r\n        const call = {};\r\n        call.action = 'Finished generation for ' + customer.name;\r\n        call.request = templateApp.name + ' has been created and reloaded with data from the ' + customer.name + ' database';\r\n        REST_Log(call, generationUserId);\r\n        console.log('############## FINISHED CREATING THE TEMPLATE ' + templateApp.name + ' FOR THIS CUSTOMER: ' + customer.name);\r\n        GeneratedResources.insert({\r\n            'generationUserId': generationUserId,\r\n            'customer': customer.name,\r\n            'streamId': streamId,\r\n            'appId': newAppId\r\n        });\r\n    } catch (err) {\r\n        console.error('Failed to generate...', err);\r\n        throw new Meteor.Error('Generation failed', 'The server has an internal error, please check the server command logs');\r\n    }\r\n    return;\r\n};\r\n\r\n\r\n//Example to demo that you can also use the Engine API to get all the apps, or reload an app, set the script etc.\r\n//source based on loic's work: https://github.com/pouc/qlik-elastic/blob/master/app.js\r\nasync function reloadAppAndReplaceScriptviaEngine(appId, newAppName, streamId, customer, customerDataFolder, scriptReplace, generationUserId) {\r\n    console.log('--------------------------REPLACE SCRIPT AND RELOAD APP');\r\n\r\n    //set the app ID to be used in the enigma connection to the engine API\r\n    var config = Object.assign({}, enigmaServerConfig);\r\n    config.appId = appId;\r\n\r\n    try {\r\n        check(appId, String);\r\n        check(customer.name, String);\r\n        check(customerDataFolder, String);\r\n        check(generationUserId, String);\r\n        //connect to the engine\r\n        var qix = await enigma.getService('qix', config);\r\n        var call = {};\r\n        call.action = 'Connect to Qlik Sense';\r\n        call.request = 'Connect to Engine API (using Enigma.js) using an appId: ' + appId;\r\n        call.url = gitHubLinks.replaceAndReloadApp;\r\n        REST_Log(call, generationUserId);\r\n\r\n        try {\r\n            //create folder connection \r\n            console.log('create folder connection, if you see a warning below that means the connection already existed.');\r\n            var qConnectionId = await qix.app.createConnection({\r\n                \"qName\": customer.name,\r\n                \"qType\": \"folder\",\r\n                \"qConnectionString\": customerDataFolder\r\n            })\r\n            var call = {};\r\n            call.action = 'Create data/folder connection';\r\n            call.url = '';\r\n            call.request = 'Link to a folder on the server where users can put files/QVD, or create a REST/ODBC/OLEDB... database connection.';\r\n            call.response = 'created folder connection: ' + qConnectionId;\r\n            console.log('created folder connection: ', qConnectionId);\r\n        } catch (error) {\r\n            console.info('No issue, existing customer so his data folder connection already exists', error);\r\n        }\r\n\r\n        //get the script\r\n        var script = await qix.app.getScript();\r\n        var call = {};\r\n        call.action = 'Get data load script';\r\n        call.url = gitHubLinks.getScript;\r\n        call.request = 'We extracted the following load script from the app';\r\n        call.response = script;\r\n        REST_Log(call, generationUserId);\r\n\r\n        //set the new script\r\n        var call = {};\r\n        call.response = await qix.app.setScript(replaceScript(script)) //we now just include the old script in this app\r\n        call.action = 'Insert customer specific data load script for its database';\r\n        call.url = gitHubLinks.setScript;\r\n        call.request = 'The script of the app has been replaced with a customer specific one. Normally you would replace the database connection for each customer. Or you can insert a customer specific script to enable customization per customer. ';\r\n        REST_Log(call, generationUserId);\r\n\r\n        //reload the app\r\n        var call = {};\r\n        call.response = await qix.app.doReload()\r\n        call.action = 'Reload the app';\r\n        call.url = gitHubLinks.reloadApp;\r\n        call.request = 'Has the app been reloaded with customer specific data?';\r\n        REST_Log(call, generationUserId);\r\n\r\n        //save the app\r\n        var call = {};\r\n        call.action = 'Save app'\r\n        call.url = gitHubLinks.saveApp;\r\n        call.request = 'App with GUID ' + appId + ' has been saved to disk';\r\n        REST_Log(call, generationUserId);\r\n        await qix.app.doSave();\r\n\r\n        REST_Log(call, generationUserId);\r\n    } catch (error) {\r\n        console.error('error in reloadAppAndReplaceScriptviaEngine via Enigma.JS, did you used the correct schema definition in the settings.json file?', error);\r\n    }\r\n\r\n    function replaceScript(script) {\r\n        //var scriptMarker = 'Â§dummyDatabaseStringÂ§';\r\n        // if you want to replace the database connection per customer use the script below.\r\n        //return doc.setScript(script.replace(scriptMarker, scriptReplace)).then(function (result) {\r\n        //you can also change the sense database connection: https://github.com/mindspank/qsocks/blob/master/examples/App/create-dataconnection.js\r\n        return script;\r\n    }\r\n}\r\nexport async function createAppConnections() {\r\n    console.log('------------------------------------');\r\n    console.log('create app connections');\r\n    console.log('------------------------------------');\r\n    //create the default demo import folder where all the csv and qvf files are...\r\n    var senseDemoMaterials = path.join(Meteor.absolutePath, 'Sense Demo materials');\r\n    console.log('senseDemoMaterials', senseDemoMaterials)\r\n    await createAppConnection('folder', 'Import demo', senseDemoMaterials);\r\n    for (let c of Meteor.settings.broker.dataConnections) {\r\n        await createAppConnection(c.type, c.name, c.connectionString);\r\n    }\r\n}\r\n\r\nexport async function createAppConnection(type, name, path) {\r\n\r\n    //set the app ID to be used in the enigma connection to the engine API\r\n    var config = Object.assign({}, enigmaServerConfig);\r\n    config.appId = getApps('sales', 'Everyone')[0].id;\r\n    console.log('createAppConnection: ' + type + ' ' + name + ' ' + path + ' using the sales app in the everyone stream to create the connection: ' + config.appId);\r\n    try {\r\n        check(type, String);\r\n        check(path, String);\r\n        check(name, String);\r\n        check(config.appId, String);\r\n    } catch (error) {\r\n        console.error('Missing parameters to create a data connection', error);\r\n    }\r\n\r\n    try {\r\n        //connect to the engine\r\n        var qix = await enigma.getService('qix', config);\r\n\r\n        //create folder connection \r\n        console.log('create folder connection, if you see a warning below that means the connection already existed.');\r\n        var qConnectionId = await qix.app.createConnection({\r\n            \"qName\": name,\r\n            \"qType\": type,\r\n            \"qConnectionString\": path\r\n        })\r\n        console.log('created folder connection: ', qConnectionId);\r\n    } catch (error) {\r\n        console.error('Failed to create data connection', error);\r\n    }\r\n}\r\n\r\nfunction deleteDirectoryAndDataConnection(customerName) {\r\n    console.log('deleteDirectoryAndDataConnection');\r\n    //@TODO a bit dangerous, so better to do by hand. Make sure you can't delete root folder... \r\n    // https://stackoverflow.com/questions/18052762/remove-directory-which-is-not-empty\r\n}\r\n\r\nasync function createDirectory(customerName) {\r\n    console.log('createDirectory TURNED OFF!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!', customerName)\r\n    try {\r\n        check(customerName, String);\r\n        var filename = sanitize(customerName);\r\n        const dir = path.join(Meteor.settings.broker.customerDataDir, customerName);\r\n        console.log('Meteor.settings.broker.customerDataDir', dir)\r\n        await fs.ensureDir(dir)\r\n        return dir;\r\n    } catch (error) {\r\n        throw new Meteor.Error('Failed to create directory for ', customerName);\r\n    }\r\n\r\n}\r\n\r\nfunction checkCustomersAreSelected(customers) {\r\n    if (!customers.length) { // = 0\r\n        throw new Meteor.Error('No customers', 'user has not specified at least one customer for which an app can be generated');\r\n    }\r\n};\r\n\r\n// CHECK IF SELECTED TEMPLATE APP EXISTS IN QLIK SENSE\r\n//These are the apps that the OEM partner has in his database, but do they still exists on the qliks sense side?\r\nfunction checkTemplateAppExists(generationUserId) {\r\n    var templateApps = TemplateApps.find({\r\n            'generationUserId': Meteor.userId()\r\n        })\r\n        .fetch();\r\n    if (templateApps.length === 0) { //user has not specified a template\r\n        throw new Meteor.Error('No Template', 'user has not specified a template for which apps can be generated');\r\n    }\r\n\r\n    currentAppsInSense = getApps();\r\n    if (!currentAppsInSense) {\r\n        throw new Meteor.Error('No apps have been received from Qlik Sense. Therefore you have selected a Qlik Sense App: ' + templateApp.name + ' with guid: ' + templateApp.id + ' which does not exist in Sense anymore. Have you deleted the template in Sense?');\r\n    }\r\n    _.each(templateApps, function(templateApp) {\r\n        var templateFound = _.some(currentAppsInSense, ['id', templateApp.id]);\r\n\r\n        if (!templateFound) {\r\n            throw new Meteor.Error('You have selected a Qlik Sense App: ' + templateApp.name + ' with guid: ' + templateApp.id + ' which does not exist in Sense anymore. Have you deleted the template in Sense?');\r\n        } else {\r\n            // console.log('checkTemplateAppExists: True, template guid exist: ', templateApp.id);\r\n        }\r\n    })\r\n    return templateApps;\r\n};\r\n\r\n//\r\n// â”€â”€â”€ UPLOAD APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nasync function uploadApp(filePath, appName) {\r\n    console.log('Upload app: ' + appName + ' from path: ' + filePath);\r\n    return await new Promise(function(resolve, reject) {\r\n        var formData = {\r\n            my_file: fs.createReadStream(filePath)\r\n        };\r\n\r\n        request.post({\r\n            url: qlikHDRServer + '/qrs/app/upload?name=' + appName + '&xrfkey=' + senseConfig.xrfkey,\r\n            headers: {\r\n                'Content-Type': 'application/vnd.qlik.sense.app',\r\n                'hdr-usr': senseConfig.headerValue,\r\n                'X-Qlik-xrfkey': senseConfig.xrfkey\r\n            },\r\n            formData: formData\r\n        }, function(error, res, body) {\r\n            if (!error) {\r\n                var appId = JSON.parse(body).id;\r\n                console.log('Uploaded \"' + appName + '.qvf\" to Qlik Sense and got appID: ' + appId);\r\n                resolve(appId);\r\n            } else {\r\n                console.error(\"Failed to upload app\" + appName, error);\r\n                reject(error);\r\n            }\r\n        });\r\n    });\r\n}\r\n//\r\n// â”€â”€â”€ COPYAPP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function copyApp(guid, name, generationUserId) {\r\n    check(guid, String);\r\n    check(name, String);\r\n    // console.log('QRS Functions copy App, copy the app id: ' + guid + ' to app with name: ', name);\r\n    const call = {};\r\n\r\n    try {\r\n        call.request = qrsSrv + '/qrs/app/' + guid + '/copy';\r\n        call.response = HTTP.post(call.request, {\r\n            'npmRequestOptions': configCerticates,\r\n            params: {\r\n                'xrfkey': senseConfig.xrfkey,\r\n                \"name\": name\r\n            },\r\n            data: {}\r\n        });\r\n\r\n\r\n        REST_Log(call, generationUserId);\r\n        var newGuid = call.response.data.id;\r\n        // console.log('Step 2: the new app id is: ', newGuid);\r\n        //addTag('App', newGuid);\r\n        return newGuid;\r\n    } catch (err) {\r\n        console.error(err);\r\n        call.action = 'Copy app FAILED';\r\n        call.response = err.message;\r\n        REST_Log(call, generationUserId);\r\n        throw new Meteor.Error('Copy app for selected customers failed', err.message);\r\n    }\r\n};\r\n\r\n//\r\n// â”€â”€â”€ CHECKSTREAMSTATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nfunction checkStreamStatus(customer, generationUserId) {\r\n    // console.log('checkStreamStatus for: ' + customer.name);\r\n    var stream = Streams.findOne({\r\n        name: customer.name\r\n    }); //Find the stream for the name of the customer in Mongo, and get his Id from the returned object\r\n    var streamId = '';\r\n    if (stream) {\r\n        // console.log('Stream already exists: ', stream.id);\r\n        streamId = stream.id;\r\n    } else {\r\n        // console.log('No stream for customer exist, so create one: ' + customer.name);\r\n        streamId = QSStream.createStream(customer.name, generationUserId).id;\r\n        // console.log('Step 1: the (new) stream ID for ' + customer.name + ' is: ', streamId);\r\n    }\r\n\r\n    return streamId;\r\n}\r\n\r\n\r\n// export function getAppsViaEngine() {\r\n//     // console.log('server: QSSOCKS getApps');\r\n//     return qsocks.Connect(engineConfig)\r\n//         .then(function(global) {\r\n//             //We can now interact with the global class, for example fetch the document list.\r\n//             //qsocks mimics the Engine API, refer to the Engine API documentation or the engine api explorer for available methods.\r\n//             global.getDocList()\r\n//                 .then(function(docList) {\r\n//                     return docList;\r\n//                 });\r\n\r\n//         });\r\n// };\r\n\r\n// http://help.qlik.com/en-US/sense-developer/June2017/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-Get-All-As-Full.htm\r\n\r\n\r\n//\r\n// â”€â”€â”€ GETAPPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//    \r\n\r\nexport function getApps(name, stream) {\r\n    var path = '/qrs/app/full';\r\n\r\n    //if a name/stream is provided only search the apps with this name\r\n    if (name) {\r\n        path += \"?filter=Name eq '\" + name + \"'\"\r\n        if (stream) {\r\n            path += \" and stream.name eq '\" + stream + \"'\"\r\n        }\r\n    }\r\n\r\n    var call = {\r\n        action: 'Get list of apps',\r\n        request: path\r\n    };\r\n    // REST_Log(call,generationUserId);\r\n    return qrs.get(call.request);\r\n};\r\n\r\n//\r\n// â”€â”€â”€ DELETEAPP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function deleteApp(guid, generationUserId = 'Not defined') {\r\n    console.log('QRSApp deleteApp: ', guid);\r\n    try {\r\n        const call = {};\r\n        call.request = qrsSrv + '/qrs/app/' + guid;\r\n        call.response = HTTP.del(call.request, {\r\n            params: {\r\n                xrfkey: senseConfig.xrfkey\r\n            },\r\n            npmRequestOptions: configCerticates,\r\n            data: {}\r\n        });\r\n\r\n        // Meteor.call('updateLocalSenseCopy');\r\n        //logging only\r\n        call.action = 'Delete app';\r\n        call.url = gitHubLinks.deleteApp;\r\n        call.response = call.response;\r\n        REST_Log(call, generationUserId);\r\n        return call.response;\r\n    } catch (err) {\r\n        console.error(err);\r\n        throw new Meteor.Error('App delete failed', err.message);\r\n    }\r\n};\r\n\r\n\r\n//\r\n// â”€â”€â”€ PUBLISHAPP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function publishApp(appGuid, appName, streamId, customerName, generationUserId) {\r\n    console.log('Publish app: ' + appName + ' to stream: ' + streamId);\r\n    check(appGuid, String);\r\n    check(appName, String);\r\n    check(streamId, String);\r\n\r\n    try {\r\n        const call = {};\r\n        call.request = qrsSrv + '/qrs/app/' + appGuid + '/publish?name=' + appName + '&stream=' + streamId;\r\n        call.response = HTTP.put(call.request, {\r\n            params: {\r\n                xrfkey: senseConfig.xrfkey\r\n            },\r\n            npmRequestOptions: configCerticates,\r\n            data: {}\r\n        });\r\n\r\n\r\n        //logging into database\r\n        call.action = 'Publish app';\r\n        call.url = gitHubLinks.publishApp;\r\n        REST_Log(call, generationUserId);\r\n        return call.response;\r\n    } catch (err) {\r\n        console.error(err);\r\n\r\n        // // IF APP ALREADY EXISTED TRY TO PUBLISH OVERWRITE IT (REPLACE)\r\n        // if(err.response.statusCode == 400){\r\n        //     replaceApp()\r\n        // }\r\n        // console.error('statusCode:', err.response.statusCode);\r\n        // console.info('Try to PUBLISH OVERWRITE THE APP, SINCE IT WAS ALREADY PUBLISHED');\r\n        throw new Meteor.Error('Publication of app ' + appName + ' for customer ' + customerName + ' failed: ', err.message);\r\n    }\r\n};\r\n\r\n// REPLACE APP \r\n// export function replaceApp(targetApp, replaceByApp, generationUserId) {\r\n//     console.log('Function: Replace app: ' + targetApp + ' by app ' + targetApp);\r\n//     check(appGuid, String);\r\n//     check(replaceByApp, String);\r\n\r\n//     try {\r\n//         const result = HTTP.put(qlikHDRServer + '/qrs/app/' + replaceByApp + '/replace?app=' + targetApp + '&xrfkey=' + senseConfig.xrfkey, {\r\n//             headers: {\r\n//                 'hdr-usr': senseConfig.headerValue,\r\n//                 'X-Qlik-xrfkey': senseConfig.xrfkey\r\n//             }\r\n//         });\r\n\r\n//         //logging into database\r\n//         const call = {};\r\n//         call.action = 'Replace app';\r\n//         call.request = 'HTTP.put(' + qlikHDRServer + '/qrs/app/' + replaceByApp + '/replace?app=' + targetApp + '&xrfkey=' + senseConfig.xrfkey;\r\n//         call.response = result;\r\n//         call.url = 'http://help.qlik.com/en-US/sense-developer/June2017/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-App-Replace.htm';\r\n//         REST_Log(call, generationUserId);\r\n//         return result;\r\n//     } catch (err) {\r\n//         console.error(err);\r\n//         throw new Meteor.Error('Publication of app ' + appName + ' for customer ' + customerName + ' failed: ', err.message);\r\n//     }\r\n// };\r\n\r\n\r\n// function createTag(name) {\r\n//     check(name, String);\r\n//     // console.log('QRS Functions Appp, create a tag: ' + name);\r\n\r\n//     try {\r\n//         const result = HTTP.post(qlikHDRServer + '/qrs/Tag', {\r\n//             headers: authHeaders,\r\n//             params: {\r\n//                 'xrfkey': senseConfig.xrfkey\r\n//             },\r\n//             data: {\r\n//                 \"name\": name\r\n//             }\r\n//         })\r\n\r\n//         //logging only\r\n//         const call = {};\r\n//         call.action = 'create Tag';\r\n//         call.request = 'HTTP.get(http://' + senseConfig.SenseServerInternalLanIP + ':' + senseConfig.port + '/' + senseConfig.virtualProxy + '/qrs/tag';\r\n//         call.response = result;\r\n//         REST_Log(call, generationUserId);\r\n\r\n//         return result;\r\n//     } catch (err) {\r\n//         console.error(err);\r\n//         throw new Meteor.Error('Tag: ' + name + ' create failed ', err.message);\r\n//     }\r\n// };\r\n\r\n// function addTag(type, guid, tagName) {\r\n//     check(type, String);\r\n//     check(guid, String);\r\n\r\n//     //check if tag with tagName already exists\r\n\r\n//     var selectionId = createSelection(type, guid);\r\n//     addTagViaSyntheticToType('App', selectionId, tagGuid)\r\n\r\n// }\r\n\r\n// function createSelection(type, guid) {\r\n//     check(type, String);\r\n//     check(guid, String);\r\n//     console.log('QRS Functions APP, create selection for type: ', type + ' ' + guid);\r\n\r\n//     try {\r\n//         const result = HTTP.post(qlikHDRServer + '/qrs/Selection', {\r\n//             headers: authHeaders,\r\n//             params: {\r\n//                 'xrfkey': senseConfig.xrfkey\r\n//             },\r\n//             data: {\r\n//                 items: [{\r\n//                     type: type,\r\n//                     objectID: guid\r\n//                 }]\r\n//             }\r\n//         })\r\n//         console.log('the result of selection for type: ', type + ' ' + guid);\r\n//         console.log(result);\r\n//         return result.id;\r\n//     } catch (err) {\r\n//         console.error(err);\r\n//         throw new Meteor.Error('Selection: ' + type + ' failed for guid ' + guid, err.message);\r\n//     }\r\n// };\r\n\r\n// function deleteSelection(selectionId) {\r\n//     check(selectionId, String);\r\n//     console.log('QRS Functions APP, deleteSelection selection for selectionId: ', selectionId);\r\n\r\n//     try {\r\n//         const result = HTTP.delete(qlikHDRServer + '/qrs/Selection/' + selectionId, {\r\n//             headers: authHeaders,\r\n//             params: {\r\n//                 'xrfkey': senseConfig.xrfkey\r\n//             }\r\n//         })\r\n//         console.log(result);\r\n//         return result.id;\r\n//     } catch (err) {\r\n//         console.error(err);\r\n//         throw new Meteor.Error('Selection delete failed: ', err.message);\r\n//     }\r\n// };\r\n\r\n// function buildModDate() {\r\n//     var d = new Date();\r\n//     return d.toISOString();\r\n// }\r\n\r\n// function addTagViaSyntheticToType(type, selectionId, tagGuid) {\r\n//     check(type, String);\r\n//     check(guid, String);\r\n//     console.log('QRS Functions Appp, Update all entities of a specific type: ' + type + 'Â in the selection set identified byÂ {id} ' + selectionId + 'Â based on an existing synthetic object.Â : ');\r\n\r\n//     try {\r\n//         const result = HTTP.put(qlikHDRServer + '/qrs/Selection/' + selectionId + '/' + type + '/synthetic', {\r\n//             headers: authHeaders,\r\n//             params: {\r\n//                 'xrfkey': senseConfig.xrfkey\r\n//             },\r\n//             data: {\r\n//                 \"latestModifiedDate\": buildModDate(),\r\n//                 \"properties\": [{\r\n//                     \"name\": \"refList_Tag\",\r\n//                     \"value\": {\r\n//                         \"added\": [tagGuid]\r\n//                     },\r\n//                     \"valueIsModified\": true\r\n//                 }],\r\n//                 \"type\": type\r\n//             }\r\n//         })\r\n//         console.log('the result of selection for type: ', type + ' ' + guid);\r\n//         console.log(result);\r\n//         return result;\r\n//     } catch (err) {\r\n//         console.error(err);\r\n//         throw new Meteor.Error('Selection: ' + type + ' failed for guid ' + guid, err.message);\r\n//     }\r\n// };\r\n\r\n\r\n// async function uploadPublishTemplateApps() {\r\n//     //check if template apps have been uploaded and published in the templates stream\r\n//     // if (true) { // (!Apps.find({ \"stream.name\": \"Templates\" }).count()) {\r\n//     console.warn('no template apps found, so upload from the templates dir.');\r\n//     var folder = Meteor.settings.private.templateAppsFrom;\r\n//     // var folder = await copyTemplatesToQRSFolder();\r\n//     console.log('apps folder', folder);\r\n//     uploadAndPublishApps(folder);\r\n//     // } else {}\r\n// }\r\n\r\n// //upload and publish all apps found in the folder to the templates stream\r\n// async function copyTemplatesToQRSFolder() {\r\n//     var newFolder = Meteor.settings.private.templateAppsTo + '\\\\' + process.env.USERDOMAIN + '\\\\' + process.env.USERNAME;\r\n//     try {\r\n//         await fs.copy(Meteor.settings.private.templateAppsFrom, newFolder, {\r\n//             overwrite: true\r\n//         }); //\"QLIK-AB0Q2URN5T\\\\Qlikexternal\",\r\n//         return newFolder\r\n//     } catch (err) {\r\n//         console.error('error copy Templates from ' + Meteor.settings.private.templateAppsFrom + ' To QRSFolder ' + Meteor.settings.private.templateAppsDir, err);\r\n//     }\r\n// }\r\n\r\n// For a system service account, the app must be in the %ProgramData%\\Qlik\\Sense\\Repository\\DefaultApps folder.\r\n// For any other account, the app must be in the %ProgramData%\\Qlik\\Sense\\Apps\\<login domain>\\<login user> folder.\r\n//so you have to copy your apps there first. in a fresh sense installation.\r\nexport function importApp(fileName, name, generationUserId = 'no user set') {\r\n    // check(fileName, String);\r\n    // check(name, String);\r\n    // console.log('QRS Functions import App, with name ' + name + ', with fileName: ', fileName);\r\n\r\n    // try {\r\n    //     const call = {};\r\n    //     call.action = 'Import app';\r\n    //     call.url = 'http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-App-Import-App.htm'\r\n    //     call.request = qlikHDRServer + '/qrs/app/import?keepData=true&name=' + name + '&xrfkey=' + senseConfig.xrfkey; //using header auth.\r\n    //     call.response = HTTP.post(call.request, {\r\n    //         headers: {\r\n    //             'hdr-usr': senseConfig.headerValue,\r\n    //             'X-Qlik-xrfkey': senseConfig.xrfkey\r\n    //         },\r\n    //         data: '\"Sales.qvf\"'\r\n    //     });\r\n\r\n    //     REST_Log(call, generationUserId);\r\n    //     var newGuid = call.response.data.id;\r\n    //     return newGuid;\r\n    // } catch (err) {\r\n    //     console.error(err);\r\n    //     const call = {};\r\n    //     call.action = 'Import app FAILED';\r\n    //     call.response = err.message;\r\n    //     REST_Log(call, generationUserId);\r\n    //     throw new Meteor.Error('Import app failed', err.message);\r\n    // }\r\n};\r\n\r\n//https://www.npmjs.com/package/request#forms\r\n// function uploadApp(filePath, fileSize, appName) {\r\n//     console.log('QRS Functions upload App, with name ' + appName + ', with fileSize: ', fileSize + ' and filePath ' + filePath);\r\n//     var formData = {\r\n//         my_file: fs.createReadStream(filePath)\r\n//     };\r\n//     request.post({\r\n//         url: qlikHDRServer + '/qrs/app/upload?name=' + appName + '&xrfkey=' + senseConfig.xrfkey,\r\n//         headers: {\r\n//             'Content-Type': 'application/vnd.qlik.sense.app',\r\n//             'hdr-usr': senseConfig.headerValue,\r\n//             'X-Qlik-xrfkey': senseConfig.xrfkey\r\n//         },\r\n//         formData: formData\r\n//     }, function optionalCallback(err, httpResponse, body) {\r\n//         if (err) {\r\n//             return console.error('upload failed:', err);\r\n//         }\r\n//         console.log('Upload successful!  Server responded with:', body);\r\n//     });\r\n// }","import {\r\n    Meteor\r\n} from 'meteor/meteor';\r\nimport {\r\n    myQRS\r\n} from '/imports/api/server/QRSAPI';\r\n\r\nvar fs = require('fs-extra');\r\nconst path = require('path');\r\n\r\nimport {\r\n    senseConfig,\r\n    qrs\r\n} from '/imports/api/config.js';\r\n\r\n// http://help.qlik.com/en-US/sense-developer/June2017/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-Custom-Property-Add.htm\r\nexport function createCustomProperty(name, newProperty) {\r\n    console.log('------------------------------------');\r\n    console.log('createCustomProperty', name + ' ' + newProperty.toString())\r\n    console.log('------------------------------------');\r\n\r\n    try {\r\n        check(name, String);\r\n        check(newProperty, Object);\r\n    } catch (err) {\r\n        throw new Meteor.Error('createCustomProperty: Missing values', 'You did not specify a name or choice values for the custom property');\r\n    }\r\n\r\n    var result = qrs.post('/qrs/CustomPropertyDefinition', null, newProperty);\r\n    console.log('result of create custom property: ', result);\r\n}\r\n\r\nexport function upsertCustomPropertyByName(name, choiceValues) {\r\n    try {\r\n        check(name, String);\r\n        check(choiceValues, Array);\r\n    } catch (err) {\r\n        throw new Meteor.Error('upsertCustomPropertyByName: Missing values', 'You did not specify a name or update object for the custom property');\r\n    }\r\n\r\n    try {\r\n        var newProperty = {\r\n            \"name\": name,\r\n            \"valueType\": \"Text\",\r\n            \"objectTypes\": [\"App\", \"ContentLibrary\", \"DataConnection\", \"ReloadTask\", \"Stream\", \"User\"],\r\n            \"choiceValues\": choiceValues\r\n        }\r\n\r\n        var existingProperty = getCustomProperties(name)[0];\r\n        if (existingProperty) { //update it\r\n            var updatedProperty = Object.assign(existingProperty, newProperty);\r\n            var result = qrs.put('/qrs/CustomPropertyDefinition/' + updatedProperty.id, null, updatedProperty); //you can only update when you supply the original modified date, otherwise you get a 409 error. \r\n            console.log('Custom property update: ', result);\r\n        } else { //create a new one\r\n            createCustomProperty(name, newProperty);\r\n        }\r\n    } catch (error) {\r\n        console.log('error upserting custom property', error);\r\n    }\r\n}\r\n\r\nexport function deleteCustomProperty(name) {\r\n    console.log('deleteCustomProperty(name)', name);\r\n\r\n    var customProperty = getCustomProperties(name)[0];\r\n    if (customProperty) {\r\n        var result = qrs.del('/qrs/CustomPropertyDefinition/' + customProperty.id);\r\n        console.log('result after delete', result);\r\n    }\r\n\r\n}\r\n\r\nexport function getCustomProperties(name) {\r\n    var filter = name ? {\r\n        filter: \"Name eq '\" + name + \"'\"\r\n    } : null;\r\n    var customProperties = qrs.get('/qrs/CustomPropertyDefinition/full', filter);\r\n\r\n    var file = path.join(Meteor.settings.broker.automationBaseFolder, 'customProperties', 'export', 'ExtractedCustomProperties.json');\r\n\r\n    // SAVE FILE TO DISK\r\n    fs.outputFile(file, JSON.stringify(customProperties, null, 2), 'utf-8');\r\n\r\n    return customProperties;\r\n}","import { Meteor } from 'meteor/meteor';\r\nimport { myQRS } from '/imports/api/server/QRSAPI';\r\n\r\n\r\n//\r\n// â”€â”€â”€ IMPORT CONFIG FOR QLIK SENSE QRS AND ENGINE API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nimport {\r\n    qlikHDRServer, // Qlik sense QRS endpoint via header authentication\r\n    senseConfig,\r\n    enigmaServerConfig,\r\n    authHeaders,\r\n    qrsSrv,\r\n    QRSconfig,\r\n    _SSBIApp,\r\n    configCerticates,\r\n    _slideGeneratorAppId\r\n} from '/imports/api/config.js';\r\n\r\n//\r\n// â”€â”€â”€ INSTALL NPM MODULES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\nconst fs = require('fs-extra');\r\nconst path = require('path');\r\nconst enigma = require('enigma.js');\r\nvar promise = require('bluebird');\r\nvar request = require('request');\r\nvar qrs = new myQRS();\r\n\r\n// export async function automaticUploadExtensions() {\r\n//     console.log('Automatically download the extensions from Github and upload to Qlik Sense');\r\n//     var url = 'https://github.com/kai/qlik-sense-timeline.git';\r\n//     var req = request.get(url);\r\n//     console.log('req', req)\r\n\r\n// }\r\n\r\nexport async function uploadExtensions() {\r\n    console.log('--------------------------UPLOAD EXTENSIONS');\r\n    // LOAD ALL EXTENSIONS IN FOLDER\r\n    var extensionsFolder = '';\r\n    try {\r\n        extensionsFolder = path.join(Meteor.settings.broker.automationBaseFolder, 'extensions');\r\n        console.log('extensionsFolder', extensionsFolder)\r\n        var extensions = await fs.readdir(extensionsFolder);\r\n    } catch (err) {\r\n        throw error('error loading all extensions in folder.', err);\r\n    }\r\n\r\n    // FOR EACH EXTENSION FOUND, UPLOAD IT    \r\n    await Promise.all(extensions.map(async(extension) => {\r\n        console.log('Current extension', extension)\r\n        try {\r\n            //CREATE A FILEPATH          \r\n            var filePath = path.join(extensionsFolder, extension);\r\n\r\n            //UPLOAD THE APP, GET THE APP ID BACK\r\n            var result = await uploadExtension('', filePath);\r\n        } catch (err) {\r\n            console.error(err);\r\n            throw new Meteor.Error('Unable to upload the app to Qlik Sense. ', err)\r\n        }\r\n    }))\r\n\r\n}\r\n\r\n\r\nasync function uploadExtension(password, filePath) {\r\n\r\n    console.log('uploadApp: try to upload extension from path: ' + filePath);\r\n    var formData = {\r\n        my_file: fs.createReadStream(filePath)\r\n    };\r\n\r\n    // qrs.post('/qrs/extension/upload?pwd=' + password, data)\r\n    return await new Promise(function(resolve, reject) {\r\n\r\n        request.post({\r\n            url: qlikHDRServer + '/qrs/extension/upload?&xrfkey=' + senseConfig.xrfkey, //removed password parameter, assume blank\r\n            headers: {\r\n                'hdr-usr': senseConfig.headerValue,\r\n                'X-Qlik-xrfkey': senseConfig.xrfkey\r\n            },\r\n            formData: formData\r\n        }, function(error, res, body) {\r\n            if (!error) {\r\n                try {\r\n                    var id = JSON.parse(body).id;\r\n                    console.log('Uploaded \"' + path.basename(filePath) + ' to Qlik Sense and got id: ' + id); //\r\n                } catch (err) {\r\n                    console.log('Qlik Sense reported: ', body)\r\n                }\r\n                resolve();\r\n            } else {\r\n                reject(error);\r\n            }\r\n        });\r\n    });\r\n\r\n}","import { Meteor } from 'meteor/meteor';\r\nimport { myQRS } from '/imports/api/server/QRSAPI';\r\n\r\nvar fs = require('fs-extra');\r\nconst path = require('path');\r\n\r\n\r\n//\r\n// â”€â”€â”€ IMPORT CONFIG FOR QLIK SENSE QRS AND ENGINE API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nimport {\r\n    senseConfig,\r\n    qrs\r\n} from '/imports/api/config.js';\r\n\r\nvar demoUserAccessRule = \"SAAS DEMO - License rule to grant user access\";\r\n\r\n// http://help.qlik.com/en-US/sense-developer/June2017/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-License-Add.htm //\r\n\r\nexport function getLicense() {\r\n    var lic = qrs.get('/qrs/license');\r\n    return lic;\r\n}\r\n\r\nexport function insertLicense() {\r\n    console.log('------------------------------------');\r\n    console.log('INSERT LICENSE');\r\n    console.log('------------------------------------');\r\n    var existingLicense = qrs.get('/qrs/license');\r\n    var newLicense = Meteor.settings.private.license;\r\n\r\n    try {\r\n        console.log('check if all settings.json parameters are set...')\r\n        check(Meteor.settings.private.license, {\r\n            serial: String,\r\n            name: String,\r\n            organization: String\r\n        });\r\n        check(Meteor.settings.private.LicenseControlNumber, Number);\r\n    } catch (err) {\r\n        console.error('Missing parameters in your settings.json file for your Qlik Sense license', err)\r\n    }\r\n\r\n    if (!existingLicense) {\r\n        // try {\r\n        //     console.log('Update the existing license');\r\n        //     newLicense.id = existingLicense.id;\r\n        //     var response = qrs.del('/qrs/license/' + existingLicense.id);\r\n        //     // var response = qrs.put('/qrs/license/' + newLicense.id, newLicense, { control: Meteor.settings.private.LicenseControlNumber });\r\n        //     // console.error('Stop license insertion, license for ' + lic.organization + ' is already included: ', lic.serial);\r\n        //     // throw Error('You are trying to insert a license while the Qlik Sense is already licensed, please remove the existing one in the QMC');\r\n        // } catch (err) {\r\n        //     // lic did not already exist.\r\n        // }\r\n        var response = qrs.post('/qrs/license', { control: Meteor.settings.private.LicenseControlNumber }, newLicense);\r\n        console.log('No existing license present, therefore inserted license into Qlik Sense.')\r\n    }\r\n}\r\n\r\nexport function insertUserAccessRule() {\r\n    console.log('insert UserAccess Rule for all users');\r\n    var licenseRule = {\r\n        \"name\": demoUserAccessRule,\r\n        \"category\": \"License\",\r\n        \"rule\": \"((user.name like \\\"*\\\"))\",\r\n        \"type\": \"Custom\",\r\n        \"privileges\": [\"create\", \"read\", \"update\"],\r\n        \"resourceFilter\": \"License.UserAccessGroup_507c9aa5-8812-44d9-ade8-32809785eecf\",\r\n        \"actions\": 1,\r\n        \"ruleContext\": \"QlikSenseOnly\",\r\n        \"disabled\": false,\r\n        \"comment\": \"Rule to set up automatic user access for each user that has received a ticket via your SaaS platform\",\r\n        \"disabledActions\": [\"useaccesstype\"]\r\n    }\r\n    var ruleExist = getSystemRules(demoUserAccessRule);\r\n    if (typeof ruleExist[0] == 'undefined' || ruleExist.length === 0) {\r\n        console.log('Create a new user license rule since it did not exist.');\r\n        var response = qrs.post('/qrs/SystemRule', null, licenseRule);\r\n    }\r\n}\r\n\r\nexport function getSystemRules(name) {\r\n    console.log('Get system rules with name: ' + name);\r\n\r\n    var filter = name ? { filter: \"Name eq '\" + name + \"'\" } : null;\r\n    var rules = qrs.get('/qrs/SystemRule/full', filter);\r\n\r\n    var file = path.join(Meteor.settings.broker.automationBaseFolder, 'securityrules', 'export', 'ExtractedSystemRules.json');\r\n\r\n    // SAVE FILE TO DISK\r\n    fs.outputFile(file, JSON.stringify(rules, null, 2), 'utf-8');\r\n\r\n    return rules;\r\n}\r\nexport function saveSystemRules() {\r\n    var rules = qrs.get('/qrs/SystemRule');\r\n\r\n    var file = path.join(Meteor.settings.broker.automationBaseFolder, 'securityrules', 'export', 'ExtractedSystemRules.json');\r\n\r\n    // SAVE FILE TO DISK\r\n    fs.outputFile(file, JSON.stringify(rules, null, 2), 'utf-8');\r\n}","import { Meteor } from 'meteor/meteor';\r\nimport { GeneratedResources } from '/imports/api/apps.js';\r\nimport { gitHubLinks } from '/imports/ui/UIHelpers';\r\n\r\n// import config for Qlik Sense QRS and Engine API\r\nimport { senseConfig, authHeaders, qrsSrv, qrs, configCerticates } from '/imports/api/config.js';\r\nimport { REST_Log } from '/imports/api/APILogs';\r\n\r\nconst qlikServer = 'http://' + senseConfig.SenseServerInternalLanIP + ':' + senseConfig.port + '/' + senseConfig.virtualProxy;\r\n\r\n\r\n//\r\n// â”€â”€â”€ CREATE STREAMS FOR THE INITIAL SETUP OF QLIK SENSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function initSenseStreams() {\r\n    console.log('------------------------------------');\r\n    console.log('Create initial streams');\r\n    console.log('------------------------------------');\r\n\r\n    for (const streamName of Meteor.settings.public.StreamsToCreateAutomatically) {\r\n        try {\r\n            console.log('Try to create stream: ' + streamName + ' if it not already exists');\r\n            if (!getStreamByName(streamName)) {\r\n                createStream(streamName)\r\n            }\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n    }\r\n}\r\n\r\n//\r\n// â”€â”€â”€ GENERIC STREAM FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function deleteStream(guid, generationUserId) {\r\n    console.log('deleteStream: ', guid);\r\n    try {\r\n\r\n        var request = qrsSrv + '/qrs/stream/' + guid;\r\n        var response = HTTP.del(request, {\r\n            'npmRequestOptions': configCerticates,\r\n        });\r\n\r\n        // Logging\r\n        const call = {};\r\n        call.action = 'Delete stream';\r\n        call.request = \"HTTP.del(\" + qlikServer + '/qrs/stream/' + guid + '?xrfkey=' + senseConfig.xrfkey;\r\n        call.response = response;\r\n        REST_Log(call, generationUserId);\r\n        Meteor.call('updateLocalSenseCopy');\r\n        return response;\r\n    } catch (err) {\r\n        // console.error(err);\r\n        // throw new Meteor.Error('Delete stream failed', err.message);\r\n    }\r\n};\r\n\r\n\r\n//\r\n// â”€â”€â”€ GET STREAM BY NAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function getStreamByName(name) {\r\n    try {\r\n        var request = qrsSrv + \"/qrs/stream/full?filter=Name eq '\" + name + \"'\";\r\n        var response = HTTP.get(request, {\r\n            params: { xrfkey: senseConfig.xrfkey },\r\n            npmRequestOptions: configCerticates,\r\n            data: {}\r\n        });\r\n\r\n        return response.data[0];\r\n    } catch (err) {\r\n        console.error(err);\r\n        throw Error('get streamByName failed', err.message);\r\n    }\r\n}\r\n\r\n//\r\n// â”€â”€â”€ GET STREAMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function getStreams() {\r\n    try {\r\n        const call = {};\r\n        call.action = 'Get list of streams';\r\n        call.request = qrsSrv + '/qrs/stream/full';\r\n        call.response = HTTP.get(call.request, {\r\n            params: { xrfkey: senseConfig.xrfkey },\r\n            npmRequestOptions: configCerticates,\r\n            data: {}\r\n        });\r\n        // REST_Log(call);        \r\n        return call.response.data;\r\n    } catch (err) {\r\n        console.error(err);\r\n        throw new Meteor.Error('getStreams failed', err.message);\r\n    }\r\n};\r\n\r\n//\r\n// â”€â”€â”€ CREATE STREAM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nexport function createStream(name, generationUserId) {\r\n    console.log('QRS Functions Stream, create the stream with name', name);\r\n\r\n\r\n    try {\r\n        check(name, String);\r\n        var response = qrs.post('/qrs/stream', null, { name: name });\r\n\r\n        // Meteor.call('updateLocalSenseCopy');\r\n        //logging\r\n        const call = {\r\n            action: 'Create stream',\r\n            url: gitHubLinks.createStream,\r\n            request: \"HTTP.post(qlikServer + '/qrs/stream', { headers: \" + JSON.stringify(authHeaders) + \", params: { 'xrfkey': \" + senseConfig.xrfkey + \"}, data: { name: \" + name + \"}}) --> USE OF HEADER AUTH ONLY FOR DEMO/REVERSE PROXY PURPOSES\",\r\n            response: response\r\n        };\r\n\r\n        REST_Log(call, generationUserId);\r\n        console.log('Create stream call.response;', call.response)\r\n        return call.response;\r\n    } catch (err) {\r\n        console.error(err);\r\n        throw new Meteor.Error('Create stream failed ', err.message);\r\n    }\r\n};\r\n\r\n\r\nMeteor.methods({\r\n    deleteStream(guid) {\r\n        check(guid, String);\r\n        //logging only\r\n        const call = {};\r\n        call.action = 'Delete stream';\r\n        call.request = 'Delete stream: ' + guid;\r\n        REST_Log(call);\r\n\r\n        const id = deleteStream(guid, Meteor.userId());\r\n        Meteor.call('updateLocalSenseCopy');\r\n        return id;\r\n    },\r\n    createStream(name) {\r\n        const streamId = createStream(name);\r\n        Meteor.call('updateLocalSenseCopy');\r\n\r\n        //store in the database that the user generated something, so we can later on remove it.\r\n        GeneratedResources.insert({\r\n            'generationUserId': Meteor.userId(),\r\n            'customer': null,\r\n            'streamId': streamId.data.id,\r\n            'appId': null\r\n        });\r\n        return streamId;\r\n    },\r\n    getStreams() {\r\n        return getStreams();\r\n    }\r\n});","import {\r\n    Meteor\r\n} from 'meteor/meteor';\r\n// import { APILogs } from '/imports/api/APILogs';\r\nvar fs = require('fs-extra');\r\nconst path = require('path');\r\n\r\nimport {\r\n    qrs,\r\n    validateJSON\r\n} from '/imports/api/config.js';\r\nimport * as QSLic from '/imports/api/server/QRSFunctionsLicense';\r\n\r\nexport function getSecurityRules(name) {\r\n    return QSLic.getSystemRules(name);\r\n}\r\n\r\nexport function disableDefaultSecurityRules() {\r\n    console.log('------------------------------------');\r\n    console.log('disable Default SecurityRules')\r\n    console.log('------------------------------------');\r\n\r\n    for (let ruleName of Meteor.settings.security.rulesToDisable) {\r\n        console.log('From Meteor.settings.security.rulesToDisable, Disable security rule: ', ruleName)\r\n\r\n        var ruleDefinition = QSLic.getSystemRules(ruleName)[0];\r\n        if (ruleDefinition) {\r\n            ruleDefinition.disabled = true;\r\n            var response = qrs.put('/qrs/SystemRule/' + ruleDefinition.id, null, ruleDefinition);\r\n        } else {\r\n            console.warn('The system rule does not exist in Sense: ' + ruleName);\r\n        }\r\n    };\r\n}\r\n\r\nexport async function createSecurityRules() {\r\n    console.log('------------------------------------');\r\n    console.log('create security rules in Qlik Sense based on import file');\r\n    console.log('------------------------------------');\r\n\r\n    var file = path.join(Meteor.settings.broker.automationBaseFolder, 'securityrules', 'import', 'securityRuleSettings.json');\r\n\r\n    // READ THE FILE \r\n    var securityRules = await fs.readJson(file);\r\n    try {\r\n        validateJSON(securityRules)\r\n    } catch (err) {\r\n        throw new Error('Cant read the security rule definitions file: ' + file);\r\n    }\r\n\r\n    securityRules.forEach(function(rule) {\r\n        //check if the rule already exists in Sense\r\n        if (!QSLic.getSystemRules(rule.name).length) {\r\n            //if not exist, create it\r\n            var response = qrs.post('/qrs/SystemRule', null, rule);\r\n        } else {\r\n            console.log('Security rule \"' + rule.name + '\" already existed');\r\n        }\r\n    });\r\n}\r\n\r\nfunction stringToJSON(myString) {\r\n    var myJSONString = JSON.stringify(myString);\r\n    var myEscapedJSONString = myJSONString.replace(/\\\\n/g, \"\\\\n\")\r\n        .replace(/\\\\'/g, \"\\\\'\")\r\n        .replace(/\\\\\"/g, '\\\\\"')\r\n        .replace(/\\\\&/g, \"\\\\&\")\r\n        .replace(/\\\\r/g, \"\\\\r\")\r\n        .replace(/\\\\t/g, \"\\\\t\")\r\n        .replace(/\\\\b/g, \"\\\\b\")\r\n        .replace(/\\\\f/g, \"\\\\f\");\r\n\r\n    console.log('myEscapedJSONString', myEscapedJSONString)\r\n}","import { Mongo } from 'meteor/mongo';\r\n\r\nexport const APILogs = new Mongo.Collection('apiLogs');\r\n\r\nexport function REST_Log(call, userId = 'Not defined') {\r\n    call.createDate = new Date();\r\n    call.generationUserId = userId;\r\n    if (Meteor.isServer) {\r\n        APILogs.rawCollection().insert(call);\r\n    } else {\r\n        APILogs.insert(call);\r\n    }\r\n    return;\r\n\r\n}\r\n","import { Mongo } from 'meteor/mongo';\r\n\r\nexport const Apps = new Mongo.Collection('apps');\r\nexport const TemplateApps = new Mongo.Collection('templateApps');\r\nexport const GeneratedResources = new Mongo.Collection('generatedResources');\r\n\r\n","import {\r\n    Mongo\r\n} from 'meteor/mongo';\r\nimport {\r\n    Random\r\n} from 'meteor/random';\r\nimport _ from 'meteor/underscore';\r\nconst _QIXSchema = require('/node_modules/enigma.js/schemas/qix/12.20.0/schema.json');\r\n\r\n//This is the config that we need to make available on the client (the webpage)\r\nif (Meteor.isClient) {\r\n    var _senseConfig = {\r\n        \"host\": Meteor.settings.public.qlikSenseHost,\r\n        \"port\": Meteor.settings.public.qlikSensePort,\r\n        \"virtualProxyClientUsage\": Meteor.settings.public.virtualProxyClientUsage,\r\n        \"virtualProxySlideGenerator\": Meteor.settings.public.slideGenerator.virtualProxy,\r\n        \"webIntegrationDemoPort\": Meteor.settings.public.webIntegrationDemoPort,\r\n        \"QIXSchema\": _QIXSchema,\r\n        //ssbi and slide generator app id are set automatically on main.js (client side, via a call to the server)\r\n        // config.SSBIAppId = \r\n        // config.slideGeneratorAppId = \r\n    };\r\n}\r\n\r\n\r\n//SERVER SIDE\r\nif (Meteor.isServer) {\r\n    console.log('This Sense SaaS demo tool uses this config as defined in the settings-XYZ.json file in the root folder: ', Meteor.settings.private);\r\n    import crypto from 'crypto';\r\n    var fs = require('fs-extra');\r\n    const path = require('path');\r\n    // import fs from 'fs';\r\n    import {\r\n        myQRS\r\n    } from '/imports/api/server/QRSAPI';\r\n    const bluebird = require('bluebird');\r\n    const WebSocket = require('ws');\r\n\r\n    var _senseConfig = {\r\n        \"host\": Meteor.settings.public.qlikSenseHost,\r\n        \"SenseServerInternalLanIP\": Meteor.settings.private.SenseServerInternalLanIP,\r\n        \"port\": Meteor.settings.public.qlikSensePort,\r\n        \"useSSL\": Meteor.settings.private.useSSL,\r\n        \"xrfkey\": generateXrfkey(),\r\n        \"virtualProxy\": Meteor.settings.private.virtualProxy, //used to connect via REST to Sense, we authenticate via a http header. not for production!!!\r\n        \"virtualProxyClientUsage\": Meteor.settings.public.virtualProxyClientUsage,\r\n        \"headerKey\": Meteor.settings.private.headerKey,\r\n        \"headerValue\": process.env.USERDOMAIN + '\\\\' + process.env.USERNAME, //\"QLIK-AB0Q2URN5T\\\\Qlikexternal\",\r\n        \"isSecure\": Meteor.settings.private.isSecure,\r\n        \"qrsPort\": Meteor.settings.private.qrsPort,\r\n        \"enginePort\": Meteor.settings.private.enginePort\r\n    };\r\n\r\n    if (missingParameters(_senseConfig)) {\r\n        throw 'Missing parameters in _senseConfig, you did not populate the settings.json file in the project root of MeteorQRS, or with docker: did you mount the volume with the config including the settings.json file? (with the correct name)';\r\n    }\r\n\r\n    if (!_senseConfig.host) {\r\n        throw new Meteor.Error('You have not started this meteor project with: meteor --settings settings-development.json ? You missed the reference to this settings file, or it is empty?');\r\n    }\r\n\r\n    //CONFIG FOR HTTP MODULE WITH HEADER AUTH (TO MAKE REST CALLS TO SENSE VIA HTTP CALLS)\r\n    export const authHeaders = {\r\n            'hdr-usr': _senseConfig.headerValue,\r\n            'X-Qlik-xrfkey': _senseConfig.xrfkey\r\n        } //\r\n    if (!Meteor.settings.private.certificatesDirectory) {\r\n        Meteor.settings.private.certificatesDirectory = 'C:\\\\ProgramData\\\\Qlik\\\\Sense\\\\Repository\\\\Exported Certificates\\\\.Local Certificates';\r\n        console.log('Meteor.settings.private.certificatesDirectory was empty, setting it to default: ', Meteor.settings.broker.customerDataDir)\r\n    }\r\n    export const _certs = {\r\n        ca: fs.readFileSync(Meteor.settings.private.certificatesDirectory + '/root.pem'),\r\n        key: fs.readFileSync(Meteor.settings.private.certificatesDirectory + '/client_key.pem'),\r\n        cert: fs.readFileSync(Meteor.settings.private.certificatesDirectory + '/client.pem'),\r\n    }\r\n\r\n    //if you use windows and this tool runs on the same machine, you can keep the parameters empty\r\n    // and we use the user the node service runs under... \r\n    var qlikUserDomain = '';\r\n    var qlikUser = '';\r\n\r\n    if (!Meteor.settings.broker.connectToSenseAsUserDirectory) {\r\n        qlikUserDomain = process.env.USERDOMAIN;\r\n        qlikUser = process.env.USERNAME;\r\n    } else {\r\n        qlikUserDomain = Meteor.settings.broker.connectToSenseAsUserDirectory;\r\n        qlikUser = Meteor.settings.broker.connectToSenseAsUser\r\n    }\r\n\r\n    export var configCerticates = {\r\n        rejectUnauthorized: false,\r\n        hostname: _senseConfig.SenseServerInternalLanIP,\r\n        headers: {\r\n            'x-qlik-xrfkey': _senseConfig.xrfkey,\r\n            'X-Qlik-User': `UserDirectory=${qlikUserDomain};UserId=${qlikUser}`, //`UserDirectory=INTERNAL;UserId=sa_repository` you need to give this user extra roles before this works\r\n            'Content-Type': 'application/json'\r\n        },\r\n        key: _certs.key,\r\n        cert: _certs.cert,\r\n        ca: _certs.ca\r\n    };\r\n    console.log('configCerticates: we connect to Qlik Sense using these credentials: ', configCerticates);\r\n\r\n    //used for engimaJS, the engine API javascript wrapper\r\n    var _engineConfig = {\r\n        host: _senseConfig.SenseServerInternalLanIP,\r\n        isSecure: _senseConfig.isSecure,\r\n        port: Meteor.settings.private.enginePort,\r\n        headers: {\r\n            'X-Qlik-User': `UserDirectory=${qlikUserDomain};UserId=${qlikUser}`,\r\n        },\r\n        ca: _certs.ca,\r\n        key: _certs.key,\r\n        cert: _certs.cert,\r\n        passphrase: Meteor.settings.private.passphrase,\r\n        rejectUnauthorized: false, // Don't reject self-signed certs\r\n        appname: null,\r\n        QIXSchema: _QIXSchema\r\n    };\r\n\r\n    export const enigmaServerConfig = {\r\n        schema: _engineConfig.QIXSchema,\r\n        // appId: appId,\r\n        session: {\r\n            host: _engineConfig.host,\r\n            port: _engineConfig.port,\r\n        },\r\n        Promise: bluebird,\r\n        createSocket(url) {\r\n            return new WebSocket(url, {\r\n                ca: _certs.ca,\r\n                key: _certs.key,\r\n                cert: _certs.cert,\r\n                headers: {\r\n                    'X-Qlik-User': `UserDirectory=${qlikUserDomain};UserId=${qlikUser}`,\r\n                },\r\n            });\r\n        },\r\n        // handleLog: logRow => console.log(JSON.stringify(logRow)),\r\n    }\r\n\r\n\r\n    export function validateJSON(body) {\r\n        try {\r\n            var data = JSON.parse(body);\r\n            // if came to here, then valid\r\n            return data;\r\n        } catch (e) {\r\n            // failed to parse\r\n            return null;\r\n        }\r\n    }\r\n\r\n    //for enigma.js\r\n    export const engineConfig = _engineConfig;\r\n    //for general (mostly client side) stuff\r\n\r\n    // Qlik sense QRS endpoint via header authentication\r\n    export const qlikHDRServer = 'http://' + _senseConfig.SenseServerInternalLanIP + ':' + _senseConfig.port + '/' + _senseConfig.virtualProxy;\r\n    export const qrsSrv = 'https://' + _senseConfig.SenseServerInternalLanIP + ':' + _senseConfig.qrsPort;\r\n\r\n    export const qrs = new myQRS();\r\n\r\n    function generateXrfkey() {\r\n        return Random.hexString(16);\r\n    }\r\n\r\n    // //https://www.npmjs.com/package/qrs\r\n    //HEADER AUTHENTICATION\r\n    export const QRSconfig = {\r\n        authentication: 'header',\r\n        host: _senseConfig.host,\r\n        port: _senseConfig.port,\r\n        useSSL: false,\r\n        virtualProxy: _senseConfig.virtualProxy, //header proxy\r\n        headerKey: _senseConfig.headerKey,\r\n        headerValue: _senseConfig.headerValue, //'mydomain\\\\justme'\r\n    };\r\n\r\n    try {\r\n        Meteor.startup(async function() {\r\n            console.log('------------------------------------');\r\n            console.log('Validate settings.json parameters');\r\n            console.log('------------------------------------');\r\n            Meteor.absolutePath = path.resolve('.').split(path.sep + '.meteor')[0];\r\n            console.log('Meteor tries to find the settings.json file in Meteor.absolutePath:', Meteor.absolutePath)\r\n            var file = path.join(Meteor.absolutePath, 'settings-development-example.json');\r\n\r\n            // READ THE FILE \r\n            var exampleSettingsFile = await fs.readJson(file);\r\n            try {\r\n                validateJSON(exampleSettingsFile)\r\n            } catch (err) {\r\n                throw new Error('Meteor wants to check your settings.json with the parameters in the example settings.json in the project root. Error: Cant read the example settings definitions file (not valid JSON): ' + file);\r\n            }\r\n\r\n            var keysEqual = compareKeys(Meteor.settings, exampleSettingsFile);\r\n            console.log('Settings file has all the keys as specified in the example json file?', keysEqual)\r\n            if (!keysEqual) {\r\n                console.error('Settings file incomplete, Please verify if you have all the keys as specified in the settings-development-example.json in the project root folder. In my dev environment: C:\\Users\\Qlikexternal\\Documents\\GitHub\\QRSMeteor');\r\n                throw new Error('Settings file incomplete, Please verify if you have all the keys as specified in the settings-development-example.json in the project root folder. In my dev environment: C:\\Users\\Qlikexternal\\Documents\\GitHub\\QRSMeteor');\r\n            }\r\n        })\r\n\r\n    } catch (error) {\r\n        throw new Error(error);\r\n    }\r\n} //exit server side config\r\n\r\nexport const senseConfig = _senseConfig;\r\n\r\n// console.log('--- HEADER AUTHENTICATION using config: ', QRSconfig);\r\n\r\n// //certificates did not work\r\n// export const QRSconfig = {\r\n//     authentication: 'certificates',\r\n//     host: senseConfig.host,\r\n//     useSSL: false,\r\n//     ca: _engineConfig.ca,\r\n//     key: _engineConfig.key,\r\n//     cert: _engineConfig.cert,\r\n//     port: Meteor.settings.private.qrsPort, //4242\r\n//     headerKey: 'X-Qlik-User',\r\n//     headerValue: `UserDirectory=${process.env.USERDOMAIN};UserId=${process.env.USERNAME}`\r\n// };\r\n\r\nexport function missingParameters(obj) {\r\n    for (var key in obj) {\r\n        if (obj[key] !== null && obj[key] != \"\")\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function compareKeys(a, b) {\r\n    var aKeys = Object.keys(a).sort();\r\n    var bKeys = Object.keys(b).sort();\r\n    return JSON.stringify(aKeys) === JSON.stringify(bKeys);\r\n}","import { Mongo } from 'meteor/mongo';\r\nexport const Customers = new Mongo.Collection('customers');\r\n\r\nMeteor.methods({\r\n        updateUserForCustomer(updatedUser) {\r\n            var selection = {\r\n                'generationUserId': Meteor.userId(),\r\n                'users.name': updatedUser.name\r\n            };\r\n            Customers.update(\r\n                selection, { $set: { 'users.$': updatedUser } });\r\n        },\r\n    })\r\n\r\nCustomers.attachSchema(new SimpleSchema({\r\n    name: {\r\n        type: String,\r\n        label: \"Customer name\"\r\n    },\r\n    checked: {\r\n        type: Boolean,\r\n        label: \"Selected for the generation?\",\r\n        optional: true,\r\n        defaultValue: true\r\n    },\r\n    createdAt: {\r\n        type: Date,\r\n        label: \"Date created\",\r\n        optional: true\r\n    },\r\n    createdBy: {\r\n        type: Object,\r\n        label: \"Date created\",\r\n        optional: true\r\n    },\r\n    generationUserId: {\r\n        type: String,\r\n        autoValue: function() {\r\n            return this.userId;\r\n        }\r\n    },\r\n    users: {\r\n        type: [Object],\r\n        optional: true\r\n    },\r\n    \"users.$\": {\r\n        type: Object\r\n    },\r\n    \"users.$.name\": {\r\n        type: String\r\n    },\r\n    \"users.$.group\": {\r\n        type: String,\r\n        allowedValues: ['Consumer', 'Contributor', 'Developer', 'Admin', 'Global auditor']\r\n    },\r\n    \"users.$.currentlyLoggedIn\": {\r\n        type: Boolean,\r\n        optional: true\r\n    },\r\n    \"users.$.country\": {\r\n        type: String,\r\n        allowedValues: ['Germany', 'United States', 'Italy']\r\n    }\r\n}));\r\n\r\nexport const dummyCustomer = {\r\n    \"name\": faker.company.companyName(),\r\n    \"checked\": true,\r\n    \"user\": {\r\n        \"name\": 'John',\r\n        \"group\": \"Consumer\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"Germany\"\r\n    }\r\n};\r\n\r\nexport const dummyCustomers = [{\r\n        \"name\": faker.company.companyName(),\r\n        \"checked\": true,\r\n        \"users\": [{\r\n            \"name\": 'John',\r\n            \"group\": \"Consumer\",\r\n            \"currentlyLoggedIn\": false,\r\n            \"country\": \"Germany\"\r\n        }, {\r\n            \"name\": 'Linda',\r\n            \"group\": \"Contributor\",\r\n            \"currentlyLoggedIn\": false,\r\n            \"country\": \"United States\"\r\n        }, {\r\n            \"name\": 'Martin',\r\n            \"group\": \"Developer\",\r\n            \"currentlyLoggedIn\": false,\r\n            \"country\": \"Italy\"\r\n        }, {\r\n            \"name\": 'Paul',\r\n            \"group\": \"Admin\",\r\n            \"currentlyLoggedIn\": false,\r\n            \"country\": \"Italy\"\r\n        }]\r\n    }, {\r\n        \"name\": faker.company.companyName(),\r\n        \"checked\": true,\r\n        \"users\": [{\r\n            \"name\": faker.name.findName(),\r\n            \"group\": \"Consumer\",\r\n            \"currentlyLoggedIn\": false,\r\n            \"country\": \"Italy\"\r\n        }]\r\n    }, {\r\n        \"name\": faker.company.companyName(),\r\n        \"checked\": true,\r\n        \"users\": [{\r\n            \"name\": faker.name.findName(),\r\n            \"group\": \"Consumer\",\r\n            \"currentlyLoggedIn\": false,\r\n            \"country\": \"Italy\"\r\n        }]\r\n    }\r\n    // {\r\n    //     \"name\": \"QPMG Accountants\",\r\n    //     \"checked\": true,\r\n    //     \"users\": [{\r\n    //         \"name\": \"Ron\",\r\n    //         \"group\": \"Global Auditor\",\r\n    //         \"currentlyLoggedIn\": false,\r\n    //         \"country\": \"Italy\"\r\n    //     }]\r\n    // }\r\n\r\n\r\n\r\n\r\n    // { \"name\": \"A&R Partners\", \"checked\": true },\r\n    //     { \"name\": \"A2Z Solutions\", \"checked\": true },\r\n    //     { \"name\": \"Aaron D. Meyer & Associates\", \"checked\": true },\r\n    //     { \"name\": \"Aaron Products\", \"checked\": true },\r\n    // { \"name\": \"Active Data\", \"checked\": true },\r\n    // { \"name\": \"Ben and Jerryâ€™s\", \"checked\": true },\r\n    // { \"name\": \"Benedict\", \"checked\": true },\r\n    // { \"name\": \"Bizmarts\", \"checked\": true },\r\n    // { \"name\": \"C & C  Design\", \"checked\": true },\r\n    // { \"name\": \"C & J Engineering\", \"checked\": true },\r\n    // { \"name\": \"CAF Systemhaus\", \"checked\": true },\r\n    // { \"name\": \"CAM Group\", \"checked\": true },\r\n    // { \"name\": \"Caribian Specialties\", \"checked\": true },\r\n    // { \"name\": \"City Fresh Foods\", \"checked\": true },\r\n    // { \"name\": \"Clearout\", \"checked\": true },\r\n    // { \"name\": \"David Spencer Ltd.\", \"checked\": true },\r\n    // { \"name\": \"Dayton Malleable Inc.\", \"checked\": true },\r\n    // { \"name\": \"DCP Research\", \"checked\": true },\r\n    // { \"name\": \"DCS International\", \"checked\": true },\r\n    // { \"name\": \"DCS Laboratory\", \"checked\": true },\r\n    // { \"name\": \"Deak-Perera Group.\", \"checked\": true },\r\n    // { \"name\": \"Earth\", \"checked\": true },\r\n    // { \"name\": \"eDistrict\", \"checked\": true },\r\n    // { \"name\": \"EDP\", \"checked\": true },\r\n    // { \"name\": \"Ethyl Corporation\", \"checked\": true },\r\n    // { \"name\": \"Federal Focus\", \"checked\": true },\r\n    // { \"name\": \"Fill It\", \"checked\": true },\r\n    // { \"name\": \"Filmotype\", \"checked\": true },\r\n    // { \"name\": \"Fins\", \"checked\": true },\r\n    // { \"name\": \"Gate\", \"checked\": true },\r\n    // { \"name\": \"Gulf and Western Industries\", \"checked\": true },\r\n    // { \"name\": \"Harte-Hanks (formerly Locator)\", \"checked\": true },\r\n    // { \"name\": \"Harvard Trust Company\", \"checked\": true },\r\n    // { \"name\": \"HCHS\", \"checked\": true },\r\n    // { \"name\": \"Healtheon\", \"checked\": true },\r\n    // { \"name\": \"Hetrick Systems\", \"checked\": true },\r\n    // { \"name\": \"Home Team\", \"checked\": true },\r\n    // { \"name\": \"Homebound\", \"checked\": true },\r\n    // { \"name\": \"IBVA\", \"checked\": true },\r\n    // { \"name\": \"Icon\", \"checked\": true },\r\n    // { \"name\": \"Icon Site Builders\", \"checked\": true },\r\n    // { \"name\": \"Idyllwild\", \"checked\": true },\r\n    // { \"name\": \"J. S. Lee Associates\", \"checked\": true },\r\n    // { \"name\": \"K International\", \"checked\": true },\r\n    // { \"name\": \"K.C. Irving\", \"checked\": true },\r\n    // { \"name\": \"Kari & Associates\", \"checked\": true },\r\n    // { \"name\": \"Karsing\", \"checked\": true },\r\n    // { \"name\": \"Kazinformcom\", \"checked\": true },\r\n    // { \"name\": \"KentISP\", \"checked\": true },\r\n    // { \"name\": \"Kool-Seal\", \"checked\": true },\r\n    // { \"name\": \"Laker Airways\", \"checked\": true },\r\n    // { \"name\": \"Livermore  Laboratories (LSLI)\", \"checked\": true },\r\n    // { \"name\": \"LiveWire BBS and   Favourite Links\", \"checked\": true },\r\n    // { \"name\": \"MATRIX\", \"checked\": true },\r\n    // { \"name\": \"Miles Laboratories, Inc.\", \"checked\": true },\r\n    // { \"name\": \"NACSCORP\", \"checked\": true },\r\n    // { \"name\": \"Onestar\", \"checked\": true },\r\n    // { \"name\": \"Pace\", \"checked\": true },\r\n    // { \"name\": \"Pacific Group\", \"checked\": true },\r\n    // { \"name\": \"Pacific Matics\", \"checked\": true },\r\n    // { \"name\": \"Pacific Sierra Research\", \"checked\": true },\r\n    // { \"name\": \"Pacific Voice\", \"checked\": true },\r\n    // { \"name\": \"Pacific West Enterprises\", \"checked\": true },\r\n    // { \"name\": \"PacificServ\", \"checked\": true },\r\n    // { \"name\": \"Panngea\", \"checked\": true },\r\n    // { \"name\": \"PAP (Maintenance)\", \"checked\": true },\r\n    // { \"name\": \"Paracel\", \"checked\": true },\r\n    // { \"name\": \"Patient\", \"checked\": true },\r\n    // { \"name\": \"Pinnacle Micro\", \"checked\": true },\r\n    // { \"name\": \"QualServe\", \"checked\": true },\r\n    // { \"name\": \"Quantum 4Xyte  Architects\", \"checked\": true },\r\n    // { \"name\": \"Qwest\", \"checked\": true },\r\n    // { \"name\": \"R&R Group\", \"checked\": true },\r\n    // { \"name\": \"R.J. Matter & Associates\", \"checked\": true },\r\n    // { \"name\": \"Ra Co Amo\", \"checked\": true },\r\n    // { \"name\": \"RC\", \"checked\": true },\r\n    // { \"name\": \"Ready-to-Run\", \"checked\": true },\r\n    // { \"name\": \"Remedy\", \"checked\": true },\r\n    // { \"name\": \"Renegade info Crew\", \"checked\": true },\r\n    // { \"name\": \"Reuters Usability Group\", \"checked\": true },\r\n    // { \"name\": \"ReviewBooth\", \"checked\": true },\r\n    // { \"name\": \"RFI Corporation\", \"checked\": true },\r\n    // { \"name\": \"Road Warrior International\", \"checked\": true },\r\n    // { \"name\": \"Robust Code\", \"checked\": true },\r\n    // { \"name\": \"Sage\", \"checked\": true },\r\n    // { \"name\": \"Sagent\", \"checked\": true },\r\n    // { \"name\": \"Salamander Junction\", \"checked\": true },\r\n    // { \"name\": \"Satronix\", \"checked\": true },\r\n    // { \"name\": \"Satyam\", \"checked\": true },\r\n    // { \"name\": \"Scientific Atlanta\", \"checked\": true },\r\n    // { \"name\": \"ScotGold Products\", \"checked\": true },\r\n    // { \"name\": \"Screen Saver.com\", \"checked\": true },\r\n    // { \"name\": \"Sifton Properties Limited\", \"checked\": true },\r\n    // { \"name\": \"Sigma\", \"checked\": true },\r\n    // { \"name\": \"Signature\", \"checked\": true },\r\n    // { \"name\": \"SignatureFactory\", \"checked\": true },\r\n    // { \"name\": \"Soloman Brothers\", \"checked\": true },\r\n    // { \"name\": \"Southern Company\", \"checked\": true },\r\n    // { \"name\": \"Stone Consolidated Corporation\", \"checked\": true },\r\n    // { \"name\": \"Talou\", \"checked\": true },\r\n    // { \"name\": \"Tampere\", \"checked\": true },\r\n    // { \"name\": \"Tandy Corporation\", \"checked\": true },\r\n    // { \"name\": \"Tangent\", \"checked\": true },\r\n    // { \"name\": \"Tao Group\", \"checked\": true },\r\n    // { \"name\": \"Target Marketing\", \"checked\": true },\r\n    // { \"name\": \"Team ASA\", \"checked\": true },\r\n    // { \"name\": \"Team Financial Management Systems\", \"checked\": true },\r\n    // { \"name\": \"Teca-Print\", \"checked\": true },\r\n    // { \"name\": \"Time Warner\", \"checked\": true },\r\n    // { \"name\": \"Towmotor Corporation\", \"checked\": true },\r\n    // { \"name\": \"Tredegar Company\", \"checked\": true },\r\n    // { \"name\": \"Trend Line Corporation\", \"checked\": true },\r\n    // { \"name\": \"U. S. Exchange\", \"checked\": true },\r\n    // { \"name\": \"Unison Management Concepts\", \"checked\": true },\r\n    // { \"name\": \"United States  (USIT)\", \"checked\": true },\r\n    // { \"name\": \"UUmail\", \"checked\": true },\r\n    // { \"name\": \"ValiCert\", \"checked\": true },\r\n    // { \"name\": \"Valley  Solutions\", \"checked\": true },\r\n    // { \"name\": \"Valpatken\", \"checked\": true },\r\n    // { \"name\": \"Vanstar\", \"checked\": true },\r\n    // { \"name\": \"Venable\", \"checked\": true },\r\n    // { \"name\": \"Venred\", \"checked\": true },\r\n    // { \"name\": \"Watcom International\", \"checked\": true },\r\n    // { \"name\": \"Xentec\", \"checked\": true },\r\n    // { \"name\": \"Xilinx\", \"checked\": true },\r\n    // { \"name\": \"XVT\", \"checked\": true },\r\n    // { \"name\": \"Zero Assumption Recovery\", \"checked\": true },\r\n    // { \"name\": \"Zilog\", \"checked\": true },\r\n    // { \"name\": \"Zitel\", \"checked\": true },\r\n]\r\n","import { Mongo } from 'meteor/mongo';\r\n \r\nexport const Streams = new Mongo.Collection('streams');\r\n","\r\nAccountsTemplates.configure({\r\n    // Behavior\r\n    confirmPassword: false,\r\n    enablePasswordChange: true,\r\n    forbidClientAccountCreation: false,\r\n    overrideLoginErrors: true,\r\n    sendVerificationEmail: false,\r\n    lowercaseUsername: false,\r\n    focusFirstInput: true,\r\n\r\n    // Appearance\r\n    showAddRemoveServices: false,\r\n    showForgotPasswordLink: false,\r\n    showLabels: true,\r\n    showPlaceholders: true,\r\n    showResendVerificationEmailLink: false,\r\n\r\n    // Client-side Validation\r\n    continuousValidation: false,\r\n    negativeFeedback: false,\r\n    negativeValidation: true,\r\n    positiveValidation: true,\r\n    positiveFeedback: true,\r\n    showValidating: true,\r\n\r\n    // // Privacy Policy and Terms of Use\r\n    // privacyUrl: 'privacy',\r\n    // termsUrl: 'terms-of-use',\r\n\r\n    // Redirects\r\n    homeRoutePath: '/',\r\n    redirectTimeout: 4000,\r\n\r\n    // // Hooks\r\n    // onLogoutHook: myLogoutFunc,\r\n    // onSubmitHook: mySubmitFunc,\r\n    // preSignUpHook: myPreSubmitFunc,\r\n    // postSignUpHook: myPostSubmitFunc,\r\n\r\n    // Texts\r\n    texts: {\r\n      button: {\r\n          signUp: \"Register now to start using the Qlik Sense SaaS demo\"\r\n      },\r\n      socialSignUp: \"Register\",\r\n      socialIcons: {\r\n          \"meteor-developer\": \"fa fa-rocket\"\r\n      },\r\n      title: {\r\n          forgotPwd: \"Recover Your Password\"\r\n      },\r\n    },\r\n});\r\n\r\nAccountsTemplates.configureRoute('signIn');\r\nAccountsTemplates.configureRoute('changePwd');\r\n// AccountsTemplates.configureRoute('enrollAccount');\r\n// AccountsTemplates.configureRoute('forgotPwd');\r\n// AccountsTemplates.configureRoute('resetPwd');\r\nAccountsTemplates.configureRoute('signUp');\r\n\r\n","    // import meteor collections\r\n    import {\r\n        Apps,\r\n        TemplateApps\r\n    } from '/imports/api/apps';\r\n    import {\r\n        Streams\r\n    } from '/imports/api/streams';\r\n    import {\r\n        Customers\r\n    } from '/imports/api/customers';\r\n    import {\r\n        senseConfig\r\n    } from '/imports/api/config';\r\n\r\n\r\n    export var gitHubLinks = {\r\n        createStream: 'https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsStream.js#L53',\r\n        copyApp: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L175\",\r\n        replaceAndReloadApp: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L69\",\r\n        publishApp: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L281\",\r\n        requestTicket: \"https://github.com/QHose/QRSMeteor/blob/50bf903dc67d8d1b3757b572e8b2dedbb63202da/imports/api/server/QPSFunctions.js#L213\",\r\n        createPasport: \"https://github.com/QHose/QRSMeteor/blob/50bf903dc67d8d1b3757b572e8b2dedbb63202da/imports/api/server/QPSFunctions.js#L56\",\r\n        redirectURLReceived: \"https://github.com/QHose/QRSMeteor/blob/master/imports/SSO/client/SSO.js#L88\",\r\n        deleteApp: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L263\",\r\n        logoutUser: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QPSFunctions.js#L174\",\r\n        saveApp: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L127\",\r\n        getScript: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L94\",\r\n        setScript: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L106\",\r\n        reloadApp: \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QRSFunctionsApp.js#L119\",\r\n    };\r\n\r\n    if (Meteor.isClient) {\r\n        var Cookies = require('js-cookie');\r\n\r\n        // console.log('Setup generic helper functions, for functions every template needs');\r\n        Template.registerHelper('formatDate', function(date) {\r\n            return moment(date)\r\n                .format('DD-MM-YYYY');\r\n        });\r\n\r\n        // // Template.registerHelper('formatNumber', function(myNumber) {\r\n        //     var commaFormat = d3.format(\",\");\r\n        //     // The expression /,/g is a regular expression that matches all commas.\r\n        //     return commaFormat(myNumber)\r\n        //         .replace(/,/g, \".\");\r\n        // });\r\n\r\n        Template.registerHelper('URL_Youtube_howToDemo', function() {\r\n            return 'https://www.youtube.com/embed/OulQS-1fH-A?list=PLqJfqgR62cVAZxS34WGnByjASKrGf0Fpk';\r\n        });\r\n        Template.registerHelper('URL_Youtube_quickIntro', function() {\r\n            return '';\r\n        });\r\n\r\n        Template.registerHelper('URL_Youtube_1mflashyIntro', function() {\r\n            return 'https://www.youtube.com/embed/W3gDKdv6K8Y';\r\n        });\r\n\r\n        Template.registerHelper('URL_Youtube_playlist', function() {\r\n            return 'https://www.youtube.com/playlist?list=PLqJfqgR62cVAZxS34WGnByjASKrGf0Fpk';\r\n        });\r\n        Template.registerHelper('URL_Youtube_integrated_flow', function() {\r\n            return \"https://www.youtube.com/embed/M49nv6on5Eg?list=PLqJfqgR62cVAZxS34WGnByjASKrGf0Fpk\";\r\n        });\r\n\r\n        Template.registerHelper('URL_Youtube_generic_security_intro', function() {\r\n            return \"https://www.youtube.com/embed/sdCVsMzTf64\";\r\n        });\r\n\r\n\r\n        Template.registerHelper('URL_Youtube_webintegration_introduction', function() {\r\n            return \"https://www.youtube.com/embed/zuNvZ_UTmow?list=PLqJfqgR62cVAZxS34WGnByjASKrGf0Fpk\";\r\n        });\r\n\r\n        //QAP\r\n        Template.registerHelper('URL_Youtube_webintegration_extended', function() {\r\n            return \"https://www.youtube.com/embed/yLTqzftDa7s\";\r\n        });\r\n\r\n        Template.registerHelper('URL_Youtube_architecture_introduction', function() {\r\n            return \"https://www.youtube.com/embed/sv5nKDvmRPI?list=PLqJfqgR62cVAZxS34WGnByjASKrGf0Fpk\";\r\n        });\r\n\r\n        Template.registerHelper('URL_Youtube_security_introduction', function() {\r\n            return \"https://www.youtube.com/embed/XJ9dOHoMiXE?list=PLqJfqgR62cVAZxS34WGnByjASKrGf0Fpk\";\r\n        });\r\n\r\n        Template.registerHelper('URL_Youtube_security_deepDive', function() {\r\n            return \"https://www.youtube.com/embed/iamo6RLc5Pg\";\r\n        });\r\n\r\n        Template.registerHelper('URL_Youtube_concept_behind', function() {\r\n            return \"https://www.youtube.com/embed/1PjcTFnC4Mo\";\r\n        });\r\n\r\n        Template.registerHelper('doc_demo_manual', function() {\r\n            return '/docs/How to demo the Qlik Sense SaaS demo platform.pdf';\r\n        });\r\n\r\n        Template.registerHelper('doc_sec_function_task_matrix', function() {\r\n            return '/docs/QlikSense Authorizations - Function and Tasks_Demo.xlsx';\r\n        });\r\n\r\n        Template.registerHelper('doc_securtityIntegration', function() {\r\n            return 'https://community.qlik.com/docs/DOC-17599';\r\n        });\r\n        Template.registerHelper('doc_processIntegration', function() {\r\n            return 'https://community.qlik.com/docs/DOC-17831';\r\n        });\r\n\r\n\r\n        Template.registerHelper('doc_integrationOverview', function() {\r\n            return 'https://community.qlik.com/docs/DOC-9533';\r\n        });\r\n\r\n        Template.registerHelper('doc_sourceCode', function() {\r\n            return '/docs/Qlik Sense SaaS demo tool documentation of source code.docx';\r\n        });\r\n\r\n        Template.registerHelper('doc_demo_setup_instructions', function() {\r\n            return '/docs/Qlik Sense SaaS demo tool setup instructions.docx';\r\n        });\r\n\r\n        Template.registerHelper('doc_webIntegration', function() {\r\n            return 'https://community.qlik.com/docs/DOC-17834';\r\n        });\r\n        Template.registerHelper('doc_dataIntegration', function() {\r\n            return 'https://onedrive.live.com/view.aspx?cid=0805405928a75727&id=documents&resid=805405928A75727%211330&app=OneNote&authkey=!ANwk5S8KPC__-dw&&wd=target%28%2F%2FEMBEDDED%20ANALYTICS.one%7Cbf2972be-48a0-46fa-af7a-f6d2f80cf06b%2FData%20integration%20Combine%20sources%20into%20one%20associative%20model%7Ce669a0a2-9a83-470e-aae8-ba63ac500038%2F%29';\r\n        });\r\n\r\n        Template.registerHelper('seq_ticketing_flow', function() {\r\n            return \"http://knsv.github.io/mermaid/live_editor/#/view/c2VxdWVuY2VEaWFncmFtCkJyb3dzZXItPj5NZXRlb3Igd2ViIGludGVncmF0aW9uIGRlbW86IFVzZXIgbG9ncyBpbiBpbnRvIE1ldGVvciAKQnJvd3Nlci0-PiBQcm94eTogSUZyYW1lIHRyaWVzIHRvIG9wZW4gU2Vuc2UgY29udGVudCB2aWEgbGluayB0aGF0IGNvbnRhaW5zIC9wcm94eS8KUHJveHktPj5NZXRlb3IgU1NPIGNsaWVudDogUmVkaXJlY3QgcmVxdWVzdCB0byB3ZWJwYWdlIG9uIHRoZSBjbGllbnQgKGNsaWVudCBzaWRlIHJvdXRlKS4KCk5vdGUgcmlnaHQgb2YgUHJveHk6IFByb3h5IGFsc28gaW5jbHVkZXMgdGFyZ2V0SWQgPSA8SUQgZm9yIHRoZSBvcmlnaW5hbCBVUkkgdGhhdCB0aGUgdXNlciB0cmllcyB0byBhY2Nlc3M-LCBhbmQgcHJveHlSZXN0VXJpID0gPHRoZSBVUkkgd2hlcmUgdGhlIGF1dGhlbnRpY2F0aW9uIG1vZHVsZSBjYW4gYWNjZXNzIHRoZSBSRVNUIEFQST4KTWV0ZW9yIFNTTyBjbGllbnQtPk1ldGVvciBzZXJ2ZXI6ICBjbGllbnQgY2FsbHMgKHVzZXIgYXdhcmUpIHNlcnZlciBzaWRlIG1ldGhvZApOb3RlIHJpZ2h0IG9mIE1ldGVvciBzZXJ2ZXI6IFNpbmNlIHRoZSB1c2VyIGlzIGFscmVhZHkgbG9nZ2VkIGluIGluIE1ldGVvciwgd2UgY2FuIHJlcXVlc3QgdGhlIHVzZXJJRCBhbmQgZ3JvdXAgbWVtYmVyc2hpcCBmcm9tIHRoZSBNZXRlb3Igc2Vzc2lvbi4gVHJ1c3QgbWVjaGFuaXNtOiBTZXJ2ZXIgaW1wb3J0ZWQgUWxpayBTZW5zZSBjbGllbnQgY2VydGlmaWNhdGUuCk1ldGVvciBzZXJ2ZXItPj5RUFMgQVBJOiBSZXF1ZXN0IHRpY2tldCBhdCBRUFMgQVBJLCBwcm92aWRlIHRoZSB1c2VySWQgYW5kIGdyb3VwcyBpbiBKU09OLgpOb3RlIHJpZ2h0IG9mIE1ldGVvciBzZXJ2ZXI6IE9wdGlvbmFsbHkgaW5jbHVkZSB0aGUgcmVkaXJlY3QgcGFyYW1ldGVyIHRvIGZvcndhcmQgdGhlIHVzZXIgYmFjayB0byB0aGUgcGFnZSBoZSBpbml0aWFsbHkgdHJpZWQgdG8gYWNjZXNzLgpRUFMgQVBJLS0-Pk1ldGVvciBzZXJ2ZXI6IFFQUyBBUEkgcmV0dXJucyBhIHRpY2tldCBudW1iZXIgKGFuZCBwb3NzaWJseSByZWRpcmVjdCBVUkwpIHdoaWNoIHlvdSBoYXZlIHRvIGFwcGVuZCBpbiB0aGUgVVJMIApNZXRlb3Igc2VydmVyLS0-PiBNZXRlb3Igd2ViIGludGVncmF0aW9uIGRlbW86IENyZWF0ZSBhIHJlZGlyZWN0IFVSTCB3aGljaCB0aGUgY2xpZW50IGNvZGUgY2FuIHB1dCBpbiB0aGUgYnJvd3NlciBVUkwgYmFyLiAKTm90ZSByaWdodCBvZiBNZXRlb3Igd2ViIGludGVncmF0aW9uIGRlbW86IENsaWVudCBzaWRlIGNvZGUsIHJlcGxhY2VzIHRoZSB1cmwgaW4gYnJvd3NlciwgYW5kIGZvcndhcmRzIHRoZSB1c2VyIHRvIFFsaWsgU2Vuc2UuIFVzZXIgbm93IHJlY2VpdmVzIGEgUWxpayBTZW5zZSBzZXNzaW9uIGNvb2tpZSAoc2VlIHZpcnR1YWwgcHJveHkgY29uZmlnKSwgYW5kIGFuZCBzdWNoIHNpbmdsZSBzaWduIG9uIGlzIGNvbmZpZ3VyZWQu\";\r\n        });\r\n\r\n        Template.registerHelper('github_create_stream', function() {\r\n            return gitHubLinks.createStream;\r\n        });\r\n\r\n        Template.registerHelper('github_copy_app', function() {\r\n            return gitHubLinks.copyApp;\r\n        });\r\n\r\n        Template.registerHelper('github_replace_and_reload_app', function() {\r\n            return gitHubLinks.replaceAndReloadApp;\r\n        });\r\n\r\n        Template.registerHelper('github_publish_app', function() {\r\n            return gitHubLinks.publishApp;\r\n        });\r\n\r\n        Template.registerHelper('github_logout_user', function() {\r\n            return \"https://github.com/QHose/QRSMeteor/blob/master/imports/api/server/QPSFunctions.js#L18\";\r\n        });\r\n\r\n        Template.registerHelper('senseServerHub', function() {\r\n            return 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + senseConfig.virtualProxyClientUsage + '/hub';\r\n        });\r\n\r\n        Template.registerHelper('senseServerDevHub', function() {\r\n            return 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + senseConfig.virtualProxyClientUsage + '/dev-hub';\r\n        });\r\n\r\n        Template.registerHelper('senseServerQMC', function() {\r\n            return 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + senseConfig.virtualProxyClientUsage + '/qmc';\r\n        });\r\n\r\n        Template.registerHelper('senseServer', function() {\r\n            return 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + senseConfig.virtualProxyClientUsage;\r\n        });\r\n\r\n        Template.registerHelper('webIntegrationDemo', function() {\r\n            return 'http://' + Meteor.settings.public.webIntegrationHost + ':' + Meteor.settings.public.webIntegrationDemoPort;\r\n        });\r\n\r\n        //Integration presentation Iframe selector\r\n        Template.registerHelper('IFrameURLChapterSelection', function() {\r\n            var appId = Cookies.get('slideGeneratorAppId'); //senseConfig.slideGeneratorAppId;\r\n            var IntegrationPresentationSelectionSheet = Meteor.settings.public.slideGenerator.selectionSheet; //'DYTpxv'; selection sheet of the slide generator\r\n            var proxy = Meteor.settings.public.slideGenerator.virtualProxy;\r\n            return 'http://' + senseConfig.host + ':' + senseConfig.port + '/' + proxy + '/single/?appid=' + appId + '&sheet=' + IntegrationPresentationSelectionSheet + '&opt=currsel';\r\n        });\r\n\r\n        // Template.registerHelper('authenticatedSlideGenerator', function() {\r\n        //     return Session.get('authenticatedSlideGenerator');\r\n        // });\r\n\r\n        Template.registerHelper('shrinkForSlideSorter', function() {\r\n            return Cookies.get('showSlideSorter') === \"true\" ? \"shrink\" : \"\"; //\r\n        });\r\n\r\n        Template.registerHelper('groupSelectedSlideGenerator', function() {\r\n            return Session.get('groupForPresentation'); //user selected a presentation type?\r\n        });\r\n\r\n        //role that defines your role in the whole integration.qlik.com site, based on this we make selections in the slide generator.\r\n        Template.registerHelper('mainUserRole', function() {\r\n            return Cookies.get('currentMainRole');\r\n        });\r\n\r\n        Template.registerHelper('isSelected', function() {\r\n            return someValue ? 'selected' : '';\r\n        });\r\n\r\n        Template.registerHelper('customers', function() {\r\n            return Customers.find({});\r\n        });\r\n\r\n        //used for Aldeed autoform\r\n        Template.registerHelper(\"Customers\", Customers);\r\n\r\n        Template.registerHelper('noCustomers', function() {\r\n            return !Customers.find({})\r\n                .count();\r\n        });\r\n\r\n        Template.registerHelper('noTemplateApps', function() {\r\n            return !TemplateApps.find({})\r\n                .count();\r\n        });\r\n\r\n        //generic helpers to return the collection to the blaze template\r\n        Template.registerHelper('customersCollection', function() {\r\n            return Customers.find({}, {\r\n                sort: {\r\n                    checked: -1\r\n                }\r\n            });\r\n        });\r\n\r\n        Template.registerHelper('templateAppsCollection', function() {\r\n            return TemplateApps.find();\r\n        });\r\n\r\n        Template.registerHelper('appsCollection', function() {\r\n            return Apps.find();\r\n        });\r\n\r\n        Template.registerHelper('streamsCollection', function() {\r\n            return Streams.find();\r\n        });\r\n\r\n        Template.registerHelper('freshEnvironment', function() {\r\n            return freshEnvironment();\r\n        });\r\n\r\n        Template.registerHelper('loading', function() {\r\n            // console.log('loading indicator in helper is: ', Session.get('loadingIndicator'));\r\n            return Session.get('loadingIndicator');\r\n        });\r\n\r\n        export function freshEnvironment() {\r\n            if (!Customers.find().count() && !TemplateApps.find().count()) {\r\n                // Session.set('currentStep', 0);\r\n                return true\r\n            }\r\n        };\r\n\r\n        Template.registerHelper('readyToSelectTemplate', function() {\r\n            return currentStep() === 2\r\n        });\r\n\r\n        Template.registerHelper('templateButNoCustomer', function() {\r\n            return !Customers.find()\r\n                .count() && TemplateApps.find()\r\n                .count()\r\n        });\r\n\r\n        Template.registerHelper('readyToGenerate', function() {\r\n            return currentStep() === 3 && !Session.equals('loadingIndicator', 'loading');\r\n        });\r\n\r\n        Template.registerHelper('step3', function() {\r\n            return Session.get('currentStep') === 3\r\n        });\r\n\r\n        Template.registerHelper('step3or4', function() {\r\n            return Session.get('currentStep') === 3 ||\r\n                Session.get('currentStep') === 4 ||\r\n                Session.equals('loadingIndicator', 'loading')\r\n        });\r\n\r\n        Template.registerHelper('stepEqualTo', function(stepNr) {\r\n            // console.log('value of currentStep() ', currentStep());\r\n            return currentStep() === stepNr;\r\n        });\r\n\r\n        export function currentStep() {\r\n            // console.log('the current step session', Session.get('currentStep'));//\r\n\r\n            //step 0: fresh/resetted environment\r\n            if (freshEnvironment()) {\r\n                return 0\r\n            }\r\n            //step 1 insert customers\r\n            else if (Session.get('currentStep') === 1) {\r\n                Router.go('users');\r\n                return 1\r\n            }\r\n            //step 2 there are customers, but no template\r\n            else if (\r\n                // (Customers.find().count() && !TemplateApps.find().count()) &&\r\n                Session.get('currentStep') === 2) {\r\n                return 2\r\n            }\r\n            //step 3\r\n            else if (\r\n                // Customers.find().count() && \r\n                // TemplateApps.find().count() && \r\n                Session.get('currentStep') === 3 &&\r\n                !Session.equals('loadingIndicator', 'loading')) {\r\n                // console.log('loading indicator is ', Session.get('loadingIndicator') )\r\n                return 3\r\n            }\r\n            //step 4\r\n            else if (\r\n                Session.get('currentStep') === 4\r\n                // &&\r\n                // Customers.find().count() &&\r\n                // TemplateApps.find().count()\r\n            ) {\r\n                return 4;\r\n            } else if (Session.equals('loadingIndicator', 'loading')) {\r\n                return;\r\n            } else {\r\n                Session.set('currentStep', 3);\r\n                return 3;\r\n            }\r\n        }\r\n\r\n        Template.registerHelper('generationFinished', function() {\r\n            return (Session.equals('loadingIndicator', 'loading') || Session.get('generated?'));\r\n        });\r\n\r\n        Template.registerHelper('readyToTestSSO', function() {\r\n            return currentStep() === 4\r\n        });\r\n\r\n        Template.registerHelper('and', (a, b) => {\r\n            return a && b;\r\n        });\r\n        Template.registerHelper('or', (a, b) => {\r\n            return a || b;\r\n        });\r\n\r\n    }","// ServiceConfiguration.configurations.upsert({\r\n//     service: \"facebook\"\r\n// }, {\r\n//     $set: {\r\n//         appId: Meteor.settings.private.facebook.clientId,\r\n//         loginStyle: \"popup\",\r\n//         secret: Meteor.settings.private.facebook.secret\r\n//     }\r\n// });\r\n\r\n// ServiceConfiguration.configurations.upsert({\r\n//     service: \"github\"\r\n// }, {\r\n//     $set: {\r\n//         clientId: Meteor.settings.private.github.clientId,\r\n//         loginStyle: \"popup\",\r\n//         secret: Meteor.settings.private.github.secret\r\n//     }\r\n// });\r\n\r\n// ServiceConfiguration.configurations.upsert({\r\n//     service: \"linkedin\"\r\n// },{\r\n//     loginStyle: \"popup\",\r\n//     service: \"linkedin\",\r\n//     clientId: Meteor.settings.private.linkedin.clientId,\r\n//     secret: Meteor.settings.private.linkedin.secret,\r\n// });\r\n\r\n\r\n// ServiceConfiguration.configurations.upsert({\r\n//     service: \"twitter\"  \r\n// },{\r\n//     service: \"twitter\",\r\n//     consumerKey: Meteor.settings.private.twitter.clientId,\r\n//     loginStyle: \"popup\",\r\n//     secret: Meteor.settings.private.twitter.secret\r\n// });\r\n\r\n\r\n// ServiceConfiguration.configurations.upsert({\r\n//     service: \"google\"\r\n// }, {\r\n//     $set: {\r\n//         clientId: Meteor.settings.private.google.clientId,\r\n//         loginStyle: \"popup\",\r\n//         secret: Meteor.settings.private.google.secret\r\n//     }\r\n// });\r\n\r\n\r\nconst numberOfUsers = Meteor.users.find().count();\r\nconsole.log('Checking the user accounts, number of users is: ' + numberOfUsers)\r\n\r\nif (!numberOfUsers) {\r\n    var id = Accounts.createUser({\r\n        username: 'demo',\r\n        email: 'demo@qlik.com',\r\n        password: 'schiphol',\r\n        profile: { name: 'Qlik test user' }\r\n    });\r\n    console.log('user created with id: ', id);\r\n    Roles.addUsersToRoles(id, 'test', Roles.GLOBAL_GROUP);\r\n\r\n    id = Accounts.createUser({\r\n        username: 'admin',\r\n        email: 'mbj@qlik.com',\r\n        password: 'Qlik456464',\r\n        profile: { name: 'Qlik admin user' }\r\n    });\r\n    console.log('user created with id: ', id);\r\n    Roles.addUsersToRoles(id, 'admin', Roles.GLOBAL_GROUP);\r\n}\r\n","//SETUP PROXY SERVER TO RUN METEOR QRS AND WEB INTEGRATION DEMO BOTH ON PORT 80\r\n\r\nvar proxy = require('redbird')({ port: Meteor.settings.public.proxyPort, ntlm: true, bunyan: false }); //bunyan:true for logging output in the console    \r\n// Route to any local ip, for example from docker containers.\r\n\r\nproxy.register(Meteor.settings.public.qlikSenseHost, \"http://localhost:3000\"); //need subdomain otherwise meteor root-URL does not work\r\nproxy.register(Meteor.settings.public.webIntegrationHost, \"http://localhost:3030\"); //need subdomain otherwise meteor root-URL does not work\r\nproxy.register('slides.qlik.com', \"http://localhost:3060\"); //need subdomain otherwise meteor root-URL does not work\r\nproxy.register('integration.qlik.com', \"http://localhost:3000\"); //need subdomain otherwise meteor root-URL does not work\r\nproxy.register('saasdemo.qlik.com', \"http://localhost:3000\"); //need subdomain otherwise meteor root-URL does not work","//import meteor collections\r\nimport { Apps, TemplateApps, GeneratedResources } from '/imports/api/apps';\r\nimport { Streams } from '/imports/api/streams';\r\nimport { Customers } from '/imports/api/customers';\r\nimport { APILogs } from '/imports/api/APILogs';\r\nimport moment from 'moment';\r\n\r\n//only fill the local mongoDB that runs in the browser with data that belongs to the user...\r\n//https://www.meteor.com/tutorials/blaze/publish-and-subscribe\r\nMeteor.publish('apps', function(generatedAppsFromUser) {\r\n    if (Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) {\r\n        return Apps.find();\r\n\r\n    } else {\r\n        //console.log('Client subscribed to collection, with these generated app ids: ', generatedAppsFromUser);\r\n        if (!generatedAppsFromUser) {\r\n            generatedAppsFromUser = [];\r\n            // console.log('##### No generated resources exists yet, so only show the template apps')\r\n        } else {\r\n            // console.log('### publication recevied these generated app ids for the user: ', generatedAppsFromUser);\r\n        }\r\n        return Apps.find({\r\n            $or: [{ \"id\": { \"$in\": generatedAppsFromUser } }, { \"stream.name\": \"Templates\" } //, { \"stream.name\": \"Everyone\" }\r\n            ]\r\n        });\r\n    }\r\n    this.ready();\r\n});\r\n\r\nMeteor.publish('streams', function(generatedStreamsFromUser) {\r\n    if (Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) {\r\n        return Streams.find();\r\n\r\n    } else {\r\n        if (!generatedStreamsFromUser) {\r\n            generatedStreamsFromUser = [];\r\n        }\r\n        return Streams.find({\r\n            $or: [{ \"id\": { \"$in\": generatedStreamsFromUser } }, { \"name\": \"Templates\" } //, { \"name\": \"Everyone\" }\r\n            ]\r\n        });\r\n\r\n    }\r\n    this.ready();\r\n});\r\nMeteor.publish('templateApps', function() {\r\n    return TemplateApps.find({ 'generationUserId': this.userId });\r\n    this.ready();\r\n});\r\n\r\nMeteor.publish('generatedResources', function() {\r\n    return GeneratedResources.find({ 'generationUserId': this.userId });\r\n    this.ready();\r\n});\r\n\r\nMeteor.publish('customers', function() {\r\n    return Customers.find({ 'generationUserId': this.userId });\r\n    this.ready();\r\n});\r\n\r\nMeteor.publish('apiLogs', function() {\r\n    // const selector = {\r\n    //     \"createDate\": {\r\n    //         $lt: new Date(),\r\n    //         $gte: new Date(new Date().setDate(new Date().getDate() - 0.05))  //show only the last hour  of api logs\r\n    //     }\r\n    //};\r\n    //     today: function() {\r\n    //     var now = moment().toDate();\r\n    //     return Posts.find({createdAt : { $gte : now }});\r\n    // }\r\n\r\n    const selector = {\r\n        sort: { createDate: -1 },\r\n        limit: 30\r\n    }\r\n\r\n    return APILogs.find({ 'generationUserId': this.userId }, selector);\r\n    this.ready();\r\n});\r\n\r\nMeteor.publish('users', function() {\r\n    //See https://github.com/alanning/meteor-roles\r\n    if (Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) {\r\n        return Meteor.users.find();\r\n    } else {\r\n        // user not authorized. do not publish secrets\r\n        this.stop();\r\n        return;\r\n    }\r\n});\r\n","//https://atmospherejs.com/simple/json-routes\r\n\r\nJsonRoutes.add(\"get\", \"/OneCustomerWithUsers\", function(req, res, next) {\r\n    // var id = req.params.id;\r\n    var sampleData = customer1\r\n\r\n    JsonRoutes.sendResult(res, {\r\n        data: customer1\r\n    });\r\n});\r\n\r\nJsonRoutes.add(\"get\", \"/multipleCustomersWithUsers\", function(req, res, next) {\r\n    // var id = req.params.id;\r\n    var sampleData = [customer1, customer2]\r\n\r\n    JsonRoutes.sendResult(res, {\r\n        data: [customer1, customer2]\r\n    });\r\n});\r\n\r\nvar customer1 = {\r\n    \"_id\": \"EXpapRzZXc52B3joK\",\r\n    \"name\": \"Ullrich - Barrows\",\r\n    \"checked\": true,\r\n    \"users\": [{\r\n        \"name\": \"John\",\r\n        \"group\": \"Consumer\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"Germany\"\r\n    }, {\r\n        \"name\": \"Linda\",\r\n        \"group\": \"Contributor\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"United States\"\r\n    }, {\r\n        \"name\": \"Martin\",\r\n        \"group\": \"Developer\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"Italy\"\r\n    }, {\r\n        \"name\": \"Paul\",\r\n        \"group\": \"Admin\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"Italy\"\r\n    }],\r\n    \"generationUserId\": \"rZPZYbaWM33ZHNr6Z\"\r\n};\r\n\r\nvar customer2 = {\r\n    \"_id\": \"EXpapRzZXc52B3joK\",\r\n    \"name\": \"Ullrich - Barrows\",\r\n    \"checked\": true,\r\n    \"users\": [{\r\n        \"name\": \"John\",\r\n        \"group\": \"Consumer\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"Germany\"\r\n    }, {\r\n        \"name\": \"Linda\",\r\n        \"group\": \"Contributor\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"United States\"\r\n    }, {\r\n        \"name\": \"Martin\",\r\n        \"group\": \"Developer\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"Italy\"\r\n    }, {\r\n        \"name\": \"Paul\",\r\n        \"group\": \"Admin\",\r\n        \"currentlyLoggedIn\": false,\r\n        \"country\": \"Italy\"\r\n    }],\r\n    \"generationUserId\": \"rZPZYbaWM33ZHNr6Z\"\r\n};","import { REST_Log } from '/imports/api/APILogs';\r\n\r\nRouter.route('/updateSenseInfo/apps', function(request, response, next) {\r\n     // console.log('++++++++++++We got an incoming REST Call from the Sense Notification handler for APPS, this means the Sense Repository has changed');\r\n     //logging only\r\n     // var call = {};\r\n     // call.action = 'Notification apps'\r\n     // call.request = 'We got an incoming REST Call from the Sense Notification handler for APPS, this means the Sense Repository has changed';\r\n     // REST_Log(call);\r\n     Meteor.call('updateLocalSenseCopyApps');\r\n }, { where: 'server' });\r\n\r\n Router.route('/updateSenseInfo/streams', function(request, response, next) {\r\n     // console.log('++++++++++++We got an incoming REST Call from the Sense Notification handler for STREAMS, this means the Sense Repository has changed');\r\n     //logging only\r\n     // var call = {};\r\n     // call.action = 'Notification streams'\r\n     // call.request = 'We got an incoming REST Call from the Sense Notification handler for APPS, this means the Sense Repository has changed';\r\n     // REST_Log(call);\r\n     Meteor.call('updateLocalSenseCopyStreams');\r\n }, { where: 'server' });\r\n","import {Customers} from '../imports/api/customers.js';\r\n\r\nvar customers = \r\n// [{\"name\":\"A&R Partners\",\"checked\":true},\r\n// {\"name\":\"A2Z Solutions\",\"checked\":true},\r\n// {\"name\":\"Aaron D. Meyer & Associates\",\"checked\":true},\r\n// {\"name\":\"Aaron Products\",\"checked\":true},\r\n// {\"name\":\"Active Data\",\"checked\":true},\r\n// {\"name\":\"Ben and Jerryâ€™s\",\"checked\":true},\r\n// {\"name\":\"Benedict\",\"checked\":true},\r\n// {\"name\":\"Bizmarts\",\"checked\":true},\r\n// {\"name\":\"C & C  Design\",\"checked\":true},\r\n// {\"name\":\"C & J Engineering\",\"checked\":true},\r\n// {\"name\":\"CAF Systemhaus\",\"checked\":true},\r\n// {\"name\":\"CAM Group\",\"checked\":true},\r\n// {\"name\":\"Caribian Specialties\",\"checked\":true},\r\n// {\"name\":\"City Fresh Foods\",\"checked\":true},\r\n// {\"name\":\"Clearout\",\"checked\":true},\r\n// {\"name\":\"David Spencer Ltd.\",\"checked\":true},\r\n// {\"name\":\"Dayton Malleable Inc.\",\"checked\":true},\r\n// {\"name\":\"DCP Research\",\"checked\":true},\r\n// {\"name\":\"DCS International\",\"checked\":true},\r\n// {\"name\":\"DCS Laboratory\",\"checked\":true},\r\n// {\"name\":\"Deak-Perera Group.\",\"checked\":true},\r\n// {\"name\":\"Earth\",\"checked\":true},\r\n// {\"name\":\"eDistrict\",\"checked\":true},\r\n// {\"name\":\"EDP\",\"checked\":true},\r\n// {\"name\":\"Ethyl Corporation\",\"checked\":true},\r\n// {\"name\":\"Federal Focus\",\"checked\":true},\r\n// {\"name\":\"Fill It\",\"checked\":true},\r\n// {\"name\":\"Filmotype\",\"checked\":true},\r\n// {\"name\":\"Fins\",\"checked\":true},\r\n// {\"name\":\"Gate\",\"checked\":true},\r\n// {\"name\":\"Gulf and Western Industries\",\"checked\":true},\r\n// {\"name\":\"Harte-Hanks (formerly Locator)\",\"checked\":true},\r\n// {\"name\":\"Harvard Trust Company\",\"checked\":true},\r\n// {\"name\":\"HCHS\",\"checked\":true},\r\n// {\"name\":\"Healtheon\",\"checked\":true},\r\n// {\"name\":\"Hetrick Systems\",\"checked\":true},\r\n// {\"name\":\"Home Team\",\"checked\":true},\r\n// {\"name\":\"Homebound\",\"checked\":true},\r\n// {\"name\":\"IBVA\",\"checked\":true},\r\n// {\"name\":\"Icon\",\"checked\":true},\r\n// {\"name\":\"Icon Site Builders\",\"checked\":true},\r\n// {\"name\":\"Idyllwild\",\"checked\":true},\r\n// {\"name\":\"J. S. Lee Associates\",\"checked\":true},\r\n// {\"name\":\"K International\",\"checked\":true},\r\n// {\"name\":\"K.C. Irving\",\"checked\":true},\r\n// {\"name\":\"Kari & Associates\",\"checked\":true},\r\n// {\"name\":\"Karsing\",\"checked\":true},\r\n// {\"name\":\"Kazinformcom\",\"checked\":true},\r\n// {\"name\":\"KentISP\",\"checked\":true},\r\n// {\"name\":\"Kool-Seal\",\"checked\":true},\r\n// {\"name\":\"Laker Airways\",\"checked\":true},\r\n// {\"name\":\"Livermore  Laboratories (LSLI)\",\"checked\":true},\r\n// {\"name\":\"LiveWire BBS and   Favourite Links\",\"checked\":true},\r\n// {\"name\":\"MATRIX\",\"checked\":true},\r\n// {\"name\":\"Miles Laboratories, Inc.\",\"checked\":true},\r\n// {\"name\":\"NACSCORP\",\"checked\":true},\r\n// {\"name\":\"Onestar\",\"checked\":true},\r\n// {\"name\":\"Pace\",\"checked\":true},\r\n// {\"name\":\"Pacific Group\",\"checked\":true},\r\n// {\"name\":\"Pacific Matics\",\"checked\":true},\r\n// {\"name\":\"Pacific Sierra Research\",\"checked\":true},\r\n// {\"name\":\"Pacific Voice\",\"checked\":true},\r\n// {\"name\":\"Pacific West Enterprises\",\"checked\":true},\r\n// {\"name\":\"PacificServ\",\"checked\":true},\r\n// {\"name\":\"Panngea\",\"checked\":true},\r\n// {\"name\":\"PAP (Maintenance)\",\"checked\":true},\r\n// {\"name\":\"Paracel\",\"checked\":true},\r\n// {\"name\":\"Patient\",\"checked\":true},\r\n// {\"name\":\"Pinnacle Micro\",\"checked\":true},\r\n// {\"name\":\"QualServe\",\"checked\":true},\r\n// {\"name\":\"Quantum 4Xyte  Architects\",\"checked\":true},\r\n// {\"name\":\"Qwest\",\"checked\":true},\r\n// {\"name\":\"R&R Group\",\"checked\":true},\r\n// {\"name\":\"R.J. Matter & Associates\",\"checked\":true},\r\n// {\"name\":\"Ra Co Amo\",\"checked\":true},\r\n// {\"name\":\"RC\",\"checked\":true},\r\n// {\"name\":\"Ready-to-Run\",\"checked\":true},\r\n// {\"name\":\"Remedy\",\"checked\":true},\r\n// {\"name\":\"Renegade info Crew\",\"checked\":true},\r\n// {\"name\":\"Reuters Usability Group\",\"checked\":true},\r\n// {\"name\":\"ReviewBooth\",\"checked\":true},\r\n// {\"name\":\"RFI Corporation\",\"checked\":true},\r\n// {\"name\":\"Road Warrior International\",\"checked\":true},\r\n// {\"name\":\"Robust Code\",\"checked\":true},\r\n// {\"name\":\"Sage\",\"checked\":true},\r\n// {\"name\":\"Sagent\",\"checked\":true},\r\n// {\"name\":\"Salamander Junction\",\"checked\":true},\r\n// {\"name\":\"Satronix\",\"checked\":true},\r\n// {\"name\":\"Satyam\",\"checked\":true},\r\n// {\"name\":\"Scientific Atlanta\",\"checked\":true},\r\n// {\"name\":\"ScotGold Products\",\"checked\":true},\r\n// {\"name\":\"Screen Saver.com\",\"checked\":true},\r\n// {\"name\":\"Sifton Properties Limited\",\"checked\":true},\r\n// {\"name\":\"Sigma\",\"checked\":true},\r\n// {\"name\":\"Signature\",\"checked\":true},\r\n// {\"name\":\"SignatureFactory\",\"checked\":true},\r\n// {\"name\":\"Soloman Brothers\",\"checked\":true},\r\n// {\"name\":\"Southern Company\",\"checked\":true},\r\n// {\"name\":\"Stone Consolidated Corporation\",\"checked\":true},\r\n// {\"name\":\"Talou\",\"checked\":true},\r\n// {\"name\":\"Tampere\",\"checked\":true},\r\n// {\"name\":\"Tandy Corporation\",\"checked\":true},\r\n// {\"name\":\"Tangent\",\"checked\":true},\r\n// {\"name\":\"Tao Group\",\"checked\":true},\r\n// {\"name\":\"Target Marketing\",\"checked\":true},\r\n// {\"name\":\"Team ASA\",\"checked\":true},\r\n// {\"name\":\"Team Financial Management Systems\",\"checked\":true},\r\n// {\"name\":\"Teca-Print\",\"checked\":true},\r\n// {\"name\":\"Time Warner\",\"checked\":true},\r\n// {\"name\":\"Towmotor Corporation\",\"checked\":true},\r\n// {\"name\":\"Tredegar Company\",\"checked\":true},\r\n// {\"name\":\"Trend Line Corporation\",\"checked\":true},\r\n// {\"name\":\"U. S. Exchange\",\"checked\":true},\r\n// {\"name\":\"Unison Management Concepts\",\"checked\":true},\r\n// {\"name\":\"United States  (USIT)\",\"checked\":true},\r\n// {\"name\":\"UUmail\",\"checked\":true},\r\n// {\"name\":\"ValiCert\",\"checked\":true},\r\n// {\"name\":\"Valley  Solutions\",\"checked\":true},\r\n// {\"name\":\"Valpatken\",\"checked\":true},\r\n// {\"name\":\"Vanstar\",\"checked\":true},\r\n// {\"name\":\"Venable\",\"checked\":true},\r\n// {\"name\":\"Venred\",\"checked\":true},\r\n// {\"name\":\"Watcom International\",\"checked\":true},\r\n// {\"name\":\"Xentec\",\"checked\":true},\r\n// {\"name\":\"Xilinx\",\"checked\":true},\r\n// {\"name\":\"XVT\",\"checked\":true},\r\n// {\"name\":\"Zero Assumption Recovery\",\"checked\":true},\r\n// {\"name\":\"Zilog\",\"checked\":true},\r\n// {\"name\":\"Zitel\",\"checked\":true},\r\n// {\"name\":\"Zocalo\",\"checked\":true}]\r\n[{\"name\":\"Shell\",\"collection\":\"Shell\"},\r\n{\"name\":\"Esso\",\"collection\":\"Esso\"},\r\n{\"name\":\"BP\",\"collection\":\"BP\"}];\r\n\r\n//if (Customers.find().count() === 0){ \r\n // _.each(customers, function(customer){\r\n  //  Customers.insert(customer);\r\n//    console.log(\"Inserted \"+ customer.name);\r\n // })\r\n//}\r\n\r\n\r\n","import {\r\n    Meteor\r\n} from 'meteor/meteor';\r\nimport {\r\n    http\r\n} from 'meteor/meteor';\r\nimport {\r\n    Apps,\r\n    TemplateApps,\r\n    GeneratedResources\r\n} from '/imports/api/apps';\r\nimport {\r\n    APILogs,\r\n    REST_Log\r\n} from '/imports/api/APILogs';\r\n\r\n//import meteor collections\r\nimport {\r\n    Streams\r\n} from '/imports/api/streams';\r\nimport {\r\n    Customers\r\n} from '/imports/api/customers';\r\n\r\nimport * as QSApp from '/imports/api/server/QRSFunctionsApp';\r\nimport * as QSStream from '/imports/api/server/QRSFunctionsStream';\r\nimport * as QSLic from '/imports/api/server/QRSFunctionsLicense';\r\nimport * as QSProxy from '/imports/api/server/QPSFunctions';\r\nimport * as QSSystem from '/imports/api/server/QRSFunctionsSystemRules';\r\nimport * as QSExtensions from '/imports/api/server/QRSFunctionsExtension';\r\nimport * as QSCustomProps from '/imports/api/server/QRSFunctionsCustomProperties';\r\n\r\n//stop on unhandled errors\r\nprocess.on('unhandledRejection', up => { throw up })\r\n\r\n//import config for Qlik Sense QRS and Engine API.\r\nimport {\r\n    senseConfig,\r\n    authHeaders\r\n} from '/imports/api/config';\r\nimport '/imports/startup/accounts-config.js';\r\nconst path = require('path');\r\nimport shell from 'node-powershell'\r\n\r\nMeteor.startup(function() {\r\n    process.env.ROOT_URL = 'http://' + Meteor.settings.public.qlikSenseHost;\r\n    console.log('********* We expect Qlik Sense to run on host: ', process.env.ROOT_URL + ':' + Meteor.settings.public.qlikSensePort);\r\n    // console.log('********* For END USERS we expect Sense to run on host: ', Meteor.settings.public.qlikSenseHost + ':' + Meteor.settings.public.qlikSensePort);\r\n    initQlikSense();\r\n    removeGeneratedResources();\r\n    optimizeMongoDB();\r\n});\r\n\r\n\r\n//\r\n// â”€â”€â”€ SETUP QLIK SENSE AFTER A CLEAN QlIK SENSE INSTALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n//Check if Qlik Sense has been properly setup for this MeteorQRS tool.\r\nasync function initQlikSense() {\r\n    console.log('------------------------------------');\r\n    console.log('INIT QLIK SENSE');\r\n    console.log('Project root folder: ', Meteor.absolutePath)\r\n    if (!Meteor.settings.broker.automationBaseFolder) {\r\n        Meteor.settings.broker.automationBaseFolder = path.join(Meteor.absolutePath, '.automation');\r\n        console.log('Meteor.settings.broker.automationBaseFolder was empty, setting it to default: ', Meteor.settings.broker.automationBaseFolder)\r\n    }\r\n    if (!Meteor.settings.broker.customerDataDir) {\r\n        Meteor.settings.broker.customerDataDir = path.join(Meteor.absolutePath, 'customerData');\r\n        console.log('Meteor.settings.broker.customerDataDir was empty, setting it to default: ', Meteor.settings.broker.customerDataDir)\r\n    }\r\n    console.log('------------------------------------');\r\n    Meteor.call('updateLocalSenseCopy');\r\n\r\n    try {\r\n        //By checking if a stream exist we try to figure out if this is a fresh or already existing Qlik Sense installation.\r\n        var QlikConfigured = QSStream.getStreamByName(Meteor.settings.public.TemplateAppStreamName);\r\n        if (!QlikConfigured || Meteor.settings.broker.runInitialQlikSenseSetup) {\r\n            console.log('Template stream does not yet exist or the runInitialQlikSenseSetup setting has been set to true, so we expect to have a fresh Qlik Sense installation for which we now automatically populate with the apps, streams, license, security rules etc.');\r\n            if (Meteor.settings.qlikSense.installQlikSense) {\r\n                installQlikSense();\r\n                await timeout(1000 * 60 * 20); //wait 20 minutes till the Qlik Sense installation has completed...                            \r\n                QSLic.insertLicense();\r\n            }\r\n            QSLic.insertUserAccessRule();\r\n            QSSystem.disableDefaultSecurityRules();\r\n            await QSProxy.createVirtualProxies();\r\n            await timeout(4000); //wait till the proxy has restarted...\r\n            await QSSystem.createSecurityRules();\r\n            QSStream.initSenseStreams();\r\n            await QSApp.uploadAndPublishTemplateApps();\r\n            QSApp.setAppIDs();\r\n            await QSApp.createAppConnections(); //import extra connections \r\n            QSExtensions.uploadExtensions();\r\n            QSLic.saveSystemRules();\r\n        } else {\r\n            //set the app Id for the self service bi and the slide generator app, for use in the IFrames etc.    \r\n            QSApp.setAppIDs();\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error('Main.js, initQlikSense: Failed to run the initialization of Qlik Sense', error);\r\n    }\r\n}\r\n\r\n//helper functions to await a set timeout\r\nfunction timeout(ms) {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\nasync function sleep(fn, ...args) {\r\n    await timeout(3000);\r\n    return fn(...args);\r\n}\r\n\r\n//\r\n// â”€â”€â”€ INSTALL QLIK SENSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nvar exec = require('child_process').execFile;\r\nvar installQlikSense = function() {\r\n    console.log(\"Start installation of Qlik Sense via a silent script... please wait 15 minutes to complete... (we use this is a safe assumption that is has finished before we move on). Be aware of screens popping up which request extra info...\");\r\n\r\n    // let ps = new shell({\r\n    //     executionPolicy: 'Bypass',\r\n    //     noProfile: true\r\n    // });\r\n    // var folder = Meteor.settings.qlikSense.sharedPersistanceFolder;\r\n    // var name = Meteor.settings.qlikSense.sharedPersistanceFolderName;\r\n\r\n    // // ps.addCommand('Write-Host Creating a shared folder on: ' + folder);\r\n    // ps.addCommand('New-Item \"C:\\\\test\" â€“type directory');\r\n    // // ps.addCommand('New-SmbShare â€“Name ' + name + ' â€“Path ' + folder + ' â€“FullAccess Everyone  ')\r\n\r\n    // ps.invoke()\r\n    //     .then(output => {\r\n    //         console.log(output);\r\n    //     })\r\n    //     .catch(err => {\r\n    //         console.error('Installation of Qlik Sense failed, make sure you check the log file in GitHub\\QRSMeteor\\.automation\\InstallationSoftware\\log.txt', err)\r\n    //         ps.dispose();\r\n    //     });\r\n\r\n    var executable = 'startSilentInstall.ps1';\r\n    var installer = path.join(Meteor.settings.broker.automationBaseFolder, 'InstallationSoftware', executable);\r\n    exec(installer, function(err, data) {\r\n        if (err) {} else {\r\n            console.log('installation of Qlik Sense success, reponse from the Qlik Sense installer: ' + data.toString());\r\n        }\r\n    });\r\n}\r\n\r\n\r\n//\r\n// â”€â”€â”€ REMOVE STREAMS AND APPS CREATED DURING THE SAAS DEMO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\nfunction removeGeneratedResources() {\r\n    // console.log('remove the all generated resources on each server start');\r\n    // Meteor.setTimeout(function() {\r\n    //     console.log('remove all generated resources in mongo and qlik sense periodically by making use of a server side timer');\r\n    //     Meteor.call('removeGeneratedResources', {});\r\n    // }, 0); //remove all logs directly at startup\r\n    if (Meteor.settings.broker.automaticCleanUpGeneratedApps === \"Yes\") {\r\n        Meteor.setInterval(function() {\r\n            console.log('remove all generated resources in mongo and qlik sense periodically by making use of a server side timer');\r\n            Meteor.call('removeGeneratedResources', {});\r\n        }, 1 * 86400000); //remove all logs/apps/streams every 1 day\r\n    }\r\n}\r\n\r\nfunction optimizeMongoDB() {\r\n    // console.log('## setting up mongo indexes on generationUserId in the generated resources, customers and other collections, to increase mongo performance');\r\n    TemplateApps._ensureIndex({\r\n        \"generationUserId\": 1,\r\n        \"id\": 1\r\n    });\r\n    GeneratedResources._ensureIndex({\r\n        \"generationUserId\": 1,\r\n        \"id\": 1\r\n    });\r\n    Apps._ensureIndex({\r\n        \"id\": 1\r\n    });\r\n    Customers._ensureIndex({\r\n        \"generationUserId\": 1\r\n    });\r\n    Streams._ensureIndex({\r\n        \"id\": 1\r\n    });\r\n    APILogs._ensureIndex({\r\n        \"createdBy\": 1\r\n    });\r\n    APILogs._ensureIndex({\r\n        \"createDate\": 1\r\n    });\r\n}\r\n\r\n//\r\n// â”€â”€â”€ GET AN UPDATE WHEN QLIK SENSE HAS CHANGED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\n// function createNotificationListeners() {\r\n//     //Create notification listener in Qlik sense https://help.qlik.com/en-US/sense-developer/3.1/Subsystems/RepositoryServiceAPI/Content/RepositoryServiceAPI/RepositoryServiceAPI-Notification-Remove-Change-Subscription.htm\r\n//     //console.log('********* On meteor startup, Meteor tool registers itself at Qlik Sense to get notifications from Sense on changes to apps and streams.');\r\n//     //console.log('********* we try to register a notification on this URL: HTTP post to http://' + senseConfig.SenseServerInternalLanIP + ':' + senseConfig.port + '/' + senseConfig.virtualProxy + '/qrs/notification?name=app');\r\n//     //console.log('********* The notification URL for Streams is: ' + Meteor.settings.private.notificationURL + '/streams');\r\n\r\n//     try {\r\n//         const resultApp = HTTP.post('http://' + senseConfig.SenseServerInternalLanIP + ':' + senseConfig.port + '/' + senseConfig.virtualProxy + '/qrs/notification?name=app', {\r\n//             headers: authHeaders,\r\n//             params: { 'xrfkey': senseConfig.xrfkey },\r\n//             data: Meteor.settings.private.notificationURL + '/apps'\r\n//         })\r\n\r\n//         const resultStream = HTTP.post('http://' + senseConfig.SenseServerInternalLanIP + ':' + senseConfig.port + '/' + senseConfig.virtualProxy + '/qrs/notification?name=stream', {\r\n//                 headers: authHeaders,\r\n//                 params: { 'xrfkey': senseConfig.xrfkey },\r\n//                 data: Meteor.settings.private.notificationURL + '/streams'\r\n//             })\r\n//             //console.log('Register notication success');\r\n//             // //console.log('the result from sense register App notification was: ', resultApp);\r\n//             // //console.log('the result from sense register Stream notification was: ', resultStream);\r\n//     } catch (err) {\r\n//         console.error('Create notification subscription in sense qrs failed', err);\r\n//         // throw new Meteor.Error('Create notification subscription in sense qrs failed', err);\r\n//     }\r\n// }\r\n\r\n//\r\n// â”€â”€â”€ METEOR METHODS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n//\r\n\r\n\r\nMeteor.methods({\r\n    getAppIDs() {\r\n        return {\r\n            SSBI: senseConfig.SSBIApp, // QSApp.getApps(Meteor.settings.public.SSBI.name, Meteor.settings.public.SSBI.stream)[0].id,\r\n            slideGenerator: senseConfig.slideGeneratorAppId //QSApp.getApps(Meteor.settings.public.slideGenerator.name, Meteor.settings.public.slideGenerator.stream)[0].id\r\n        };\r\n    },\r\n    async generateStreamAndApp(customers) {\r\n        try {\r\n            check(customers, Array);\r\n        } catch (error) {\r\n            throw new Meteor.Error('Missing field', 'No customers supplied for the generation of apps.');\r\n        }\r\n        // first clean the environment\r\n        Meteor.call('removeGeneratedResources', {\r\n            'generationUserId': Meteor.userId()\r\n        });\r\n        await QSApp.generateStreamAndApp(customers, this.userId); //then, create the new stuff\r\n\r\n        console.log('################## Meteor.settings.multiTenantScenario', Meteor.settings.multiTenantScenario);\r\n        try {\r\n            if (!Meteor.settings.multiTenantScenario) { //on premise installation for a single tenant (e.g. with MS Active Directory)\r\n                var customerNames = customers.map(function(c) {\r\n                    return c.name;\r\n                });\r\n\r\n                console.log('customerNames', customerNames)\r\n                QSCustomProps.upsertCustomPropertyByName('customer', customerNames); //for non OEM scenarios (with MS AD), people like to use custom properties for authorization instead of the groups via a ticket.\r\n            }\r\n        } catch (error) {\r\n            console.log('error to create custom properties', error);\r\n        }\r\n\r\n        Meteor.call('updateLocalSenseCopy');\r\n    },\r\n    resetEnvironment() {\r\n        Meteor.call('resetLoggedInUser'); //logout all users before removing all the current customers. This to prevent the screen stays logged in at an old user.\r\n        Meteor.call('removeGeneratedResources', {\r\n            'generationUserId': Meteor.userId()\r\n        });\r\n        TemplateApps.remove({\r\n            'generationUserId': Meteor.userId()\r\n        });\r\n        Customers.remove({\r\n            'generationUserId': Meteor.userId()\r\n        });\r\n        APILogs.remove({\r\n            'generationUserId': Meteor.userId()\r\n        });\r\n        if (!Meteor.settings.multiTenantScenario) { //on premise installation for a single tenant (e.g. with MS Active Directory)\r\n            QSCustomProps.deleteCustomProperty('customers');\r\n        }\r\n    },\r\n    upsertTemplate(selector, currentApp) {\r\n        console.log('upsert template')\r\n        TemplateApps.upsert(selector, {\r\n            $set: {\r\n                name: currentApp.name,\r\n                id: currentApp.id,\r\n                generationUserId: Meteor.userId(),\r\n            },\r\n        });\r\n    },\r\n    removeTemplate(selector, currentApp) {\r\n        console.log('remove template')\r\n        TemplateApps.remove(selector);\r\n    },\r\n    removeGeneratedResources(generationUserSelection) {\r\n        //console.log('remove GeneratedResources method, before we make new ones');\r\n        //logging only\r\n        if (generationUserSelection) {\r\n            const call = {};\r\n            call.action = 'Remove generated resources';\r\n            call.request = 'Remove all apps and streams in Qlik Sense for userId: ' + generationUserSelection.generationUserId;\r\n            REST_Log(call, generationUserSelection);\r\n        }\r\n        GeneratedResources.find(generationUserSelection)\r\n            .forEach(function(resource) {\r\n                // this.unblock()\r\n                //console.log('resetEnvironment for userId', Meteor.userId());generationUserSelection.generationUserId\r\n\r\n                //If not selection was given, we want to reset the whole environment, so also delete the streams.\r\n                // if (!generationUserSelection.generationUserId) {\r\n                try {\r\n                    Meteor.call('deleteStream', resource.streamId); //added random company names, so this should not be an issue //26-9 can't delete stream, because each user creates a stream with the same name...\r\n                } catch (err) {\r\n                    //console.error('No issue, but you can manually remove this id from the generated database. We got one resource in the generated list, that has already been removed manually', resource);\r\n                } //don't bother if generated resources do not exists, just continue\r\n                // }\r\n                //delete apps always\r\n                try {\r\n                    Meteor.call('deleteApp', resource.appId);\r\n                } catch (err) {\r\n                    //console.error('No issue, but you can manually remove this id from the generated database. We got one resource in the generated list, that has already been removed manually', resource);\r\n                }\r\n            })\r\n        GeneratedResources.remove(generationUserSelection);\r\n        APILogs.remove(generationUserSelection);\r\n    },\r\n    copyApp(guid, name) {\r\n        check(guid, String);\r\n        check(name, String);\r\n        const id = QSApp.copyApp(guid, name);\r\n        Meteor.call('updateLocalSenseCopy');\r\n        return id;\r\n    },\r\n    copyAppSelectedCustomers(currentApp) { //the app the user clicked on        \r\n        if (!currentApp) {\r\n            throw new Meteor.Error('No App selected to copy')\r\n        };\r\n\r\n        customers = Customers.find({\r\n            'generationUserId': Meteor.userId(),\r\n            checked: true\r\n        }); //all selected customers\r\n        if (!customers) {\r\n            throw new Meteor.Error('No customers selected to copy the app for')\r\n        };\r\n\r\n        customers\r\n            .forEach(customer => {\r\n                const newAppId = Meteor.call('copyApp', currentApp.id, customer.name + '-' + currentApp.name);\r\n                Meteor.call('updateLocalSenseCopy');\r\n\r\n                //store in the database that the user generated something, so we can later on remove it.\r\n                GeneratedResources.insert({\r\n                    'generationUserId': Meteor.userId(),\r\n                    'customer': null,\r\n                    'streamId': null,\r\n                    'appId': newAppId\r\n                });\r\n            });\r\n    },\r\n    deleteApp(guid) {\r\n        check(guid, String);\r\n        if (guid !== Meteor.settings.public.templateAppId) {\r\n            //logging only\r\n            const call = {};\r\n            call.action = 'Delete app';\r\n            call.request = 'Delete app: ' + guid;\r\n            REST_Log(call);\r\n\r\n            const id = QSApp.deleteApp(guid);\r\n            Meteor.call('updateLocalSenseCopy');\r\n            return id;\r\n        } else {\r\n            throw new Meteor.Error(\"you can't delete the template app with guid: \", guid);\r\n        }\r\n    },\r\n    removeAllCustomers: function() {\r\n        return Customers.remove({\r\n            'generationUserId': Meteor.userId()\r\n        });\r\n    }\r\n})\r\n\r\nMeteor.methods({\r\n    updateLocalSenseCopyApps() {\r\n        //delete the local content of the database before updating it\r\n        Apps.remove({});\r\n\r\n        //Update the Apps with fresh info from Sense        \r\n        _.each(QSApp.getApps(), app => {\r\n            Apps.insert(app);\r\n        });\r\n    },\r\n    updateLocalSenseCopyStreams() {\r\n        //delete the local content of the database before updating it        \r\n        Streams.remove({});\r\n\r\n        //Update the Streams with fresh info from Sense        \r\n        _.each(QSStream.getStreams(), stream => {\r\n            Streams.insert(stream);\r\n        });\r\n    },\r\n    updateLocalSenseCopy() {\r\n        // //console.log('Method: update the local mongoDB with fresh data from Qlik Sense: call QRS API getStreams and getApps');\r\n        //delete the local content of the database before updating it\r\n        Apps.remove({});\r\n        Streams.remove({});\r\n\r\n        //Update the Apps and Streams with fresh info from Sense        \r\n        _.each(QSApp.getApps(), app => {\r\n            Apps.insert(app);\r\n        });\r\n\r\n        _.each(QSStream.getStreams(), stream => {\r\n            Streams.insert(stream);\r\n        });\r\n    },\r\n    getSecurityRules() {\r\n        return QSSystem.getSecurityRules();\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n// checkSenseIsReady() {\r\n//     //console.log('Method: checkSenseIsReady, TRY TO SEE IF WE CAN CONNECT TO QLIK SENSE ENGINE VIA QSOCKS');\r\n\r\n//     // try {\r\n//     // qsocks.Connect(engineConfig)\r\n//     //     .then(function(global) {\r\n//     //         // Connected\r\n//     //         //console.log('Meteor is connected via Qsocks to Sense Engine API using certificate authentication');\r\n//     //         return true;\r\n//     //     }, function(err) {\r\n//     //         // Something went wrong\r\n//     //         console.error('Meteor could not connect to Sense with the config settings specified. The error is: ', err.message);\r\n//     //         console.error('the settings are: ', engineConfig)\r\n//     //         return false\r\n//     //         // throw new Meteor.Error('Could not connect to Sense Engine API', err.message);\r\n//     //     });\r\n\r\n//     //TRY TO SEE IF WE CAN CONNECT TO SENSE VIA HTTP\r\n//     try{\r\n//         const result = HTTP.get('http://' + senseConfig.SenseServerInternalLanIP +':' + senseConfig.port + '/'+ senseConfig.virtualProxy + '/qrs/app/full', { //?xrfkey=' + senseConfig.xrfkey, {\r\n//             headers: authHeaders,\r\n//             params: { 'xrfkey': senseConfig.xrfkey }\r\n//         })//http get\r\n//         //console.log(result);\r\n//         if(result.statuscode === 200){\r\n//             //console.log('We got a result back from Sense with statuscode 200: Success')\r\n//             return true;}\r\n//         else{return false}\r\n//     } catch (err) {\r\n//         return false;\r\n//         // throw new Meteor.Error('Could not connect via HTTP to Qlik Sense: Is Sense running? Are the firewalls open? Have you exported the certificate for this host? virtualProxy setup?');\r\n//     }\r\n// }\r\n\r\n//GET APPS USING QSOCKS (FOR DEMO PURPOSE ONLY, CAN ALSO BE DONE WITH QRS API)\r\n// getApps() {\r\n//     return QSApp.getApps();\r\n//     // appListSync = Meteor.wrapAsync(qsocks.Connect(engineConfig)\r\n//     //     .then(function(global) {\r\n//     //         global.getDocList()\r\n//     //             .then(function(docList) {\r\n//     //                 return (docList);\r\n//     //             });\r\n//     //     })\r\n//     //     .catch(err => {\r\n//     //         throw new Meteor.Error(err)\r\n//     //     }));\r\n//     // result = appListSync();\r\n//     // return result;\r\n\r\n// },"]}